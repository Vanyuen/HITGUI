# æ–¹æ¡ˆCï¼šæ™ºèƒ½å¢é‡æ›´æ–°æ•°æ®è¡¨ - å®Œæ•´å®æ–½æ–¹æ¡ˆ

## ä¸€ã€å½“å‰æ•°æ®çŠ¶æ€

| æ•°æ®è¡¨ | æœ€æ–°è®°å½• | è¯´æ˜ |
|--------|----------|------|
| hit_dlts | ID=2805, æœŸå·=25137 | âœ… å·²æ˜¯æœ€æ–° |
| é—æ¼å€¼è¡¨ | ID=2792 | âŒ è½å13æœŸ |
| statisticså­—æ®µ | æœªçŸ¥ | éœ€æ£€æŸ¥ |
| ç»„åˆç‰¹å¾è¡¨ | æœªçŸ¥ | éœ€æ£€æŸ¥ |
| çƒ­æ¸©å†·ä¼˜åŒ–è¡¨ | target_issue=25115 | âŒ è½å22æœŸ |

---

## äºŒã€æ•°æ®ä¾èµ–å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     hit_dlts (å¼€å¥–æ•°æ®æº)                        â”‚
â”‚                        ID=2805, æœŸå·=25137                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                 â”‚                 â”‚
            â–¼                 â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                 â”‚
â”‚    é—æ¼å€¼è¡¨        â”‚         â”‚                 â”‚
â”‚  (å¿…é¡»å…ˆæ›´æ–°)      â”‚         â”‚                 â”‚
â”‚  ç›®æ ‡: ID=2805    â”‚         â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                 â”‚
          â”‚                   â”‚                 â”‚
          â–¼                   â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çƒ­æ¸©å†·ä¼˜åŒ–è¡¨    â”‚  â”‚ statisticså­—æ®µ  â”‚  â”‚   ç»„åˆç‰¹å¾è¡¨    â”‚
â”‚  (ä¾èµ–é—æ¼å€¼)    â”‚  â”‚ (ä¾èµ–é—æ¼å€¼)    â”‚  â”‚  (æ— å†å²ä¾èµ–)   â”‚
â”‚  ç›®æ ‡: 25138    â”‚  â”‚ ç›®æ ‡: ID=2805  â”‚  â”‚  ç›®æ ‡: ID=2805 â”‚
â”‚  (å«æ¨ç®—æœŸ)      â”‚  â”‚                 â”‚  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ¨ç®—æœŸå¤„ç†é€»è¾‘ï¼ˆé‡ç‚¹ï¼‰

### 3.1 ä»€ä¹ˆæ˜¯æ¨ç®—æœŸï¼Ÿ

æ¨ç®—æœŸæ˜¯**å°šæœªå¼€å¥–çš„ä¸‹ä¸€æœŸ**ï¼Œç”¨äºé¢„æµ‹åŠŸèƒ½ã€‚

| å­—æ®µ | å·²å¼€å¥–æœŸ | æ¨ç®—æœŸ |
|------|----------|--------|
| target_issue | 25137 | **25138** |
| base_issue | 25136 | **25137** |
| is_drawn | true | **false** |
| target_winning_reds | [7,8,9,11,22] | **[]** (ç©º) |
| target_winning_blues | [5,11] | **[]** (ç©º) |

### 3.2 æ¨ç®—æœŸè®¡ç®—ä¾èµ–

```
æ¨ç®—æœŸ 25138 çš„çƒ­æ¸©å†·æ¯”è®¡ç®—ï¼š
    â”‚
    â”œâ”€â”€ éœ€è¦: base_issue = 25137 (æœ€æ–°å·²å¼€å¥–æœŸ)
    â”‚
    â””â”€â”€ éœ€è¦: 25137æœŸçš„é—æ¼å€¼æ•°æ® (ID=2805)
              â”‚
              â””â”€â”€ å¦‚æœé—æ¼å€¼è¡¨æ²¡æœ‰ID=2805çš„è®°å½• â†’ æ¨ç®—æœŸç”Ÿæˆå¤±è´¥ï¼
```

### 3.3 å½“å‰æ¨ç®—æœŸå¤„ç†æµç¨‹

```javascript
// ç°æœ‰ä»£ç é€»è¾‘ (server.js:29436-29514)

1. è®¡ç®—æ¨ç®—æœŸæœŸå·: predictedIssueNum = latestIssue.Issue + 1  // 25137 + 1 = 25138

2. æŸ¥æ‰¾base_issue: hit_dlts.findOne({ Issue: predictedIssueNum - 1 })  // æ‰¾25137

3. è·å–base_issueçš„é—æ¼å€¼:
   collection('hit_dlt_basictrendchart_redballmissing_histories')
   .findOne({ ID: baseIssueForPrediction.ID })  // æ‰¾ID=2805çš„é—æ¼å€¼

4. å¦‚æœé—æ¼å€¼ä¸å­˜åœ¨ â†’ è·³è¿‡æ¨ç®—æœŸç”Ÿæˆï¼ˆå½“å‰é—®é¢˜æ‰€åœ¨ï¼ï¼‰

5. è®¡ç®—324,632ä¸ªçº¢çƒç»„åˆçš„çƒ­æ¸©å†·æ¯”

6. ä¿å­˜æ¨ç®—æœŸè®°å½• (is_drawn: false)
```

### 3.4 æ–¹æ¡ˆCä¸­çš„æ¨ç®—æœŸä¿éšœ

```
âœ… å¢é‡æ›´æ–°é—æ¼å€¼è¡¨åï¼ŒID=2805çš„é—æ¼å€¼å­˜åœ¨
    â”‚
    â””â”€â”€ âœ… æ¨ç®—æœŸ25138å¯ä»¥æ­£å¸¸ç”Ÿæˆ
```

---

## å››ã€æ–¹æ¡ˆCæ‰§è¡Œæµç¨‹

### 4.1 æ€»ä½“æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸€é”®å¢é‡æ›´æ–°æ•°æ®è¡¨                                â”‚
â”‚                POST /api/dlt/unified-update-incremental             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤0: æ•°æ®å·®è·æ£€æŸ¥                                                  â”‚
â”‚   - hit_dlts æœ€æ–°ID: 2805                                           â”‚
â”‚   - é—æ¼å€¼è¡¨æœ€æ–°ID: 2792 â†’ éœ€æ›´æ–°13æ¡                                â”‚
â”‚   - çƒ­æ¸©å†·ä¼˜åŒ–è¡¨æœ€æ–°æœŸå·: 25115 â†’ éœ€æ›´æ–°22æœŸ + 1æ¨ç®—æœŸ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1: å¢é‡æ›´æ–°é—æ¼å€¼è¡¨ (å¿…é¡»å…ˆæ‰§è¡Œ)                                  â”‚
â”‚   - è·å–ä¸Šä¸€æ¡é—æ¼å€¼è®°å½•(ID=2792)çš„é—æ¼çŠ¶æ€                           â”‚
â”‚   - ä»ID=2793å¼€å§‹ï¼Œé€æœŸè®¡ç®—é—æ¼å€¼                                     â”‚
â”‚   - ç›´åˆ°ID=2805                                                      â”‚
â”‚   - æ–°å¢13æ¡è®°å½•                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚               â”‚               â”‚
                â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤2a: å¢é‡æ›´æ–°   â”‚ â”‚ æ­¥éª¤2b: å¢é‡æ›´æ–°   â”‚ â”‚ æ­¥éª¤2c: å¢é‡æ›´æ–°   â”‚
â”‚ statisticså­—æ®µ    â”‚ â”‚ ç»„åˆç‰¹å¾è¡¨         â”‚ â”‚ (ç­‰å¾…æ­¥éª¤1å®Œæˆ)    â”‚
â”‚ (å¯å¹¶è¡Œ)          â”‚ â”‚ (å¯å¹¶è¡Œ)          â”‚ â”‚                   â”‚
â”‚ æ–°å¢13æ¡          â”‚ â”‚ æ–°å¢13æ¡          â”‚ â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚               â”‚                     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤3: å¢é‡æ›´æ–°çƒ­æ¸©å†·ä¼˜åŒ–è¡¨                                          â”‚
â”‚   3.1 åˆ é™¤æ—§æ¨ç®—æœŸè®°å½• (is_drawn=false)                              â”‚
â”‚   3.2 å¤„ç†æ–°å¼€å¥–æœŸ (25116~25137ï¼Œå…±22æœŸ)                             â”‚
â”‚       - æ¯æœŸéœ€è¦ä¸Šä¸€æœŸçš„é—æ¼å€¼ âœ… (æ­¥éª¤1å·²æ›´æ–°)                        â”‚
â”‚   3.3 ç”Ÿæˆæ–°æ¨ç®—æœŸ (25138)                                           â”‚
â”‚       - base_issue = 25137                                          â”‚
â”‚       - éœ€è¦25137æœŸ(ID=2805)çš„é—æ¼å€¼ âœ… (æ­¥éª¤1å·²æ›´æ–°)                  â”‚
â”‚   æ–°å¢: 22æ¡å·²å¼€å¥– + 1æ¡æ¨ç®—æœŸ = 23æ¡                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤4: è¿”å›æ›´æ–°ç»“æœ                                                  â”‚
â”‚   {                                                                 â”‚
â”‚     success: true,                                                  â”‚
â”‚     results: {                                                      â”‚
â”‚       missingTable: { newRecords: 13 },                             â”‚
â”‚       statistics: { newRecords: 13 },                               â”‚
â”‚       comboFeatures: { newRecords: 13 },                            â”‚
â”‚       hwcOptimized: { newRecords: 23, predictedIssue: "25138" }     â”‚
â”‚     },                                                              â”‚
â”‚     totalTime: "42.5ç§’"                                             â”‚
â”‚   }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€æ–°å¢å‡½æ•°è®¾è®¡

### 5.1 é—æ¼å€¼è¡¨å¢é‡æ›´æ–°å‡½æ•°

```javascript
/**
 * å¢é‡æ›´æ–°é—æ¼å€¼è¡¨
 * @returns {Object} { newRecords: Number, latestID: Number }
 */
async function incrementalUpdateMissingTables() {
    // 1. è·å–é—æ¼å€¼è¡¨æœ€æ–°è®°å½•
    const latestMissing = await db.collection('hit_dlt_basictrendchart_redballmissing_histories')
        .findOne({}, { sort: { ID: -1 } });

    const startID = latestMissing ? latestMissing.ID + 1 : 1;

    // 2. è·å–éœ€è¦å¤„ç†çš„æ–°å¼€å¥–è®°å½•
    const newRecords = await hit_dlts.find({ ID: { $gte: startID } })
        .sort({ ID: 1 }).lean();

    if (newRecords.length === 0) {
        return { newRecords: 0, message: 'é—æ¼å€¼è¡¨å·²æ˜¯æœ€æ–°' };
    }

    // 3. ç»§æ‰¿ä¸Šä¸€æœŸçš„é—æ¼çŠ¶æ€
    let redMissing = Array(35).fill(0);
    let blueMissing = Array(12).fill(0);

    if (latestMissing) {
        // ä»ä¸Šä¸€æ¡è®°å½•æ¢å¤é—æ¼çŠ¶æ€
        for (let i = 1; i <= 35; i++) {
            redMissing[i-1] = latestMissing[String(i)] || 0;
        }
    }

    // 4. é€æœŸè®¡ç®—æ–°çš„é—æ¼å€¼
    const newMissingRecords = [];
    for (const record of newRecords) {
        // é—æ¼å€¼é€’å¢
        for (let j = 0; j < 35; j++) redMissing[j]++;
        for (let j = 0; j < 12; j++) blueMissing[j]++;

        // é‡ç½®å¼€å‡ºå·ç 
        [record.Red1, record.Red2, record.Red3, record.Red4, record.Red5]
            .forEach(ball => { redMissing[ball - 1] = 0; });
        [record.Blue1, record.Blue2]
            .forEach(ball => { blueMissing[ball - 1] = 0; });

        // æ„å»ºè®°å½•
        const missingRecord = {
            ID: record.ID,
            Issue: record.Issue.toString(),
            // ... 35ä¸ªçº¢çƒé—æ¼å€¼å­—æ®µ
        };
        for (let j = 0; j < 35; j++) {
            missingRecord[(j + 1).toString()] = redMissing[j];
        }

        newMissingRecords.push(missingRecord);
    }

    // 5. æ‰¹é‡æ’å…¥
    await db.collection('hit_dlt_basictrendchart_redballmissing_histories')
        .insertMany(newMissingRecords);

    return { newRecords: newMissingRecords.length, latestID: newRecords[newRecords.length-1].ID };
}
```

### 5.2 statisticså­—æ®µå¢é‡æ›´æ–°å‡½æ•°

```javascript
/**
 * å¢é‡æ›´æ–°statisticså­—æ®µ
 * @returns {Object} { newRecords: Number }
 */
async function incrementalUpdateStatistics() {
    // 1. æŸ¥æ‰¾ç¼ºå°‘statisticså­—æ®µçš„è®°å½•
    const recordsWithoutStats = await hit_dlts.find({
        $or: [
            { statistics: { $exists: false } },
            { 'statistics.frontSum': { $exists: false } }
        ]
    }).sort({ ID: 1 }).lean();

    if (recordsWithoutStats.length === 0) {
        return { newRecords: 0, message: 'statisticså­—æ®µå·²æ˜¯æœ€æ–°' };
    }

    // 2. è·å–é—æ¼å€¼æ˜ å°„ï¼ˆç”¨äºçƒ­æ¸©å†·æ¯”è®¡ç®—ï¼‰
    const missingMap = new Map();
    const allMissing = await db.collection('hit_dlt_basictrendchart_redballmissing_histories')
        .find({}).toArray();
    allMissing.forEach(r => missingMap.set(r.ID, r));

    // 3. é€æ¡æ›´æ–°
    let updateCount = 0;
    for (const record of recordsWithoutStats) {
        const statistics = calculateStatistics(record, missingMap);
        await hit_dlts.updateOne(
            { ID: record.ID },
            { $set: { statistics } }
        );
        updateCount++;
    }

    return { newRecords: updateCount };
}
```

### 5.3 ç»„åˆç‰¹å¾è¡¨å¢é‡æ›´æ–°å‡½æ•°

```javascript
/**
 * å¢é‡æ›´æ–°ç»„åˆç‰¹å¾è¡¨
 * @returns {Object} { newRecords: Number }
 */
async function incrementalUpdateComboFeatures() {
    // 1. è·å–ç»„åˆç‰¹å¾è¡¨æœ€æ–°ID
    const latestCombo = await DLTComboFeatures.findOne({}).sort({ ID: -1 });
    const startID = latestCombo ? latestCombo.ID + 1 : 1;

    // 2. è·å–éœ€è¦å¤„ç†çš„æ–°è®°å½•
    const newRecords = await hit_dlts.find({ ID: { $gte: startID } })
        .sort({ ID: 1 }).lean();

    if (newRecords.length === 0) {
        return { newRecords: 0, message: 'ç»„åˆç‰¹å¾è¡¨å·²æ˜¯æœ€æ–°' };
    }

    // 3. ç”Ÿæˆç»„åˆç‰¹å¾å¹¶æ’å…¥
    const comboRecords = newRecords.map(record => {
        const balls = [record.Red1, record.Red2, record.Red3, record.Red4, record.Red5].sort((a,b) => a-b);
        return {
            ID: record.ID,
            Issue: record.Issue.toString(),
            combo_2: generateCombo2(balls),
            combo_3: generateCombo3(balls),
            combo_4: generateCombo4(balls)
        };
    });

    await DLTComboFeatures.insertMany(comboRecords);

    return { newRecords: comboRecords.length };
}
```

### 5.4 ä¸€é”®å¢é‡æ›´æ–°API

```javascript
/**
 * ä¸€é”®å¢é‡æ›´æ–°æ‰€æœ‰æ•°æ®è¡¨
 * POST /api/dlt/unified-update-incremental
 */
app.post('/api/dlt/unified-update-incremental', async (req, res) => {
    const startTime = Date.now();

    try {
        // æ­¥éª¤0: æ•°æ®å·®è·æ£€æŸ¥
        const gapAnalysis = await analyzeDataGap();

        // æ­¥éª¤1: å¢é‡æ›´æ–°é—æ¼å€¼è¡¨ (å¿…é¡»å…ˆæ‰§è¡Œ)
        const missingResult = await incrementalUpdateMissingTables();

        // æ­¥éª¤2: å¹¶è¡Œæ›´æ–° statistics å’Œ ç»„åˆç‰¹å¾è¡¨
        const [statsResult, comboResult] = await Promise.all([
            incrementalUpdateStatistics(),
            incrementalUpdateComboFeatures()
        ]);

        // æ­¥éª¤3: å¢é‡æ›´æ–°çƒ­æ¸©å†·ä¼˜åŒ–è¡¨ (åŒ…å«æ¨ç®—æœŸ)
        const hwcResult = await generateUnifiedHotWarmColdOptimizedTable({
            fullRegeneration: false
        });

        const totalTime = ((Date.now() - startTime) / 1000).toFixed(1);

        res.json({
            success: true,
            results: {
                missingTable: missingResult,
                statistics: statsResult,
                comboFeatures: comboResult,
                hwcOptimized: hwcResult
            },
            totalTime: `${totalTime}ç§’`
        });

    } catch (error) {
        res.status(500).json({ success: false, message: error.message });
    }
});
```

---

## å…­ã€å‰ç«¯UIä¿®æ”¹

### 6.1 æŒ‰é’®ä¿®æ”¹

**ä¿®æ”¹ä½ç½®**: `src/renderer/index.html` æˆ– `src/renderer/dlt-module.js`

**å½“å‰**:
```html
<button id="btn-update-hwc">æ›´æ–°çƒ­æ¸©å†·ä¼˜åŒ–è¡¨</button>
<button id="btn-update-hwc-incremental">å¢é‡æ›´æ–°çƒ­æ¸©å†·ä¼˜åŒ–è¡¨</button>
```

**ä¿®æ”¹ä¸º**:
```html
<button id="btn-unified-update-full">ä¸€é”®å…¨é‡æ›´æ–°æ•°æ®è¡¨</button>
<button id="btn-unified-update-incremental">ä¸€é”®å¢é‡æ›´æ–°æ•°æ®è¡¨</button>
```

### 6.2 è¿›åº¦æç¤º

å¢é‡æ›´æ–°æ—¶æ˜¾ç¤ºå„æ­¥éª¤è¿›åº¦ï¼š
```
ğŸ”„ ä¸€é”®å¢é‡æ›´æ–°æ•°æ®è¡¨
â”œâ”€ âœ… é—æ¼å€¼è¡¨: æ–°å¢13æ¡è®°å½•
â”œâ”€ âœ… statisticså­—æ®µ: æ–°å¢13æ¡è®°å½•
â”œâ”€ âœ… ç»„åˆç‰¹å¾è¡¨: æ–°å¢13æ¡è®°å½•
â”œâ”€ âœ… çƒ­æ¸©å†·ä¼˜åŒ–è¡¨: æ–°å¢22æ¡å·²å¼€å¥– + 1æ¡æ¨ç®—æœŸ(25138)
â””â”€ âœ… å®Œæˆ! æ€»è€—æ—¶: 42.5ç§’
```

---

## ä¸ƒã€æ–‡ä»¶ä¿®æ”¹æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¡Œæ•°ä¼°è®¡ |
|------|----------|----------|
| `src/server/server.js` | æ–°å¢ `incrementalUpdateMissingTables()` | +80è¡Œ |
| `src/server/server.js` | æ–°å¢ `incrementalUpdateStatistics()` | +50è¡Œ |
| `src/server/server.js` | æ–°å¢ `incrementalUpdateComboFeatures()` | +40è¡Œ |
| `src/server/server.js` | æ–°å¢ `analyzeDataGap()` | +30è¡Œ |
| `src/server/server.js` | æ–°å¢ `/api/dlt/unified-update-incremental` | +60è¡Œ |
| `src/renderer/dlt-module.js` | ä¿®æ”¹æŒ‰é’®è°ƒç”¨é€»è¾‘ | ~20è¡Œ |
| `src/renderer/index.html` | ä¿®æ”¹æŒ‰é’®æ–‡æ¡ˆ | ~5è¡Œ |

---

## å…«ã€æµ‹è¯•éªŒè¯

### 8.1 å¢é‡æ›´æ–°å‰æ£€æŸ¥
```bash
node diagnose-hwc-incremental.js
# é¢„æœŸ: æ˜¾ç¤ºå„è¡¨æ•°æ®å·®è·
```

### 8.2 æ‰§è¡Œå¢é‡æ›´æ–°
```bash
curl -X POST http://localhost:3003/api/dlt/unified-update-incremental
```

### 8.3 éªŒè¯ç»“æœ
```bash
# æ£€æŸ¥é—æ¼å€¼è¡¨
db.hit_dlt_basictrendchart_redballmissing_histories.find().sort({ID:-1}).limit(1)
# é¢„æœŸ: ID=2805

# æ£€æŸ¥çƒ­æ¸©å†·ä¼˜åŒ–è¡¨æ¨ç®—æœŸ
db.hit_dlt_redcombinationshotwarmcoldoptimizeds.findOne({'hit_analysis.is_drawn': false})
# é¢„æœŸ: target_issue="25138", base_issue="25137"
```

---

## ä¹ã€ç¡®è®¤äº‹é¡¹

è¯·ç¡®è®¤ä»¥ä¸‹å†…å®¹ï¼š

1. **æ¨ç®—æœŸé€»è¾‘**ï¼šæ¨ç®—æœŸæœŸå· = æœ€æ–°æœŸå·+1ï¼Œæ˜¯å¦ç¬¦åˆé¢„æœŸï¼Ÿ
2. **å¹¶è¡Œæ‰§è¡Œ**ï¼šstatisticså’Œç»„åˆç‰¹å¾è¡¨å¹¶è¡Œæ›´æ–°ï¼Œæ˜¯å¦å¯æ¥å—ï¼Ÿ
3. **æŒ‰é’®æ–‡æ¡ˆ**ï¼š"ä¸€é”®å…¨é‡æ›´æ–°æ•°æ®è¡¨" / "ä¸€é”®å¢é‡æ›´æ–°æ•°æ®è¡¨"
4. **è¿›åº¦æ˜¾ç¤º**ï¼šæ˜¯å¦éœ€è¦WebSocketå®æ—¶æ¨é€è¿›åº¦ï¼Ÿ

---

**ç¡®è®¤åæˆ‘å°†å¼€å§‹å®æ–½ä»£ç ä¿®æ”¹ã€‚**
