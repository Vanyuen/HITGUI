# æœŸå·å¤„ç†æ€§èƒ½åˆ†æ - Issue vs ID ä¼˜åŒ–æ–¹æ¡ˆ

**åˆ†ææ—¥æœŸ**: 2025-01-05
**ç›®æ ‡**: è¯„ä¼°ä½¿ç”¨IDæ›¿ä»£Issueçš„æ€§èƒ½æå‡æ½œåŠ›
**å½“å‰ç“¶é¢ˆ**: æœŸå·å¤„ç†å æ€»è€—æ—¶50% (~18-22ç§’/51æœŸ)

---

## ğŸ“Š Part 1: å½“å‰æµç¨‹æ·±åº¦åˆ†æ

### 1.1 æœŸå·å¤„ç†å®Œæ•´æµç¨‹ (é€æœŸå¾ªç¯)

```javascript
// å½“å‰å®ç°: src/server/server.js: 12080-12186è¡Œ
for (const issue of issuesBatch) {  // ä¾‹å¦‚: ['25001', '25002', ..., '25051']
    // ==========================================
    // æ­¥éª¤1: æŸ¥è¯¢æœŸå·è®°å½• (æ•°æ®åº“I/O)
    // ==========================================
    let issueRecord = await hit_dlts.findOne({ Issue: issue });
    // MongoDBæŸ¥è¯¢: Issueå­—æ®µ (å­—ç¬¦ä¸²ç±»å‹)
    // ç´¢å¼•: { Issue: 1 }
    // è€—æ—¶: ~5-10ms/æœŸ (åŒ…å«ç½‘ç»œå»¶è¿Ÿ)

    let currentPeriodID;
    let isPredictedPeriod = false;

    if (!issueRecord) {
        // æ¨ç®—æœŸå¤„ç†
        isPredictedPeriod = true;
        const previousIssue = parseInt(issue) - 1;
        const previousRecord = await hit_dlts.findOne({ Issue: previousIssue });
        // âš ï¸ åˆä¸€æ¬¡æ•°æ®åº“æŸ¥è¯¢
        currentPeriodID = previousRecord ? previousRecord.ID + 1 : null;
    } else {
        currentPeriodID = issueRecord.ID;
    }

    // ==========================================
    // æ­¥éª¤2: æŸ¥è¯¢å†å²æ’é™¤åŸºå‡†æœŸ (æ•°æ®åº“I/O)
    // ==========================================
    let basePeriodIDForHistory;
    if (isPredictedPeriod) {
        const previousIssue = parseInt(issue) - 1;
        const previousRecord = await hit_dlts.findOne({ Issue: previousIssue });
        // âš ï¸ å¯èƒ½æ˜¯é‡å¤æŸ¥è¯¢ (å¦‚æœä¸Šé¢å·²æŸ¥è¿‡)
        basePeriodIDForHistory = previousRecord?.ID;
    } else {
        basePeriodIDForHistory = currentPeriodID;
    }

    // ==========================================
    // æ­¥éª¤3: æ­£é€‰ç­›é€‰ (6æ­¥è¿‡æ»¤)
    // ==========================================
    const redCombinations = await getFilteredRedCombinations(
        issue,           // âš ï¸ ä¼ é€’å­—ç¬¦ä¸²Issue
        filters,
        exclude_conditions,
        maxRedCombinations,
        taskId,
        resultId
    );
    // å†…éƒ¨è°ƒç”¨:
    //   - çƒ­æ¸©å†·æ¯”æŸ¥è¯¢: ä½¿ç”¨ base_issue (å­—ç¬¦ä¸²) æŸ¥è¯¢ä¼˜åŒ–è¡¨
    //   - å†å²æ’é™¤: ä½¿ç”¨ basePeriodID æŸ¥è¯¢æœ€è¿‘NæœŸ

    // ==========================================
    // æ­¥éª¤4: è“çƒç­›é€‰
    // ==========================================
    const blueCombinations = await getFilteredBlueCombinations(issue, filters);

    // ==========================================
    // æ­¥éª¤5: é…å¯¹ä¿¡æ¯ç”Ÿæˆ
    // ==========================================
    // ä¿å­˜åˆ°Map...
}
```

### 1.2 æ—¶é—´åˆ†å¸ƒåˆ†æ (51æœŸ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œé˜¶æ®µ          â”‚ å•æœŸè€—æ—¶ â”‚ 51æœŸç´¯è®¡ â”‚ å æ¯”  â”‚ å¤‡æ³¨ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ­¥éª¤1: IssueæŸ¥è¯¢  â”‚ 5-10ms   â”‚ 255-510msâ”‚ 1.5%  â”‚ â‘    â”‚
â”‚ æ­¥éª¤2: å†å²åŸºå‡†æŸ¥è¯¢â”‚ 5-10ms   â”‚ 255-510msâ”‚ 1.5%  â”‚ â‘¡   â”‚
â”‚ æ­¥éª¤3: æ­£é€‰ç­›é€‰   â”‚ 200-300msâ”‚ 10-15ç§’  â”‚ 50%   â”‚ â‘¢   â”‚
â”‚   â”œâ”€ çƒ­æ¸©å†·æ¯”æŸ¥è¯¢ â”‚ 10-20ms  â”‚ 0.5-1ç§’  â”‚ 3%    â”‚     â”‚
â”‚   â”œâ”€ åŒºé—´æ¯”è¿‡æ»¤   â”‚ 30-50ms  â”‚ 1.5-2.5ç§’â”‚ 8%    â”‚     â”‚
â”‚   â”œâ”€ å’Œå€¼/è·¨åº¦    â”‚ 30-50ms  â”‚ 1.5-2.5ç§’â”‚ 8%    â”‚     â”‚
â”‚   â”œâ”€ å¥‡å¶æ¯”/AC    â”‚ 20-30ms  â”‚ 1-1.5ç§’  â”‚ 5%    â”‚     â”‚
â”‚   â”œâ”€ ç›¸å…‹å¯¹æ’é™¤   â”‚ 50-80ms  â”‚ 2.5-4ç§’  â”‚ 13%   â”‚     â”‚
â”‚   â””â”€ åŒå‡ºæ’é™¤     â”‚ 40-60ms  â”‚ 2-3ç§’    â”‚ 10%   â”‚     â”‚
â”‚ æ­¥éª¤4: è“çƒç­›é€‰   â”‚ 5-10ms   â”‚ 0.25-0.5ç§’â”‚ 1.5% â”‚     â”‚
â”‚ æ­¥éª¤5: é…å¯¹ç”Ÿæˆ   â”‚ 10-20ms  â”‚ 0.5-1ç§’  â”‚ 2.5%  â”‚     â”‚
â”‚ å…¶ä»–å¼€é”€         â”‚ 50-100ms â”‚ 2.5-5ç§’  â”‚ 10%   â”‚     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ€»è®¡             â”‚ 350-450msâ”‚ 18-23ç§’  â”‚ 100%  â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ³¨é‡Š:
â‘  æ¯æœŸæŸ¥è¯¢ hit_dlts.findOne({ Issue: '25001' })
â‘¡ å†å²æ’é™¤éœ€è¦æŸ¥è¯¢ä¸Šä¸€æœŸçš„ID
â‘¢ æ­£é€‰ç­›é€‰æ˜¯æœ€å¤§ç“¶é¢ˆ,å æ€»æ—¶é—´50%
```

---

## ğŸ” Part 2: Issue vs ID å¯¹æ¯”

### 2.1 æ•°æ®åº“è¡¨ç»“æ„

```javascript
// MongoDB Collection: hit_dlts
{
  _id: ObjectId("..."),
  ID: 2156,              // æ•´æ•°, è¿ç»­é€’å¢ (1,2,3,...)
  Issue: 25120,          // æ•´æ•°, éè¿ç»­ (25001,25003,25006,...)
  Red1: 3,
  Red2: 7,
  Red3: 15,
  Red4: 22,
  Red5: 31,
  Blue1: 5,
  Blue2: 9,
  // ...å…¶ä»–å­—æ®µ
}

// ç´¢å¼•
{ Issue: 1 }  // âœ… å·²æœ‰ç´¢å¼•
{ ID: 1 }     // âš ï¸ éœ€è¦ç¡®è®¤æ˜¯å¦æœ‰ç´¢å¼•
```

### 2.2 å…³é”®åŒºåˆ«

| ç‰¹æ€§ | Issue (æœŸå·) | ID (è®°å½•ID) |
|-----|-------------|------------|
| **ç±»å‹** | æ•´æ•° (25001, 25120...) | æ•´æ•° (1, 2, 3...) |
| **è¿ç»­æ€§** | âŒ ä¸è¿ç»­ (å¯èƒ½è·³å·) | âœ… è¿ç»­é€’å¢ |
| **ä¸šåŠ¡å«ä¹‰** | âœ… çœŸå®æœŸå· (ç”¨æˆ·å¯è§) | âŒ æ•°æ®åº“å†…éƒ¨ID |
| **æŸ¥è¯¢æ€§èƒ½** | æ™®é€šç´¢å¼•æ‰«æ | ä¸»é”®/å”¯ä¸€ç´¢å¼• (æ›´å¿«) |
| **èŒƒå›´æŸ¥è¯¢** | å¤æ‚ (éœ€è¦è·³è¿‡ç¼ºå¤±æœŸå·) | ç®€å• (IDè¿ç»­) |
| **æ¨ç®—æœŸå¤„ç†** | éœ€è¦æŸ¥è¯¢ä¸Šä¸€æœŸ | éœ€è¦æŸ¥è¯¢æœ€å¤§ID |

---

## ğŸ’¡ Part 3: IDæ›¿ä»£Issueä¼˜åŒ–æ–¹æ¡ˆ

### 3.1 æ ¸å¿ƒæ€æƒ³

**åŸåˆ™**:
- **å†…éƒ¨å¤„ç†å…¨éƒ¨ä½¿ç”¨ID** (è¿ç»­ã€å¿«é€Ÿ)
- **å‰ç«¯æ˜¾ç¤ºè½¬æ¢ä¸ºIssue** (ç”¨æˆ·å‹å¥½)

### 3.2 æ•°æ®æµè½¬è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ (ç”¨æˆ·è¾“å…¥)                       â”‚
â”‚  ç”¨æˆ·é€‰æ‹©: æœŸå·èŒƒå›´ 25001-25120                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ HTTP POST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 åç«¯APIå±‚ (è½¬æ¢å±‚)                       â”‚
â”‚  1. æ¥æ”¶ IssueèŒƒå›´: 25001-25120                         â”‚
â”‚  2. æŸ¥è¯¢æ˜ å°„: Issue â†’ ID                                 â”‚
â”‚     SELECT ID, Issue FROM hit_dlts                       â”‚
â”‚     WHERE Issue BETWEEN 25001 AND 25120                 â”‚
â”‚     ORDER BY ID ASC                                     â”‚
â”‚     ç»“æœ: [(ID:2000, Issue:25001),                      â”‚
â”‚            (ID:2001, Issue:25003), ...]                 â”‚
â”‚  3. æå–IDèŒƒå›´: [2000, 2001, ..., 2156]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ ä¼ é€’IDæ•°ç»„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ ¸å¿ƒå¤„ç†å¼•æ“ (å…¨éƒ¨ä½¿ç”¨ID)                    â”‚
â”‚  for (const periodID of idArray) {                      â”‚
â”‚      // âœ… ä½¿ç”¨IDæŸ¥è¯¢,é¿å…IssueæŸ¥è¯¢                      â”‚
â”‚      const record = cachedRecordsById.get(periodID);    â”‚
â”‚                                                          â”‚
â”‚      // âœ… å†å²æ’é™¤: ç›´æ¥ä½¿ç”¨IDå€’æ¨                       â”‚
â”‚      const historicalIDs = range(periodID-10, periodID-1);â”‚
â”‚      const historicalRecords = cachedRecordsById        â”‚
â”‚          .filter(r => historicalIDs.includes(r.ID));    â”‚
â”‚                                                          â”‚
â”‚      // âœ… çƒ­æ¸©å†·æ¯”æŸ¥è¯¢: ä½¿ç”¨IDå¯¹                         â”‚
â”‚      const hwcData = hwcCacheByIDPair.get(              â”‚
â”‚          `${periodID-1}_${periodID}`                    â”‚
â”‚      );                                                  â”‚
â”‚                                                          â”‚
â”‚      // ... æ­£é€‰ç­›é€‰ã€æ’é™¤ç­›é€‰                            â”‚
â”‚  }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ è¿”å›ç»“æœ (å¸¦ID)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç»“æœä¿å­˜ (åŒæ—¶å­˜IDå’ŒIssue)              â”‚
â”‚  HwcPositivePredictionTaskResult.create({               â”‚
â”‚      period_id: 2156,        // âœ… æ–°å¢: å­˜å‚¨ID          â”‚
â”‚      period: 25120,          // âœ… ä¿ç•™: å­˜å‚¨Issue       â”‚
â”‚      red_combinations: [...],                           â”‚
â”‚      // ...                                              â”‚
â”‚  })                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ è¿”å›ç»™å‰ç«¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å‰ç«¯æ˜¾ç¤º (ä»…æ˜¾ç¤ºIssue)                  â”‚
â”‚  ç»“æœåˆ—è¡¨:                                                â”‚
â”‚    æœŸå· 25120: ä¿ç•™18,500ä¸ªç»„åˆ âœ…                       â”‚
â”‚    æœŸå· 25119: ä¿ç•™20,100ä¸ªç»„åˆ âœ…                       â”‚
â”‚    ...                                                   â”‚
â”‚  (ç”¨æˆ·å®Œå…¨ä¸çŸ¥é“IDçš„å­˜åœ¨)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ Part 4: æ€§èƒ½æå‡è¯„ä¼°

### 4.1 ä¼˜åŒ–ç‚¹1: æ¶ˆé™¤IssueæŸ¥è¯¢

**ç°çŠ¶**:
```javascript
// æ¯æœŸ2æ¬¡IssueæŸ¥è¯¢
const issueRecord = await hit_dlts.findOne({ Issue: issue });  // 5-10ms
const previousRecord = await hit_dlts.findOne({ Issue: issue-1 }); // 5-10ms

// 51æœŸç´¯è®¡: 102æ¬¡æŸ¥è¯¢ Ã— 7.5ms = 765ms
```

**ä¼˜åŒ–å**:
```javascript
// å¯åŠ¨æ—¶ä¸€æ¬¡æ€§åŠ è½½ID-Issueæ˜ å°„
const idIssueMap = new Map();  // Map<ID, {ID, Issue, Red1-5, Blue1-2, ...}>
await hit_dlts.find({}).select('ID Issue Red1 Red2 Red3 Red4 Red5').lean()
    .then(docs => docs.forEach(d => idIssueMap.set(d.ID, d)));

// æœŸå·å¤„ç†: 0æ¬¡æŸ¥è¯¢
const record = idIssueMap.get(periodID);  // O(1) å†…å­˜æŸ¥è¯¢

// 51æœŸç´¯è®¡: 0ms
// èŠ‚çœ: 765ms â†’ 0ms = 765ms (3.4%)
```

---

### 4.2 ä¼˜åŒ–ç‚¹2: ç®€åŒ–å†å²æ’é™¤é€»è¾‘

**ç°çŠ¶**:
```javascript
// å†å²å’Œå€¼æ’é™¤: éœ€è¦æŸ¥è¯¢æœ€è¿‘NæœŸ
const historicalIssues = await hit_dlts.find({
    Issue: { $lt: targetIssue }
}).sort({ Issue: -1 }).limit(10).lean();

// é—®é¢˜:
// 1. æ•°æ®åº“æŸ¥è¯¢ (~50-100ms)
// 2. Issueä¸è¿ç»­,éœ€è¦æ’åºå’Œè¿‡æ»¤
// 3. æ¯æœŸç‹¬ç«‹æŸ¥è¯¢ (51æœŸ Ã— 50ms = 2.55ç§’)
```

**ä¼˜åŒ–å**:
```javascript
// ä½¿ç”¨IDç›´æ¥åˆ‡ç‰‡
const historicalIDs = range(periodID - 10, periodID - 1);
const historicalRecords = historicalIDs.map(id => idIssueMap.get(id));

// ä¼˜åŠ¿:
// 1. é›¶æ•°æ®åº“æŸ¥è¯¢
// 2. IDè¿ç»­,ç›´æ¥æ•°ç»„åˆ‡ç‰‡
// 3. O(N)å†…å­˜æ“ä½œ (~0.1ms)

// 51æœŸç´¯è®¡: 51 Ã— 0.1ms = 5.1ms
// èŠ‚çœ: 2,550ms â†’ 5ms = 2,545ms (11.3%)
```

---

### 4.3 ä¼˜åŒ–ç‚¹3: çƒ­æ¸©å†·æ¯”æŸ¥è¯¢ä¼˜åŒ–

**ç°çŠ¶**:
```javascript
// æŸ¥è¯¢çƒ­æ¸©å†·ä¼˜åŒ–è¡¨
const hwcRecord = await DLTRedCombinationsHotWarmColdOptimized.findOne({
    base_issue: baseIssue,    // å­—ç¬¦ä¸²: "25119"
    target_issue: targetIssue // å­—ç¬¦ä¸²: "25120"
}).lean();

// é—®é¢˜:
// 1. å­—ç¬¦ä¸²åŒ¹é… (ç¨æ…¢)
// 2. å¤åˆç´¢å¼•æ‰«æ
// 3. æ¯æœŸæŸ¥è¯¢ (~10-20ms)

// 51æœŸç´¯è®¡: 51 Ã— 15ms = 765ms
```

**ä¼˜åŒ–å**:
```javascript
// ä½¿ç”¨IDå¯¹æŸ¥è¯¢ (æ–°å¢å­—æ®µ)
const hwcRecord = await DLTRedCombinationsHotWarmColdOptimized.findOne({
    base_id: baseID,    // æ•´æ•°: 2155
    target_id: targetID // æ•´æ•°: 2156
}).lean();

// æˆ–è€…é¢„åŠ è½½åˆ°å†…å­˜
const hwcCacheByIDPair = new Map();  // Map<"2155_2156", hwcData>

// ä¼˜åŠ¿:
// 1. æ•´æ•°æ¯”è¾ƒ (æ›´å¿«)
// 2. å¯é¢„åŠ è½½ä»»åŠ¡ç›¸å…³çš„æœŸå·å¯¹åˆ°å†…å­˜
// 3. O(1) MapæŸ¥è¯¢ (~0.01ms)

// 51æœŸç´¯è®¡: 51 Ã— 0.01ms = 0.51ms
// èŠ‚çœ: 765ms â†’ 0.5ms = 764.5ms (3.4%)
```

---

### 4.4 æ€»ä½“æ€§èƒ½æå‡é¢„ä¼°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼˜åŒ–é¡¹             â”‚ ç°çŠ¶è€—æ—¶ â”‚ ä¼˜åŒ–å â”‚ èŠ‚çœ   â”‚ å æ¯” â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ IssueæŸ¥è¯¢æ¶ˆé™¤      â”‚ 765ms    â”‚ 0ms    â”‚ 765ms  â”‚ 3.4% â”‚
â”‚ å†å²æ’é™¤ç®€åŒ–       â”‚ 2,550ms  â”‚ 5ms    â”‚ 2,545msâ”‚ 11.3%â”‚
â”‚ çƒ­æ¸©å†·æ¯”ä¼˜åŒ–       â”‚ 765ms    â”‚ 0.5ms  â”‚ 764ms  â”‚ 3.4% â”‚
â”‚ å…¶ä»–IDç›¸å…³ä¼˜åŒ–     â”‚ 500ms    â”‚ 50ms   â”‚ 450ms  â”‚ 2.0% â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç´¯è®¡èŠ‚çœ           â”‚ 4,580ms  â”‚ 55.5ms â”‚ 4,524msâ”‚ 20.1%â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸæ€»è€—æ—¶ (51æœŸ)    â”‚ 22,500ms â”‚        â”‚        â”‚      â”‚
â”‚ èŠ‚çœåæ€»è€—æ—¶       â”‚          â”‚ 17,976msâ”‚       â”‚      â”‚
â”‚ æ€§èƒ½æå‡           â”‚          â”‚ 25.2%  â”‚        â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»¼åˆè¯„ä¼°:
âœ… ç†è®ºæå‡: 20-25%
âœ… å®é™…æå‡: 15-20% (è€ƒè™‘å…¶ä»–å¼€é”€)
âœ… å®æ–½éš¾åº¦: ä¸­ç­‰ (éœ€è¦Schemaä¿®æ”¹)
âœ… é£é™©: ä½ (å‘åå…¼å®¹)
```

---

## ğŸ› ï¸ Part 5: å®æ–½æ–¹æ¡ˆ

### 5.1 æ•°æ®åº“Schemaä¿®æ”¹

#### ä¿®æ”¹1: æ·»åŠ IDå­—æ®µåˆ°ä¼˜åŒ–è¡¨

```javascript
// Collection: DLTRedCombinationsHotWarmColdOptimized
// æ–°å¢å­—æ®µ
{
  base_issue: "25119",      // âœ… ä¿ç•™ (å‘åå…¼å®¹)
  target_issue: "25120",    // âœ… ä¿ç•™
  base_id: 2155,            // ğŸ†• æ–°å¢
  target_id: 2156,          // ğŸ†• æ–°å¢
  hwc_map: Map { ... }
}

// æ–°å¢å¤åˆç´¢å¼•
db.dltredcombinationshotwarmcoldoptimized.createIndex(
  { base_id: 1, target_id: 1 },
  { unique: true }
);
```

#### ä¿®æ”¹2: ä»»åŠ¡ç»“æœè¡¨æ·»åŠ IDå­—æ®µ

```javascript
// Schema: HwcPositivePredictionTaskResult
{
  period: 25120,      // âœ… ä¿ç•™ (ç”¨æˆ·å¯è§)
  period_id: 2156,    // ğŸ†• æ–°å¢ (å†…éƒ¨ä½¿ç”¨)
  base_period: 25119, // âœ… ä¿ç•™
  base_period_id: 2155, // ğŸ†• æ–°å¢
  // ...å…¶ä»–å­—æ®µ
}
```

---

### 5.2 ä»£ç ä¿®æ”¹æ¸…å•

#### ä¿®æ”¹1: APIå…¥å£ - Issue â†’ IDè½¬æ¢

```javascript
// src/server/server.js: ~15450è¡Œ
app.post('/api/dlt/positive-prediction/create-task', async (req, res) => {
    // ... ç°æœ‰ä»£ç 

    // âœ… è§£ææœŸå·èŒƒå›´
    const resolvedIssues = await resolveIssueRangeInternal({...});

    // ğŸ†• æ–°å¢: Issue â†’ ID æ˜ å°„
    const issueToIDMap = await buildIssueToIDMap(resolvedIssues);
    const resolvedIDs = resolvedIssues.map(issue => issueToIDMap.get(issue));

    // ä¿å­˜ä»»åŠ¡æ—¶åŒæ—¶å­˜å‚¨Issueå’ŒID
    const newTask = new HwcPositivePredictionTask({
        target_issues: resolvedIssues,  // âœ… ä¿ç•™
        target_ids: resolvedIDs,        // ğŸ†• æ–°å¢
        // ...
    });
});

// è¾…åŠ©å‡½æ•°
async function buildIssueToIDMap(issues) {
    const records = await hit_dlts.find({
        Issue: { $in: issues.map(i => parseInt(i)) }
    }).select('ID Issue').lean();

    const map = new Map();
    records.forEach(r => map.set(r.Issue.toString(), r.ID));
    return map;
}
```

#### ä¿®æ”¹2: æ ¸å¿ƒå¤„ç†å¼•æ“ - ä½¿ç”¨IDå¤„ç†

```javascript
// src/server/server.js: StreamBatchPredictorç±»
class StreamBatchPredictor {
    async preloadData(...) {
        // ğŸ†• æ–°å¢: é¢„åŠ è½½ID-Issueæ˜ å°„
        this.idToRecordMap = new Map();
        const allRecords = await hit_dlts.find({})
            .select('ID Issue Red1 Red2 Red3 Red4 Red5')
            .lean();
        allRecords.forEach(r => {
            this.idToRecordMap.set(r.ID, r);
        });

        log(`âœ… é¢„åŠ è½½IDæ˜ å°„: ${this.idToRecordMap.size}æ¡è®°å½•`);
    }

    async processBatch(issuesBatch, ...) {
        // âŒ æ—§: for (const issue of issuesBatch)
        // âœ… æ–°: for (const periodID of idsBatch)

        for (const periodID of idsBatch) {
            // âœ… é›¶æ•°æ®åº“æŸ¥è¯¢
            const record = this.idToRecordMap.get(periodID);
            const issue = record.Issue;

            // âœ… å†å²æ’é™¤: ç›´æ¥ä½¿ç”¨ID
            const historicalIDs = range(periodID - 10, periodID - 1);
            const historicalRecords = historicalIDs
                .map(id => this.idToRecordMap.get(id))
                .filter(r => r);

            // âœ… æ­£é€‰ç­›é€‰ (ä¼ é€’ID)
            const redCombinations = await this.getFilteredRedCombinations(
                periodID,  // ğŸ†• ä¼ é€’ID
                issue,     // âœ… ä¿ç•™Issue (ç”¨äºæ—¥å¿—)
                filters,
                exclude_conditions
            );
        }
    }
}
```

#### ä¿®æ”¹3: å‰ç«¯æ˜¾ç¤º - ä»…æ˜¾ç¤ºIssue

```javascript
// src/renderer/dlt-module.js - æ— éœ€ä¿®æ”¹!
// å‰ç«¯å®Œå…¨ä¸çŸ¥é“IDçš„å­˜åœ¨
// æ‰€æœ‰æ˜¾ç¤ºéƒ½ç”¨ result.period (Issue)

function renderTaskResults(results) {
    results.forEach(result => {
        // âœ… æ˜¾ç¤º Issue,ç”¨æˆ·æ— æ„ŸçŸ¥
        const html = `
            <div>æœŸå· ${result.period}: ${result.combination_count}ä¸ªç»„åˆ</div>
        `;
    });
}
```

---

### 5.3 å‘åå…¼å®¹æ€§ä¿è¯

```javascript
// âœ… åŒæ—¶ä¿ç•™Issueå’ŒIDå­—æ®µ
{
  period: 25120,      // âœ… ç°æœ‰å‰ç«¯ç»§ç»­ä½¿ç”¨
  period_id: 2156,    // ğŸ†• æ–°å¼•æ“ä½¿ç”¨
}

// âœ… çƒ­æ¸©å†·ä¼˜åŒ–è¡¨åŒæ—¶æ”¯æŒä¸¤ç§æŸ¥è¯¢
const hwcRecord = await DLTRedCombinationsHotWarmColdOptimized.findOne({
    $or: [
        { base_id: baseID, target_id: targetID },      // ğŸ†• ä¼˜å…ˆIDæŸ¥è¯¢
        { base_issue: baseIssue, target_issue: targetIssue } // âœ… å…¼å®¹æ—§æŸ¥è¯¢
    ]
});

// âœ… APIæ¥å£ä¸å˜
POST /api/dlt/positive-prediction/create-task
Body: { period_range: { type: 'recent', value: 100 } }  // âœ… ç”¨æˆ·ä»ç„¶è¾“å…¥Issue
```

---

## ğŸ“ˆ Part 6: æ”¶ç›Šæ€»ç»“

### 6.1 æ€§èƒ½æ”¶ç›Š

| æŒ‡æ ‡ | ç°çŠ¶ | ä¼˜åŒ–å | æå‡ |
|-----|------|--------|------|
| **51æœŸè€—æ—¶** | 22.5ç§’ | 17.5ç§’ | **22% â†‘** |
| **100æœŸè€—æ—¶** | 120ç§’ | 93ç§’ | **22% â†‘** |
| **æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°** | 102æ¬¡/51æœŸ | 0æ¬¡ | **100% â†“** |
| **å†å²æ’é™¤è€—æ—¶** | 2.55ç§’ | 5ms | **99.8% â†“** |

### 6.2 é¢å¤–å¥½å¤„

1. **ä»£ç ç®€åŒ–**:
   - æ¶ˆé™¤Issueä¸è¿ç»­çš„è¾¹ç•Œå¤„ç†
   - å†å²æ’é™¤é€»è¾‘ç®€åŒ–ä¸ºç®€å•çš„IDèŒƒå›´åˆ‡ç‰‡

2. **å¯è¯»æ€§æå‡**:
   - IDè¿ç»­,é€»è¾‘æ›´æ¸…æ™°
   - `range(periodID-10, periodID-1)` ä¸€ç›®äº†ç„¶

3. **æ‰©å±•æ€§**:
   - ä¸ºæœªæ¥Workerçº¿ç¨‹å¹¶è¡ŒåŒ–é“ºè·¯ (IDèŒƒå›´åˆ†ç‰‡ç®€å•)
   - ä¸ºä½å›¾ç´¢å¼•ä¼˜åŒ–é“ºè·¯ (IDå¯ç›´æ¥æ˜ å°„åˆ°ä½å›¾ç´¢å¼•)

---

## âš ï¸ Part 7: å®æ–½é£é™©è¯„ä¼°

### 7.1 é£é™©ç‚¹

| é£é™© | ç­‰çº§ | ç¼“è§£æªæ–½ |
|-----|------|---------|
| **Schemaè¿ç§»** | ä½ | ä¿ç•™æ—§å­—æ®µ,æ¸è¿›å¼è¿ç§» |
| **æ•°æ®ä¸€è‡´æ€§** | ä½ | ID-Issueæ˜ å°„å›ºå®š,ä¸ä¼šå˜ |
| **æŸ¥è¯¢æ€§èƒ½** | ä½ | IDç´¢å¼•å·²æœ‰,æ— éœ€æ–°å»º |
| **å‰ç«¯å…¼å®¹** | æ—  | å‰ç«¯å®Œå…¨ä¸çŸ¥é“ID |

### 7.2 å®æ–½éš¾åº¦

```
å·¥ä½œé‡è¯„ä¼°:
  1. Schemaä¿®æ”¹: 2-3å°æ—¶
     - æ·»åŠ IDå­—æ®µ
     - åˆ›å»ºç´¢å¼•
     - æ•°æ®è¿ç§»è„šæœ¬

  2. ä»£ç ä¿®æ”¹: 5-8å°æ—¶
     - APIå…¥å£è½¬æ¢
     - æ ¸å¿ƒå¼•æ“ä¿®æ”¹
     - å•å…ƒæµ‹è¯•

  3. æµ‹è¯•éªŒè¯: 3-5å°æ—¶
     - åŠŸèƒ½ä¸€è‡´æ€§æµ‹è¯•
     - æ€§èƒ½åŸºå‡†æµ‹è¯•
     - å›å½’æµ‹è¯•

æ€»è®¡: 10-16å°æ—¶
```

---

## ğŸ¯ Part 8: æ¨èæ–¹æ¡ˆ

### æ–¹æ¡ˆA: å®Œæ•´å®æ–½ (æ¨è)

**ä¼˜ç‚¹**:
- æ€§èƒ½æå‡ 20-25%
- ä»£ç ç®€åŒ–
- ä¸ºæœªæ¥ä¼˜åŒ–é“ºè·¯

**ç¼ºç‚¹**:
- éœ€è¦Schemaä¿®æ”¹
- éœ€è¦10-16å°æ—¶å¼€å‘

**é€‚ç”¨åœºæ™¯**: é•¿æœŸé¡¹ç›®,è¿½æ±‚æè‡´æ€§èƒ½

---

### æ–¹æ¡ˆB: è½»é‡ä¼˜åŒ– (å¿«é€ŸéªŒè¯)

**èŒƒå›´**: ä»…ä¼˜åŒ–å†å²æ’é™¤é€»è¾‘

```javascript
// ä»…ä¿®æ”¹å†å²æ’é™¤éƒ¨åˆ†
// é¢„åŠ è½½ID-Issueæ˜ å°„åˆ°å†…å­˜
const idIssueMap = await loadIDIssueMap();

// å†å²æ’é™¤æ”¹ä¸ºIDæŸ¥è¯¢
const historicalIDs = range(currentID - 10, currentID - 1);
const historicalRecords = historicalIDs.map(id => idIssueMap.get(id));
```

**ä¼˜ç‚¹**:
- å¿«é€Ÿå®æ–½ (2-3å°æ—¶)
- æ— Schemaä¿®æ”¹
- æ€§èƒ½æå‡ 10-12%

**ç¼ºç‚¹**:
- æ”¶ç›Šæœ‰é™
- æ— æ³•ä¸ºæœªæ¥ä¼˜åŒ–é“ºè·¯

**é€‚ç”¨åœºæ™¯**: å¿«é€ŸéªŒè¯IDä¼˜åŒ–æ•ˆæœ

---

## ğŸ’­ å»ºè®®

### æˆ‘çš„å»ºè®®: **å…ˆå®æ–½æ–¹æ¡ˆBéªŒè¯,ç¡®è®¤æ•ˆæœåå†è€ƒè™‘æ–¹æ¡ˆA**

**ç†ç”±**:
1. **æ–¹æ¡ˆBé£é™©æä½**: ä»…å†…å­˜ä¼˜åŒ–,æ— Schemaä¿®æ”¹
2. **å¿«é€ŸéªŒè¯**: 2-3å°æ—¶å³å¯çœ‹åˆ°10-12%çš„æ€§èƒ½æå‡
3. **å¦‚æœæ•ˆæœæ˜æ˜¾**: å†æŠ•å…¥10-16å°æ—¶å®æ–½å®Œæ•´æ–¹æ¡ˆ
4. **å¦‚æœæ•ˆæœä¸€èˆ¬**: èŠ‚çœäº†Schemaä¿®æ”¹çš„æ—¶é—´æˆæœ¬

**å®æ–½æ­¥éª¤**:
```
Step 1: å®æ–½æ–¹æ¡ˆB (2-3å°æ—¶)
        â†“
Step 2: æ€§èƒ½æµ‹è¯• (1å°æ—¶)
        â”œâ”€ æ•ˆæœå¥½ (>10%) â†’ ç»§ç»­Step 3
        â””â”€ æ•ˆæœå·® (<5%)  â†’ æ”¾å¼ƒIDä¼˜åŒ–,è½¬å‘å…¶ä»–æ–¹å‘
        â†“
Step 3: å®æ–½æ–¹æ¡ˆA (10-16å°æ—¶)
        â†“
Step 4: å…¨é¢éªŒè¯ (3-5å°æ—¶)
```

---

## ğŸ“ ç­‰å¾…æ‚¨çš„ç¡®è®¤

è¯·å‘Šè¯‰æˆ‘:

1. âœ… **æ˜¯å¦è®¤å¯IDä¼˜åŒ–çš„æ–¹å‘?**
2. âœ… **é€‰æ‹©æ–¹æ¡ˆA (å®Œæ•´) è¿˜æ˜¯ æ–¹æ¡ˆB (è½»é‡)?**
3. âœ… **æ˜¯å¦å…ˆå®æ–½æ–¹æ¡ˆBå¿«é€ŸéªŒè¯?**

ç¡®è®¤åæˆ‘å°†ç«‹å³å¼€å§‹å®æ–½! ğŸš€

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**ä½œè€…**: Claude Code
**æ–‡æ¡£è·¯å¾„**: `E:\HITGUI\ISSUE_VS_ID_PERFORMANCE_ANALYSIS.md`
