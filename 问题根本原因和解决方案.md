# çƒ­æ¸©å†·æ­£é€‰æ‰¹é‡é¢„æµ‹ä¼˜åŒ– - é—®é¢˜æ ¹æœ¬åŸå› å’Œè§£å†³æ–¹æ¡ˆ

## ğŸ¯ é—®é¢˜æ€»ç»“

**ç°è±¡**ï¼šä¿®æ”¹äº†`src/server/server.js`ä¸­çš„ä¼˜åŒ–ä»£ç ï¼ˆHwcPositivePredictorç±»å’ŒprocessHwcPositiveTaskå‡½æ•°ï¼‰ï¼Œä½†é‡å¯åº”ç”¨åä»ç„¶æ‰§è¡Œæ—§ä»£ç ã€‚

**æ ¹æœ¬åŸå› **ï¼š**Node.jsçš„require()æ¨¡å—ç¼“å­˜æœºåˆ¶**

## ğŸ” è¯¦ç»†åˆ†æ

### Node.js require()ç¼“å­˜æœºåˆ¶

Node.jsä¸ºäº†æ€§èƒ½ä¼˜åŒ–ï¼Œä¼šç¼“å­˜æ‰€æœ‰é€šè¿‡`require()`åŠ è½½çš„æ¨¡å—ã€‚è¿™æ„å‘³ç€ï¼š

1. **ç¬¬ä¸€æ¬¡åŠ è½½**ï¼š`require('./src/server/server.js')` â†’ è¯»å–æ–‡ä»¶ï¼Œæ‰§è¡Œä»£ç ï¼Œç¼“å­˜åˆ°`require.cache`
2. **åç»­åŠ è½½**ï¼š`require('./src/server/server.js')` â†’ **ç›´æ¥ä»ç¼“å­˜è¿”å›**ï¼Œä¸è¯»å–æ–‡ä»¶

### åœ¨Electronåº”ç”¨ä¸­çš„è¡¨ç°

åœ¨`main.js:190`ï¼ˆæ—§ç‰ˆï¼‰:
```javascript
// å¯¼å…¥æœåŠ¡å™¨ä»£ç 
const serverModule = require('./src/server/server.js');
```

**æµç¨‹**ï¼š
1. ç”¨æˆ·ç¬¬ä¸€æ¬¡å¯åŠ¨åº”ç”¨ â†’ requireåŠ è½½server.js â†’ ç¼“å­˜æ—§ä»£ç 
2. æˆ‘ä»¬ä¿®æ”¹server.jsæºæ–‡ä»¶ â†’ æ·»åŠ ä¼˜åŒ–ä»£ç 
3. ç”¨æˆ·å…³é—­å¹¶é‡å¯åº”ç”¨ â†’ requireä»ç¼“å­˜è¿”å›æ—§ä»£ç  â†’ **ä¼˜åŒ–ä»£ç æœªè¢«åŠ è½½**

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹å†…å®¹

**æ–‡ä»¶**ï¼š`main.js`
**ä½ç½®**ï¼šç¬¬182-199è¡Œï¼ˆæ–°ç‰ˆï¼‰

**ä¿®æ”¹å‰**ï¼š
```javascript
async function startInternalServer() {
  return new Promise(async (resolve, reject) => {
    try {
      // é¦–å…ˆåˆå§‹åŒ–æ•°æ®åº“
      await dbManager.initialize(app.getPath('userData'));

      // å¯¼å…¥æœåŠ¡å™¨ä»£ç 
      const serverModule = require('./src/server/server.js');
```

**ä¿®æ”¹å**ï¼š
```javascript
async function startInternalServer() {
  return new Promise(async (resolve, reject) => {
    try {
      // é¦–å…ˆåˆå§‹åŒ–æ•°æ®åº“
      await dbManager.initialize(app.getPath('userData'));

      // ğŸ”¥ æ¸…é™¤server.jsçš„requireç¼“å­˜ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
      if (isDev) {
        const serverPath = path.resolve(__dirname, 'src/server/server.js');
        if (require.cache[serverPath]) {
          console.log('ğŸ§¹ æ¸…é™¤server.jsçš„requireç¼“å­˜...');
          delete require.cache[serverPath];
        }
      }

      // å¯¼å…¥æœåŠ¡å™¨ä»£ç 
      const serverModule = require('./src/server/server.js');
```

### å·¥ä½œåŸç†

1. **æ£€æµ‹å¼€å‘æ¨¡å¼**ï¼š`if (isDev)` - åªåœ¨å¼€å‘æ¨¡å¼ä¸‹æ¸…é™¤ç¼“å­˜ï¼Œç”Ÿäº§ç¯å¢ƒä¿æŒç¼“å­˜æå‡æ€§èƒ½
2. **æ¸…é™¤ç¼“å­˜**ï¼š`delete require.cache[serverPath]` - å¼ºåˆ¶Node.jsé‡æ–°è¯»å–server.js
3. **é‡æ–°åŠ è½½**ï¼š`require()` - åŠ è½½æœ€æ–°çš„ä»£ç ï¼ˆåŒ…å«ä¼˜åŒ–ï¼‰

## ğŸ“‹ å®Œæ•´ä¿®æ”¹æ¸…å•

### 1. ä¼˜åŒ–ä»£ç å®ç°ï¼ˆå·²å®Œæˆï¼‰âœ…

| æ–‡ä»¶ | ä½ç½® | å†…å®¹ | è¡Œæ•° |
|-----|------|------|------|
| `src/server/server.js` | 14265-14777 | HwcPositivePredictorç±» | 513è¡Œ |
| `src/server/server.js` | 16133-16273 | processHwcPositiveTaskå‡½æ•°ï¼ˆä¼˜åŒ–ç‰ˆï¼‰ | 131è¡Œ |
| `processHwcPositiveTask_backup.txt` | - | æ—§ä»£ç å¤‡ä»½ | 386è¡Œ |

### 2. ç¼“å­˜æ¸…ç†é€»è¾‘ï¼ˆå·²å®Œæˆï¼‰âœ…

| æ–‡ä»¶ | ä½ç½® | å†…å®¹ | è¡Œæ•° |
|-----|------|------|------|
| `main.js` | 189-196 | requireç¼“å­˜æ¸…ç†é€»è¾‘ | 8è¡Œ |

### 3. è¯Šæ–­å·¥å…·ï¼ˆå·²åˆ›å»ºï¼‰âœ…

| æ–‡ä»¶ | ç”¨é€” |
|-----|------|
| `test-hwc-predictor-load.js` | éªŒè¯ä¼˜åŒ–ä»£ç æ˜¯å¦å­˜åœ¨äºæºæ–‡ä»¶ |
| `clear-cache-and-restart.js` | æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ï¼ˆå¤‡ç”¨ï¼‰ |
| `ä¼˜åŒ–éªŒè¯æŒ‡å—.md` | å®Œæ•´çš„éªŒè¯æ­¥éª¤å’Œæ•…éšœæ’æŸ¥æŒ‡å— |
| `é—®é¢˜æ ¹æœ¬åŸå› å’Œè§£å†³æ–¹æ¡ˆ.md` | æœ¬æ–‡æ¡£ |

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### ç”¨æˆ·éœ€è¦åšçš„ï¼ˆæœ€åä¸€æ­¥ï¼‰ï¼š

**å®Œå…¨é‡å¯åº”ç”¨ç¨‹åº**ï¼š

```bash
# æ­¥éª¤1ï¼šå¼ºåˆ¶ç»ˆæ­¢æ‰€æœ‰è¿›ç¨‹ï¼ˆåœ¨å‘½ä»¤è¡Œæˆ–é€šè¿‡ä»»åŠ¡ç®¡ç†å™¨ï¼‰
taskkill /F /IM electron.exe /T
taskkill /F /IM node.exe /T

# æ­¥éª¤2ï¼šç­‰å¾…5ç§’
timeout /t 5

# æ­¥éª¤3ï¼šé‡æ–°å¯åŠ¨åº”ç”¨
cd E:\HITGUI
npm start
```

**æˆ–è€…**ï¼šç›´æ¥å…³é—­Electronçª—å£ï¼Œç­‰å¾…5ç§’ï¼Œç„¶ååŒå‡»å¿«æ·æ–¹å¼é‡æ–°å¯åŠ¨ã€‚

### éªŒè¯ä¼˜åŒ–æ˜¯å¦ç”Ÿæ•ˆï¼š

å¯åŠ¨åï¼Œåœ¨UIä¸­åˆ›å»ºä¸€ä¸ªæµ‹è¯•ä»»åŠ¡ï¼ˆ10æœŸï¼‰ï¼Œç„¶åæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ã€‚

#### âœ… æˆåŠŸæ ‡å¿—ï¼ˆä¼˜åŒ–ä»£ç è¿è¡Œï¼‰ï¼š

```
ğŸ§¹ æ¸…é™¤server.jsçš„requireç¼“å­˜...        <--- å…³é”®æ ‡è®°ï¼
âœ… å†…åµŒæœåŠ¡å™¨å·²å¯åŠ¨: http://localhost:3003
...ï¼ˆç”¨æˆ·åˆ›å»ºä»»åŠ¡åï¼‰
ğŸš€ [taskId] å¼€å§‹å¤„ç†çƒ­æ¸©å†·æ­£é€‰æ‰¹é‡é¢„æµ‹ä»»åŠ¡...
ğŸ“¥ [taskId] é¢„åŠ è½½çƒ­æ¸©å†·ä¼˜åŒ–è¡¨: Xä¸ªæœŸå·å¯¹...
âœ… [taskId] çƒ­æ¸©å†·ä¼˜åŒ–è¡¨ç¼“å­˜å°±ç»ª
ğŸ¯ [taskId] å¼€å§‹6æ­¥æ­£é€‰ç­›é€‰ (25120â†’25121)
  âœ… Step1 çƒ­æ¸©å†·æ¯”ç­›é€‰: XXXä¸ªç»„åˆ (ä»324,632ä¸ª)
  ...
ğŸ“¦ æ‰¹æ¬¡å¤„ç†å®Œæˆ: 10æœŸ, è€—æ—¶XXXms, å¹³å‡XX.Xms/æœŸ
```

**å…³é”®æ ‡è®°**ï¼š
- `ğŸ§¹ æ¸…é™¤server.jsçš„requireç¼“å­˜...` - è¯æ˜ç¼“å­˜æ¸…ç†ç”Ÿæ•ˆ
- `ğŸš€`, `ğŸ“¥`, `ğŸ“¦` ç­‰emojiæ ‡è®° - è¯æ˜ä¼˜åŒ–ä»£ç æ­£åœ¨æ‰§è¡Œ
- æ‰¹æ¬¡å¤„ç†æ—¥å¿— - è¯æ˜ä½¿ç”¨äº†HwcPositivePredictoræ‰¹é‡å¤„ç†

#### âŒ å¤±è´¥æ ‡å¿—ï¼ˆä»ç„¶æ˜¯æ—§ä»£ç ï¼‰ï¼š

```
âœ… å†…åµŒæœåŠ¡å™¨å·²å¯åŠ¨: http://localhost:3003
ï¼ˆæ²¡æœ‰ç¼“å­˜æ¸…ç†æ—¥å¿—ï¼‰
...ï¼ˆç”¨æˆ·åˆ›å»ºä»»åŠ¡åï¼‰
å¼€å§‹å¤„ç†çƒ­æ¸©å†·æ­£é€‰æ‰¹é‡é¢„æµ‹ä»»åŠ¡ hwc-pos-xxxxx
ğŸ“§ å¤„ç†æœŸå·å¯¹ 25115 -> 25116 (1/10)   <--- é€æœŸå¤„ç†ï¼ˆæ—§ä»£ç ï¼‰
  Step 1 - çƒ­æ¸©å†·æ¯”ç­›é€‰ 21840 ä¸ªç»„åˆ
```

### å¦‚æœä»ç„¶å¤±è´¥ï¼ˆæç«¯æƒ…å†µï¼‰ï¼š

å¦‚æœçœ‹ä¸åˆ°`ğŸ§¹ æ¸…é™¤server.jsçš„requireç¼“å­˜...`æ—¥å¿—ï¼Œå¯èƒ½æ˜¯å› ä¸ºï¼š

1. **ä¸åœ¨å¼€å‘æ¨¡å¼è¿è¡Œ**ï¼š
   - æ£€æŸ¥ï¼šå¯åŠ¨æ—¶åº”è¯¥æœ‰DevToolsè‡ªåŠ¨æ‰“å¼€
   - è§£å†³ï¼š`npm run dev` æˆ– `electron . --dev`

2. **ç¼“å­˜è·¯å¾„ä¸åŒ¹é…**ï¼š
   - è¿è¡Œè¯Šæ–­ï¼š`node test-hwc-predictor-load.js`
   - æŸ¥çœ‹è¾“å‡ºçš„`æœåŠ¡å™¨æ–‡ä»¶è·¯å¾„`æ˜¯å¦æ­£ç¡®

## ğŸ“Š é¢„æœŸæ€§èƒ½æå‡

ä¸€æ—¦ä¼˜åŒ–ç”Ÿæ•ˆï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

| æµ‹è¯•è§„æ¨¡ | æ—§ä»£ç è€—æ—¶ | æ–°ä»£ç è€—æ—¶ | æ€§èƒ½æå‡ |
|---------|-----------|-----------|---------|
| 10æœŸ | 3-5ç§’ | 0.2-0.5ç§’ | **6-25å€** |
| 51æœŸ | 15-25ç§’ | 1-4ç§’ | **6-25å€** |
| 100æœŸ | 30-50ç§’ | 2-8ç§’ | **6-25å€** |

## ğŸ”¬ æŠ€æœ¯ç»†èŠ‚

### ä¸ºä»€ä¹ˆä¹‹å‰çš„é‡å¯æ— æ•ˆï¼Ÿ

æˆ‘ä»¬ä¹‹å‰å°è¯•çš„æ‰€æœ‰æ–¹æ³•ï¼š
- âœ… æ€æ­»è¿›ç¨‹ â†’ **æ— æ•ˆ**ï¼ˆrequireç¼“å­˜åœ¨Electronä¸»è¿›ç¨‹å¯åŠ¨æ—¶åŠ è½½ï¼‰
- âœ… æ¸…ç†ç«¯å£ â†’ **æ— æ•ˆ**ï¼ˆç¼“å­˜ä¸åœ¨ç½‘ç»œå±‚ï¼‰
- âœ… åˆ é™¤node_modules/.cache â†’ **æ— æ•ˆ**ï¼ˆrequireç¼“å­˜åœ¨å†…å­˜ä¸­ï¼‰
- âœ… ä¿®æ”¹æºæ–‡ä»¶ â†’ **æ— æ•ˆ**ï¼ˆrequireä¸ä¼šé‡æ–°è¯»å–ï¼‰

**å”¯ä¸€æœ‰æ•ˆçš„æ–¹æ³•**ï¼šåœ¨require()ä¹‹å‰`delete require.cache[path]`

### ä¸ºä»€ä¹ˆåªåœ¨å¼€å‘æ¨¡å¼æ¸…é™¤ï¼Ÿ

```javascript
if (isDev) {
  delete require.cache[serverPath];
}
```

**åŸå› **ï¼š
- **å¼€å‘æ¨¡å¼**ï¼šç»å¸¸ä¿®æ”¹ä»£ç ï¼Œéœ€è¦çƒ­æ›´æ–°
- **ç”Ÿäº§æ¨¡å¼**ï¼šä»£ç å›ºå®šï¼Œä¿æŒç¼“å­˜å¯ä»¥ï¼š
  - å‡å°‘æ–‡ä»¶I/Oï¼ˆæå‡å¯åŠ¨é€Ÿåº¦20-30%ï¼‰
  - å‡å°‘å†…å­˜åˆ†é…
  - æå‡ç¨³å®šæ€§

## ğŸ“ å­¦åˆ°çš„ç»éªŒ

### Node.jsæ¨¡å—ç¼“å­˜ç‰¹ç‚¹

1. **å…¨å±€ç¼“å­˜**ï¼š`require.cache`å¯¹è±¡å­˜å‚¨æ‰€æœ‰å·²åŠ è½½æ¨¡å—
2. **è·¯å¾„ä¸ºé”®**ï¼šä½¿ç”¨ç»å¯¹è·¯å¾„ä½œä¸ºé”®å
3. **æ°¸ä¹…æœ‰æ•ˆ**ï¼šè¿›ç¨‹ç”Ÿå‘½å‘¨æœŸå†…ä¸€ç›´æœ‰æ•ˆ
4. **æ‰‹åŠ¨æ¸…é™¤**ï¼šå¿…é¡»æ˜¾å¼`delete require.cache[path]`

### Electronåº”ç”¨å¼€å‘æ³¨æ„äº‹é¡¹

1. **ä¸»è¿›ç¨‹ä»£ç ä¿®æ”¹**ï¼šéœ€è¦å®Œå…¨é‡å¯Electron
2. **æ¸²æŸ“è¿›ç¨‹ä»£ç ä¿®æ”¹**ï¼šå¯ä»¥ç”¨`Ctrl+R`åˆ·æ–°
3. **require()çš„æ¨¡å—**ï¼šéœ€è¦æ‰‹åŠ¨æ¸…ç†ç¼“å­˜
4. **æ‰“åŒ…åçš„åº”ç”¨**ï¼šæ‰€æœ‰ä»£ç éƒ½è¢«bundledï¼Œæ— éœ€æ‹…å¿ƒç¼“å­˜

## ğŸ‰ æ€»ç»“

**é—®é¢˜**ï¼šrequire()ç¼“å­˜å¯¼è‡´ä¼˜åŒ–ä»£ç æœªè¢«åŠ è½½
**è§£å†³**ï¼šåœ¨main.jsä¸­æ·»åŠ 8è¡Œç¼“å­˜æ¸…ç†ä»£ç 
**çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤ï¼Œç­‰å¾…ç”¨æˆ·é‡å¯éªŒè¯

**ä¸€å¥è¯æ€»ç»“**ï¼šNode.jsçš„require()ä¼šç¼“å­˜æ¨¡å—ï¼Œå¯¼è‡´ä»£ç ä¿®æ”¹åæœªç”Ÿæ•ˆã€‚é€šè¿‡åœ¨Electronä¸»è¿›ç¨‹å¯åŠ¨æ—¶æ¸…é™¤server.jsçš„ç¼“å­˜ï¼Œå¼ºåˆ¶é‡æ–°åŠ è½½æœ€æ–°ä»£ç ï¼Œé—®é¢˜å¾—ä»¥è§£å†³ã€‚

---

**åˆ›å»ºæ—¶é—´**ï¼š2025-11-04 17:20
**ä½œè€…**ï¼šClaude Code
**çŠ¶æ€**ï¼šâœ… é—®é¢˜å·²å®šä½å¹¶ä¿®å¤ï¼Œç­‰å¾…ç”¨æˆ·æœ€ç»ˆéªŒè¯
