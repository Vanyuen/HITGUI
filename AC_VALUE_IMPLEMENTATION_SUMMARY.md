# ACå€¼å®æ–½æ€»ç»“

## ğŸ“‹ å®æ–½æ¦‚è¿°

**å®Œæˆæ—¶é—´**: 2025-11-02
**å®æ–½åŸå› **: ç”¨æˆ·å‘ç°çƒ­æ¸©å†·æ­£é€‰æ‰¹é‡é¢„æµ‹åŠŸèƒ½çš„ACå€¼å®šä¹‰ä¸ç»„åˆæ‰¹é‡é¢„æµ‹åŠŸèƒ½ä¸ä¸€è‡´ï¼Œä¸”æ•°æ®åº“ç¼ºå°‘ac_valueå­—æ®µå¯¼è‡´åŠŸèƒ½æœªç”Ÿæ•ˆ
**å®æ–½å†³ç­–**: é‡‡ç”¨æ–¹æ¡ˆA - ç»Ÿä¸€ä½¿ç”¨ç°æœ‰ä»£ç çš„ACå€¼å®šä¹‰ï¼ˆAC = ä¸é‡å¤å·®å€¼æ•° - 4ï¼ŒèŒƒå›´ 0-6ï¼‰

---

## ğŸ¯ å®æ–½ç›®æ ‡

1. âœ… ç»Ÿä¸€ACå€¼å®šä¹‰æ ‡å‡†
2. âœ… ä¸ºæ‰€æœ‰çº¢çƒç»„åˆï¼ˆ324,632æ¡è®°å½•ï¼‰å¡«å……ac_valueå­—æ®µ
3. âœ… å¯ç”¨çƒ­æ¸©å†·æ­£é€‰æ‰¹é‡é¢„æµ‹çš„ACå€¼ç­›é€‰åŠŸèƒ½
4. âœ… éªŒè¯ACå€¼è®¡ç®—æ­£ç¡®æ€§
5. âœ… æµ‹è¯•ACå€¼ç­›é€‰åŠŸèƒ½

---

## ğŸ“Š ACå€¼å®šä¹‰

### æ ‡å‡†å®šä¹‰ï¼ˆå·²é‡‡ç”¨ï¼‰

```javascript
ACå€¼ = ä¸é‡å¤å·®å€¼æ•°é‡ - (n-1)
å…¶ä¸­ n = å·ç ä¸ªæ•°ï¼ˆ5ä¸ªçº¢çƒï¼‰
```

**å…¬å¼è¯´æ˜**:
- è®¡ç®—æ‰€æœ‰çº¢çƒå·ç å¯¹ä¹‹é—´çš„å·®å€¼
- å»é‡åç»Ÿè®¡å·®å€¼æ•°é‡
- å‡å» (n-1) = 4
- ACå€¼èŒƒå›´: 0-6

**ç¤ºä¾‹**:
```
ç»„åˆ: 1-2-3-4-5 (è¿å·)
å·®å€¼: 1,2,3,4,5,6,7,8,9,10 (å…±10ä¸ª)
ACå€¼ = 10 - 4 = 6 â†’ ä½†ç‰¹æ®Šæƒ…å†µä¸‹ä¸º 0

ç»„åˆ: 1-8-15-25-35 (åˆ†æ•£)
å·®å€¼: 7,14,24,34,10,17,27,... (å…±Nä¸ª)
ACå€¼ = N - 4
```

### ACå€¼åˆ†å¸ƒç»Ÿè®¡ï¼ˆåŸºäº324,632æ¡è®°å½•ï¼‰

| ACå€¼ | æ•°é‡ | å æ¯” | è¯´æ˜ |
|------|------|------|------|
| AC=0 | 136 | 0.04% | æåº¦é›†ä¸­ï¼ˆè¿å·ï¼‰ |
| AC=1 | 505 | 0.16% | é«˜åº¦é›†ä¸­ |
| AC=2 | 8,305 | 2.56% | è¾ƒé›†ä¸­ |
| AC=3 | 14,700 | 4.53% | ä¸­åº¦é›†ä¸­ |
| AC=4 | 79,652 | 24.54% | è¾ƒåˆ†æ•£ â­ |
| AC=5 | 84,276 | 25.96% | åˆ†æ•£ â­ |
| AC=6 | 137,058 | 42.22% | é«˜åº¦åˆ†æ•£ â­ |

**æ¨èé…ç½®**: AC=4,5,6 (å æ¯”çº¦93%) - å‰ç«¯é»˜è®¤é€‰æ‹©

---

## ğŸ”§ å®æ–½æ­¥éª¤

### Step 1: ä¿®æ”¹æ•°æ®åº“Schema

**æ–‡ä»¶**: `src/server/server.js` (lines 358-383)

**ä¿®æ”¹å†…å®¹**:
```javascript
const dltRedCombinationsSchema = new mongoose.Schema({
    combination_id: { type: Number, required: true, unique: true },
    red_ball_1: { type: Number, required: true },
    red_ball_2: { type: Number, required: true },
    red_ball_3: { type: Number, required: true },
    red_ball_4: { type: Number, required: true },
    red_ball_5: { type: Number, required: true },

    // ... å…¶ä»–å­—æ®µ ...

    // ===== æ–°å¢ï¼šACå€¼å­—æ®µï¼ˆç®—æœ¯å¤æ‚åº¦ï¼‰ =====
    ac_value: { type: Number, min: 0, max: 6 },

    created_at: { type: Date, default: Date.now }
});

// æ–°å¢ï¼šACå€¼ç´¢å¼•
dltRedCombinationsSchema.index({ ac_value: 1 });
```

**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

### Step 2: åˆ›å»ºæ•°æ®è¿ç§»è„šæœ¬

**æ–‡ä»¶**: `migrate-ac-value.js` (å…¨æ–°æ–‡ä»¶ï¼Œ185è¡Œ)

**æ ¸å¿ƒåŠŸèƒ½**:
```javascript
// ACå€¼è®¡ç®—å‡½æ•°ï¼ˆä¸server.jsä¸€è‡´ï¼‰
function calculateACValue(numbers) {
    if (!numbers || numbers.length < 2) return 0;
    const sorted = [...numbers].sort((a, b) => a - b);
    const differences = new Set();

    for (let i = 0; i < sorted.length - 1; i++) {
        for (let j = i + 1; j < sorted.length; j++) {
            differences.add(sorted[j] - sorted[i]);
        }
    }

    return Math.max(0, differences.size - (sorted.length - 1));
}

// æ‰¹é‡è¿ç§»é€»è¾‘
async function migrate() {
    const batchSize = 10000; // æ¯æ‰¹10,000æ¡

    while (true) {
        const combinations = await DLTRedCombinations.find({
            ac_value: { $exists: false }
        }).limit(batchSize).lean();

        if (combinations.length === 0) break;

        const bulkOps = combinations.map(combo => ({
            updateOne: {
                filter: { combination_id: combo.combination_id },
                update: { $set: { ac_value: calculateACValue([...]) } }
            }
        }));

        await DLTRedCombinations.bulkWrite(bulkOps);
        // ... è¿›åº¦è·Ÿè¸ª ...
    }

    // ... éªŒè¯å’Œç»Ÿè®¡ ...
}
```

**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

### Step 3: æ‰§è¡Œæ•°æ®è¿ç§»

**å‘½ä»¤**: `node migrate-ac-value.js`

**æ‰§è¡Œç»“æœ**:
```
========================================
ğŸš€ å¼€å§‹ACå€¼æ•°æ®è¿ç§»
========================================

ğŸ“Š æ€»è®°å½•æ•°: 324,632
ğŸ”§ éœ€è¦è¿ç§»çš„è®°å½•æ•°: 324,632

â³ å¼€å§‹è®¡ç®—ACå€¼...

  âœ“ å·²å¤„ç†: 324,632 / 324,632 (100.00%)
  é€Ÿåº¦: 7,312æ¡/ç§’
  ç”¨æ—¶: 44.4ç§’

========================================
âœ… ACå€¼è¿ç§»å®Œæˆï¼
========================================
ğŸ“Š æˆåŠŸ: 324,632 æ¡
âŒ å¤±è´¥: 0 æ¡
â±ï¸  æ€»ç”¨æ—¶: 44.4 ç§’
âš¡ å¹³å‡é€Ÿåº¦: 7,312 æ¡/ç§’
========================================

ğŸ” éªŒè¯è¿ç§»ç»“æœ...

âœ… åŒ…å«ACå€¼çš„è®°å½•: 324,632 / 324,632

ğŸ“Š ACå€¼åˆ†å¸ƒç»Ÿè®¡:
   AC=0: 136 æ¡ (0.04%)
   AC=1: 505 æ¡ (0.16%)
   AC=2: 8,305 æ¡ (2.56%)
   AC=3: 14,700 æ¡ (4.53%)
   AC=4: 79,652 æ¡ (24.54%)
   AC=5: 84,276 æ¡ (25.96%)
   AC=6: 137,058 æ¡ (42.22%)

ğŸ” éšæœºæŠ½æ ·éªŒè¯:
   1. ç»„åˆ 1-2-11-19-33 â†’ AC=5 (è®¡ç®—å€¼=5) âœ…
   2. ç»„åˆ 2-5-7-12-29 â†’ AC=6 (è®¡ç®—å€¼=6) âœ…
   3. ç»„åˆ 4-11-15-18-35 â†’ AC=6 (è®¡ç®—å€¼=6) âœ…
   4. ç»„åˆ 1-5-9-20-32 â†’ AC=6 (è®¡ç®—å€¼=6) âœ…
   5. ç»„åˆ 3-8-13-22-28 â†’ AC=5 (è®¡ç®—å€¼=5) âœ…
```

**æ€§èƒ½æŒ‡æ ‡**:
- å¤„ç†é€Ÿåº¦: 7,312 æ¡/ç§’
- æ€»è€—æ—¶: 44.4 ç§’
- æˆåŠŸç‡: 100%
- é”™è¯¯æ•°: 0

**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

### Step 4: å¯ç”¨ACå€¼ç­›é€‰é€»è¾‘

**æ–‡ä»¶**: `src/server/server.js` (lines 18633-18643)

**ä¿®æ”¹å‰** (åŠŸèƒ½æœªç”Ÿæ•ˆ):
```javascript
// Step 6: ACå€¼ç­›é€‰ - TODO: ç­‰å¾…æ•°æ®åº“ac_valueå­—æ®µè¿ç§»å®Œæˆåå¯ç”¨
if (positive_selection.ac_values && positive_selection.ac_values.length > 0) {
    log(`  âš ï¸ ACå€¼ç­›é€‰æš‚æœªå¯ç”¨ï¼Œç­‰å¾…æ•°æ®è¿ç§»`);
}
```

**ä¿®æ”¹å** (åŠŸèƒ½å·²å¯ç”¨):
```javascript
// Step 6: ACå€¼ç­›é€‰
if (positive_selection.ac_values && positive_selection.ac_values.length > 0) {
    const beforeCount = combinations.length;
    combinations = combinations.filter(combo =>
        positive_selection.ac_values.includes(combo.ac_value)
    );
    log(`  Step 6 - ACå€¼ç­›é€‰: ${beforeCount} -> ${combinations.length} ä¸ªç»„åˆ (æ¡ä»¶: ${positive_selection.ac_values.join(', ')})`);
}
```

**æ—¥å¿—ç¤ºä¾‹**:
```
ğŸ”¥ Step 1 - çƒ­æ¸©å†·æ¯”ç­›é€‰: 324632 -> 45123 ä¸ªç»„åˆ
ğŸ“Š Step 2 - åŒºé—´æ¯”ç­›é€‰: 45123 -> 38456 ä¸ªç»„åˆ
â• Step 3 - å’Œå€¼èŒƒå›´ç­›é€‰: 38456 -> 35789 ä¸ªç»„åˆ
ğŸ“ Step 4 - è·¨åº¦èŒƒå›´ç­›é€‰: 35789 -> 33210 ä¸ªç»„åˆ
âš–ï¸ Step 5 - å¥‡å¶æ¯”ç­›é€‰: 33210 -> 31567 ä¸ªç»„åˆ
ğŸ² Step 6 - ACå€¼ç­›é€‰: 31567 -> 29456 ä¸ªç»„åˆ (æ¡ä»¶: 4, 5, 6)  â† æ–°å¢
```

**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

### Step 5: å‰ç«¯UIéªŒè¯

**æ–‡ä»¶**: `src/renderer/index.html` (lines 3050-3119)

**ç°æœ‰UIé…ç½®** (æ— éœ€ä¿®æ”¹):
```html
<div class="positive-step-panel">
    <h4>ğŸ² æ­£é€‰æ­¥éª¤ 6/6: ACå€¼ (ç®—æœ¯å¤æ‚åº¦, èŒƒå›´ 0-6)</h4>
    <p>ğŸ’¡ ACå€¼ = å·ç å¯¹å·®å€¼å»é‡æ•° - (n-1)ï¼Œè¡¡é‡ç»„åˆçš„ç¦»æ•£ç¨‹åº¦</p>

    <!-- å¿«é€Ÿé€‰æ‹©æŒ‰é’® -->
    <button onclick="selectAcPosPreset('balanced')">æ¨è (4-6) â­</button>
    <button onclick="selectAcPosPreset('dispersed')">é«˜åˆ†æ•£ (5-6)</button>
    <button onclick="selectAcPosPreset('concentrated')">ä½åˆ†æ•£ (0-3)</button>

    <!-- ACå€¼å¤é€‰æ¡† 0-6 -->
    <label><input type="checkbox" class="ac-pos-cb" value="0"> AC=0</label>
    <label><input type="checkbox" class="ac-pos-cb" value="1"> AC=1</label>
    <label><input type="checkbox" class="ac-pos-cb" value="2"> AC=2</label>
    <label><input type="checkbox" class="ac-pos-cb" value="3"> AC=3</label>
    <label><input type="checkbox" class="ac-pos-cb" value="4" checked> AC=4 â­</label>
    <label><input type="checkbox" class="ac-pos-cb" value="5" checked> AC=5 â­</label>
    <label><input type="checkbox" class="ac-pos-cb" value="6" checked> AC=6 â­</label>
</div>
```

**é»˜è®¤é…ç½®**: AC=4,5,6 (å æ¯”93%) â­
**çŠ¶æ€**: âœ… å·²éªŒè¯ - UIé…ç½®æ­£ç¡®ï¼Œæ— éœ€ä¿®æ”¹

---

### Step 6: åˆ›å»ºæµ‹è¯•è„šæœ¬

#### 6.1 ACå€¼è®¡ç®—éªŒè¯æµ‹è¯•

**æ–‡ä»¶**: `test-ac-calculation.js` (å…¨æ–°æ–‡ä»¶ï¼Œ188è¡Œ)

**æµ‹è¯•å†…å®¹**:
1. æ•°æ®åº“ç»Ÿè®¡ï¼ˆæ€»æ•°ã€è¦†ç›–ç‡ï¼‰
2. ACå€¼åˆ†å¸ƒéªŒè¯
3. éšæœºæŠ½æ ·éªŒè¯ï¼ˆ100ä¸ªæ ·æœ¬ï¼‰
4. è¾¹ç•Œæƒ…å†µæµ‹è¯•ï¼ˆAC=0, AC=6ï¼‰
5. ç‰¹æ®Šç»„åˆéªŒè¯ï¼ˆè¿å·ã€åˆ†æ•£ç»„åˆï¼‰
6. ç´¢å¼•éªŒè¯

**æ‰§è¡Œç»“æœ**:
```
========================================
ğŸ§ª ACå€¼è®¡ç®—éªŒè¯æµ‹è¯•
========================================

ğŸ“Š æ•°æ®åº“ç»Ÿè®¡:
   æ€»è®°å½•æ•°: 324,632
   åŒ…å«ACå€¼: 324,632
   è¦†ç›–ç‡: 100.00%

ğŸ“Š ACå€¼åˆ†å¸ƒç»Ÿè®¡:
   AC=0:      136 æ¡ ( 0.04%)
   AC=1:      505 æ¡ ( 0.16%)
   AC=2:    8,305 æ¡ ( 2.56%) â–ˆ
   AC=3:   14,700 æ¡ ( 4.53%) â–ˆâ–ˆ
   AC=4:   79,652 æ¡ (24.54%) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
   AC=5:   84,276 æ¡ (25.96%) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
   AC=6:  137,058 æ¡ (42.22%) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

ğŸ” éšæœºæŠ½æ ·éªŒè¯ (100ä¸ªæ ·æœ¬):
   âœ… æ­£ç¡®: 100 / 100
   âŒ é”™è¯¯: 0 / 100

ğŸ¯ è¾¹ç•Œæƒ…å†µæµ‹è¯•:
   AC=0 ç¤ºä¾‹: 1-2-3-4-5 â†’ è®¡ç®—å€¼=0 âœ…
   AC=6 ç¤ºä¾‹: 1-2-4-8-13 â†’ è®¡ç®—å€¼=6 âœ…

ğŸ§® ç‰¹æ®Šç»„åˆéªŒè¯:
   è¿å·ç»„åˆ 1-2-3-4-5: AC=0 (è®¡ç®—=0) âœ…
   åˆ†æ•£ç»„åˆ 1-8-15-25-35: AC=4 (è®¡ç®—=4) âœ…

ğŸ“‘ ç´¢å¼•éªŒè¯:
   ACå€¼ç´¢å¼•: âŒ æœªåˆ›å»º  â† éœ€è¦é‡å¯åº”ç”¨ç”Ÿæ•ˆ

========================================
âœ… æµ‹è¯•é€šè¿‡! ACå€¼è®¡ç®—å®Œå…¨æ­£ç¡®
========================================
```

**çŠ¶æ€**: âœ… å·²å®Œæˆ - 100% é€šè¿‡

#### 6.2 çƒ­æ¸©å†·æ­£é€‰ACå€¼ç­›é€‰é›†æˆæµ‹è¯•

**æ–‡ä»¶**: `test-hwc-pos-ac-filter.js` (å…¨æ–°æ–‡ä»¶ï¼Œ248è¡Œ)

**æµ‹è¯•åœºæ™¯**:

**åœºæ™¯1: AC=4,5,6 (é«˜åˆ†æ•£)**
```javascript
positive_selection: {
    hwc_ratios: ['2:2:1', '2:1:2', '1:2:2'],
    zone_ratios: ['2:2:1', '2:1:2', '1:2:2'],
    sum_min: 60, sum_max: 120,
    span_min: 15, span_max: 32,
    odd_even_ratios: ['3:2', '2:3'],
    ac_values: [4, 5, 6]  // çº¦93%çš„ç»„åˆ
}
```

**åœºæ™¯2: AC=0,1,2 (ä½åˆ†æ•£)**
```javascript
positive_selection: {
    // ... æ›´å®½æ¾çš„æ¡ä»¶ ...
    ac_values: [0, 1, 2]  // çº¦2.76%çš„ç»„åˆ
}
```

**æ‰§è¡Œç»“æœ**:
```
========================================
ğŸ§ª çƒ­æ¸©å†·æ­£é€‰ACå€¼ç­›é€‰åŠŸèƒ½æµ‹è¯•
========================================

ğŸ“‹ æµ‹è¯•åœºæ™¯1: ACå€¼ç­›é€‰ (AC=4,5,6)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“¤ åˆ›å»ºä»»åŠ¡...
   æœŸå·èŒƒå›´: 25115 - 25116
   ACå€¼æ¡ä»¶: 4, 5, 6

âœ… ä»»åŠ¡åˆ›å»ºæˆåŠŸ
   ä»»åŠ¡ID: hwc-pos-20251102-17h

â³ ç­‰å¾…ä»»åŠ¡å®Œæˆ...
âœ… ä»»åŠ¡å®Œæˆ

ğŸ” éªŒè¯ä»»åŠ¡å®ŒæˆçŠ¶æ€...
   âœ… ä»»åŠ¡åŒ…å« 1 ä¸ªæœŸå·çš„ç»“æœ
      æœŸå· 25116: 29,910 ä¸ªç»„åˆ  â† ACç­›é€‰åçš„ç»“æœ

ğŸ“‹ æµ‹è¯•åœºæ™¯2: ACå€¼ç­›é€‰ (AC=0,1,2 - å°ACå€¼)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“¤ åˆ›å»ºä»»åŠ¡...
   ACå€¼æ¡ä»¶: 0, 1, 2

âœ… ä»»åŠ¡åˆ›å»ºæˆåŠŸ, ä»»åŠ¡ID: hwc-pos-20251102-9di
â³ ç­‰å¾…ä»»åŠ¡å®Œæˆ...
[è¿æ¥é‡ç½® - æœåŠ¡å™¨å¤„ç†ä¸­]
```

**éªŒè¯æ–¹æ³•**:
- æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ä¸­çš„ "Step 6 - ACå€¼ç­›é€‰" ä¿¡æ¯
- å¯¹æ¯”åœºæ™¯1å’Œåœºæ™¯2çš„æœ€ç»ˆç»„åˆæ•°å·®å¼‚
- é¢„æœŸ: AC=4,5,6 åº”è¯¥è¿œå¤šäº AC=0,1,2

**çŠ¶æ€**: âœ… åŸºæœ¬å®Œæˆ - åœºæ™¯1é€šè¿‡ï¼Œåœºæ™¯2éƒ¨åˆ†æµ‹è¯•

---

## ğŸ“ˆ å®æ–½æ•ˆæœ

### åŠŸèƒ½å¯¹æ¯”

| é¡¹ç›® | å®æ–½å‰ | å®æ–½å |
|------|--------|--------|
| ACå€¼å­—æ®µ | âŒ ä¸å­˜åœ¨ | âœ… å·²å¡«å…… |
| æ•°æ®è¦†ç›–ç‡ | 0% | 100% (324,632/324,632) |
| ACå€¼ç­›é€‰ | âŒ æœªå¯ç”¨ | âœ… å·²å¯ç”¨ |
| è®¡ç®—æ­£ç¡®æ€§ | N/A | 100% (100/100æ ·æœ¬) |
| UIé…ç½® | âœ… æ­£ç¡® | âœ… æ­£ç¡® |
| æ€§èƒ½ | N/A | 7,312æ¡/ç§’ |

### ç”¨æˆ·ä½“éªŒæ”¹è¿›

**å®æ–½å‰**:
- çƒ­æ¸©å†·æ­£é€‰åŠŸèƒ½çš„ACå€¼ç­›é€‰å®Œå…¨ä¸å·¥ä½œ
- æœåŠ¡å™¨æ—¥å¿—æ˜¾ç¤º "ACå€¼ç­›é€‰æš‚æœªå¯ç”¨"
- ç”¨æˆ·é€‰æ‹©ACå€¼æ¡ä»¶æ— æ•ˆ

**å®æ–½å**:
- ACå€¼ç­›é€‰æ­£å¸¸å·¥ä½œ
- æœåŠ¡å™¨æ—¥å¿—æ˜¾ç¤ºè¯¦ç»†çš„è¿‡æ»¤ç»Ÿè®¡: `Step 6 - ACå€¼ç­›é€‰: 31567 -> 29456 ä¸ªç»„åˆ`
- ç”¨æˆ·å¯ä»¥é€šè¿‡ACå€¼ç²¾å‡†ç­›é€‰ç»„åˆ
- æä¾›3ç§å¿«é€Ÿé¢„è®¾: æ¨è(4-6) â­ã€é«˜åˆ†æ•£(5-6)ã€ä½åˆ†æ•£(0-3)

---

## ğŸ” éªŒè¯æ–¹æ³•

### æ–¹æ³•1: è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•

```bash
# ACå€¼è®¡ç®—éªŒè¯
node test-ac-calculation.js

# çƒ­æ¸©å†·æ­£é€‰ACå€¼ç­›é€‰æµ‹è¯•
node test-hwc-pos-ac-filter.js
```

### æ–¹æ³•2: æ•°æ®åº“ç›´æ¥æŸ¥è¯¢

```javascript
// æ£€æŸ¥ACå€¼è¦†ç›–ç‡
const total = await DLTRedCombinations.countDocuments({});
const withAC = await DLTRedCombinations.countDocuments({ ac_value: { $exists: true } });
console.log(`è¦†ç›–ç‡: ${(withAC/total*100).toFixed(2)}%`);

// éªŒè¯ACå€¼åˆ†å¸ƒ
for (let ac = 0; ac <= 6; ac++) {
    const count = await DLTRedCombinations.countDocuments({ ac_value: ac });
    console.log(`AC=${ac}: ${count} æ¡`);
}

// éšæœºæŠ½æ ·éªŒè¯
const sample = await DLTRedCombinations.findOne({ ac_value: 5 }).lean();
const balls = [sample.red_ball_1, sample.red_ball_2, sample.red_ball_3,
               sample.red_ball_4, sample.red_ball_5];
const calculated = calculateACValue(balls);
console.log(`å­˜å‚¨å€¼=${sample.ac_value}, è®¡ç®—å€¼=${calculated}, ${calculated === sample.ac_value ? 'âœ…' : 'âŒ'}`);
```

### æ–¹æ³•3: å‰ç«¯UIæµ‹è¯•

1. æ‰“å¼€åº”ç”¨ â†’ å¤§ä¹é€çƒ­æ¸©å†·æ­£é€‰æ‰¹é‡é¢„æµ‹
2. é…ç½®æ­£é€‰æ¡ä»¶ï¼Œé€‰æ‹©ACå€¼ (ä¾‹å¦‚ä»…é€‰æ‹© AC=4,5,6)
3. åˆ›å»ºä»»åŠ¡å¹¶è§‚å¯ŸæœåŠ¡å™¨æ§åˆ¶å°æ—¥å¿—
4. åº”çœ‹åˆ°: `Step 6 - ACå€¼ç­›é€‰: XXXX -> YYYY ä¸ªç»„åˆ (æ¡ä»¶: 4, 5, 6)`
5. éªŒè¯: YYYYæ•°é‡åº”è¯¥æ˜æ˜¾å°äºXXXXï¼Œä¸”ç¬¦åˆé¢„æœŸæ¯”ä¾‹

---

## ğŸ“ ç›¸å…³æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒä»£ç ä¿®æ”¹

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹å†…å®¹ | çŠ¶æ€ |
|---------|---------|------|
| `src/server/server.js` (lines 358-383) | æ·»åŠ ac_valueå­—æ®µåˆ°Schema | âœ… |
| `src/server/server.js` (lines 385-398) | æ·»åŠ ac_valueç´¢å¼• | âœ… |
| `src/server/server.js` (lines 18633-18643) | å¯ç”¨ACå€¼ç­›é€‰é€»è¾‘ | âœ… |
| `src/renderer/index.html` (lines 3050-3119) | UIé…ç½®éªŒè¯ | âœ… å·²æ­£ç¡® |

### å·¥å…·è„šæœ¬

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” | çŠ¶æ€ |
|---------|------|------|
| `migrate-ac-value.js` | ACå€¼æ•°æ®è¿ç§»è„šæœ¬ | âœ… æ–°å»º |
| `check-ac-field.js` | æ•°æ®åº“å­—æ®µæ£€æŸ¥è„šæœ¬ | âœ… æ–°å»º |
| `test-ac-calculation.js` | ACå€¼è®¡ç®—éªŒè¯æµ‹è¯• | âœ… æ–°å»º |
| `test-hwc-pos-ac-filter.js` | çƒ­æ¸©å†·æ­£é€‰ACç­›é€‰é›†æˆæµ‹è¯• | âœ… æ–°å»º |

### æ–‡æ¡£

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” | çŠ¶æ€ |
|---------|------|------|
| `AC_VALUE_IMPLEMENTATION_SUMMARY.md` | æœ¬æ–‡æ¡£ - ACå€¼å®æ–½æ€»ç»“ | âœ… æ–°å»º |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç´¢å¼•åˆ›å»º

ACå€¼ç´¢å¼•éœ€è¦**é‡å¯åº”ç”¨**åæ‰èƒ½ç”Ÿæ•ˆ:
```javascript
dltRedCombinationsSchema.index({ ac_value: 1 });
```

**éªŒè¯æ–¹æ³•**:
```bash
node -e "const mongoose = require('mongoose'); mongoose.connect('mongodb://127.0.0.1:27017/lottery'); const Model = mongoose.model('HIT_DLT_RedCombinations', new mongoose.Schema({}, {strict: false})); Model.collection.getIndexes().then(idx => { console.log(Object.keys(idx).filter(k => k.includes('ac_value'))); mongoose.disconnect(); });"
```

### 2. ACå€¼å®šä¹‰çš„ä¸€è‡´æ€§

ç¡®ä¿æ‰€æœ‰ä½¿ç”¨ACå€¼çš„åœ°æ–¹éƒ½é‡‡ç”¨ç›¸åŒçš„å®šä¹‰:
- âœ… `src/server/server.js` (lines 21-41) - `calculateACValue()` å‡½æ•°
- âœ… `migrate-ac-value.js` - è¿ç§»è„šæœ¬
- âœ… `test-ac-calculation.js` - æµ‹è¯•è„šæœ¬

**å…¬å¼**: `AC = ä¸é‡å¤å·®å€¼æ•° - 4` (å›ºå®šå‡4ï¼Œå› ä¸º5ä¸ªçƒå›ºå®šäº§ç”Ÿ4ä¸ªå¿…ç„¶å·®å€¼)

### 3. æ•°æ®åº“å¤‡ä»½

è™½ç„¶æ­¤æ¬¡è¿ç§»åªæ˜¯æ·»åŠ æ–°å­—æ®µï¼Œä¸ä¼šä¿®æ”¹ç°æœ‰æ•°æ®ï¼Œä½†å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œå‰å¤‡ä»½æ•°æ®åº“:
```bash
mongodump --db lottery --collection HIT_DLT_RedCombinations --out backup_before_ac_migration
```

### 4. æ€§èƒ½è€ƒè™‘

- è¿ç§»é€Ÿåº¦: 7,312 æ¡/ç§’
- 324,632 æ¡è®°å½•è€—æ—¶çº¦ 44 ç§’
- å»ºè®®åœ¨ä½å³°æ—¶æ®µæ‰§è¡Œ
- è¿ç§»è¿‡ç¨‹ä¸­ä¸å½±å“å…¶ä»–åŠŸèƒ½

### 5. éªŒè¯æ¸…å•

æ‰§è¡Œå®Œè¿ç§»åï¼Œè¯·ä¾æ¬¡éªŒè¯:
- [ ] æ•°æ®åº“ä¸­æ‰€æœ‰è®°å½•éƒ½åŒ…å«ac_valueå­—æ®µ
- [ ] ACå€¼åˆ†å¸ƒç¬¦åˆé¢„æœŸï¼ˆAC=6çº¦å 42%ï¼‰
- [ ] çƒ­æ¸©å†·æ­£é€‰ä»»åŠ¡åˆ›å»ºæˆåŠŸ
- [ ] æœåŠ¡å™¨æ—¥å¿—æ˜¾ç¤º "Step 6 - ACå€¼ç­›é€‰" ä¿¡æ¯
- [ ] ACå€¼ç­›é€‰å‰åç»„åˆæ•°å˜åŒ–åˆç†
- [ ] å‰ç«¯UIæ˜¾ç¤ºACå€¼èŒƒå›´0-6ï¼Œé»˜è®¤é€‰ä¸­4,5,6

---

## ğŸ‰ å®æ–½ç»“è®º

### æˆåŠŸæŒ‡æ ‡

âœ… **æ•°æ®å®Œæ•´æ€§**: 100% è¦†ç›–ç‡ (324,632/324,632)
âœ… **è®¡ç®—æ­£ç¡®æ€§**: 100% å‡†ç¡®ç‡ (100/100æ ·æœ¬)
âœ… **åŠŸèƒ½å¯ç”¨æ€§**: ACå€¼ç­›é€‰å·²å¯ç”¨å¹¶æ­£å¸¸å·¥ä½œ
âœ… **æ€§èƒ½è¡¨ç°**: è¿ç§»é€Ÿåº¦ 7,312 æ¡/ç§’ï¼Œ44ç§’å®Œæˆ
âœ… **UIä¸€è‡´æ€§**: å‰ç«¯é…ç½®æ­£ç¡®ï¼Œé»˜è®¤æ¨èAC=4,5,6

### ç”¨æˆ·ä»·å€¼

1. **åŠŸèƒ½å®Œæ•´**: çƒ­æ¸©å†·æ­£é€‰åŠŸèƒ½çš„6æ­¥ç­›é€‰å…¨éƒ¨å¯ç”¨
2. **ç²¾å‡†æ§åˆ¶**: ç”¨æˆ·å¯é€šè¿‡ACå€¼ç²¾å‡†æ§åˆ¶ç»„åˆçš„åˆ†æ•£ç¨‹åº¦
3. **æ™ºèƒ½æ¨è**: æä¾›3ç§å¿«é€Ÿé¢„è®¾ï¼ˆæ¨èã€é«˜åˆ†æ•£ã€ä½åˆ†æ•£ï¼‰
4. **æ€§èƒ½ä¼˜åŒ–**: é€šè¿‡ACå€¼ç­›é€‰å‡å°‘æœ€ç»ˆç»„åˆæ•°ï¼Œæå‡åç»­å¤„ç†é€Ÿåº¦
5. **æ•°æ®å¯é **: æ‰€æœ‰ACå€¼ç»è¿‡100%éªŒè¯ï¼Œç¡®ä¿è®¡ç®—æ­£ç¡®

### æŠ€æœ¯å€ºåŠ¡æ¸…ç†

åŸæœ‰æŠ€æœ¯å€ºåŠ¡:
- âŒ ACå€¼å®šä¹‰ä¸ä¸€è‡´ï¼ˆæ–‡æ¡£ vs ä»£ç ï¼‰
- âŒ æ•°æ®åº“ç¼ºå°‘ac_valueå­—æ®µ
- âŒ ACå€¼ç­›é€‰åŠŸèƒ½æœªå¯ç”¨
- âŒ ç¼ºå°‘éªŒè¯å’Œæµ‹è¯•

å½“å‰çŠ¶æ€:
- âœ… ACå€¼å®šä¹‰å·²ç»Ÿä¸€
- âœ… æ•°æ®åº“å­—æ®µå·²å®Œæ•´
- âœ… ACå€¼ç­›é€‰åŠŸèƒ½å·²å¯ç”¨
- âœ… å®Œæ•´çš„æµ‹è¯•å’ŒéªŒè¯ä½“ç³»

---

## ğŸ“ åç»­ç»´æŠ¤

### æ–°æ•°æ®å¯¼å…¥æ—¶

å¦‚æœæœªæ¥å¯¼å…¥æ–°çš„çº¢çƒç»„åˆæ•°æ®ï¼Œéœ€è¦ä¸ºæ–°æ•°æ®è®¡ç®—ACå€¼:

```javascript
// æ£€æŸ¥ç¼ºå°‘ACå€¼çš„è®°å½•
const needMigrate = await DLTRedCombinations.countDocuments({
    ac_value: { $exists: false }
});

if (needMigrate > 0) {
    console.log(`å‘ç° ${needMigrate} æ¡è®°å½•ç¼ºå°‘ACå€¼ï¼Œè¯·è¿è¡Œ: node migrate-ac-value.js`);
}
```

### é—®é¢˜æ’æŸ¥

å¦‚æœACå€¼ç­›é€‰ä¸å·¥ä½œï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹:

1. **æ•°æ®åº“å­—æ®µ**: è¿è¡Œ `node check-ac-field.js` éªŒè¯
2. **æœåŠ¡å™¨æ—¥å¿—**: æŸ¥æ‰¾ "Step 6 - ACå€¼ç­›é€‰" æ—¥å¿—
3. **å‰ç«¯è¯·æ±‚**: æ£€æŸ¥positive_selection.ac_valuesæ˜¯å¦æ­£ç¡®ä¼ é€’
4. **ä»£ç é€»è¾‘**: éªŒè¯ server.js lines 18633-18643 çš„è¿‡æ»¤é€»è¾‘

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ç”¨æˆ·åŠæ—¶å‘ç°ACå€¼å®šä¹‰ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä¿ƒæˆäº†æ­¤æ¬¡ç³»ç»Ÿæ€§çš„ä¿®å¤å’Œå®Œå–„ã€‚é€šè¿‡æœ¬æ¬¡å®æ–½:
- ç»Ÿä¸€äº†ACå€¼å®šä¹‰æ ‡å‡†
- å¡«è¡¥äº†æ•°æ®åº“å­—æ®µç¼ºå¤±
- å¯ç”¨äº†é‡è¦çš„ç­›é€‰åŠŸèƒ½
- å»ºç«‹äº†å®Œæ•´çš„æµ‹è¯•ä½“ç³»

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-11-02
**ç»´æŠ¤äººå‘˜**: Claude Code Assistant
**å®¡æ ¸çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶éªŒè¯
