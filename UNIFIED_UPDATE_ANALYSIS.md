# "ç»Ÿä¸€æ›´æ–°æ‰€æœ‰æ•°æ®" åŠŸèƒ½åˆ†æ

## åŠŸèƒ½å…¥å£
- **åç«¯API**: `/api/dlt/update-all-data` (POST)
- **ä»£ç ä½ç½®**: `src/server/server.js:24380-24418`
- **å‰ç«¯è°ƒç”¨**: `src/renderer/admin.js` (ç®¡ç†åå°)

---

## å½“å‰åŒ…å«çš„6ä¸ªæ­¥éª¤

### âœ… æ­¥éª¤1: ç”Ÿæˆé—æ¼å€¼è¡¨
**å‡½æ•°**: `generateUnifiedMissingTables()` (line 24635)
**ç”Ÿæˆçš„æ•°æ®è¡¨**:
1. âœ… `hit_dlt_basictrendchart_redballmissing_histories` - **çº¢çƒé—æ¼å€¼è¡¨**
2. âœ… `hit_dlt_basictrendchart_blueballmissing_histories` - **è“çƒé—æ¼å€¼è¡¨**

**æ•°æ®æ¥æº**: `DLT.find({})` - ä» `hit_dlts` è¡¨è¯»å–æ‰€æœ‰æœŸå·æ•°æ®

**å­—æ®µå†…å®¹**:
```javascript
// çº¢çƒé—æ¼è®°å½•
{
    ID: Number,
    Issue: String,
    DrawingDay: String,
    FrontHotWarmColdRatio: String,  // å¦‚ "12:15:8"
    "1": Number,  // çƒå·1çš„é—æ¼å€¼
    "2": Number,  // çƒå·2çš„é—æ¼å€¼
    ...
    "35": Number  // çƒå·35çš„é—æ¼å€¼
}

// è“çƒé—æ¼è®°å½•
{
    ID: Number,
    Issue: String,
    DrawingDay: String,
    "1": Number,   // çƒå·1çš„é—æ¼å€¼
    ...
    "12": Number   // çƒå·12çš„é—æ¼å€¼
}
```

**â­ é‡è¦**: è¿™æ˜¯ä¿®å¤åç¬¬ä¸€æ¬¡è¿è¡Œæ—¶çš„å…³é”®æ­¥éª¤ï¼
- ä¹‹å‰å› ä¸º DLT Model æŒ‡å‘ç©ºé›†åˆï¼Œç”Ÿæˆäº†ç©ºè¡¨
- ä¿®å¤åä¼šåŸºäº2792æœŸæ•°æ®ç”Ÿæˆå®Œæ•´é—æ¼å€¼è¡¨

---

### âœ… æ­¥éª¤2: ç”Ÿæˆç»„åˆç‰¹å¾è¡¨
**å‡½æ•°**: `generateUnifiedComboFeatures()` (line 24747)
**ç”Ÿæˆçš„æ•°æ®è¡¨**:
1. âœ… `hit_dlt_combofeatures` - **ç»„åˆç‰¹å¾è¡¨**

**æ•°æ®æ¥æº**: `DLT.find({})` - ä» `hit_dlts` è¡¨è¯»å–

**å­—æ®µå†…å®¹**:
```javascript
{
    ID: Number,
    Issue: Number,
    combo_2: [String],  // 2çƒç»„åˆæ•°ç»„ï¼Œå¦‚ ["01-03", "01-08", ...]
    combo_3: [String],  // 3çƒç»„åˆæ•°ç»„
    combo_4: [String],  // 4çƒç»„åˆæ•°ç»„
    blue_combo: [String]  // è“çƒç»„åˆ
}
```

**ç”¨é€”**: ç”¨äº"åŒå‡ºæ’é™¤"åŠŸèƒ½ï¼Œåˆ†æçƒå·ç»„åˆçš„å†å²å‡ºç°é¢‘ç‡

---

### âœ… æ­¥éª¤3: ç”Ÿæˆstatisticså­—æ®µ
**å‡½æ•°**: `generateUnifiedStatistics()` (line å…·ä½“ä½ç½®æœªæŸ¥çœ‹)
**æ›´æ–°çš„æ•°æ®è¡¨**:
1. âœ… `hit_dlts` - **åœ¨åŸè¡¨ä¸Šæ·»åŠ statisticsåµŒå¥—å­—æ®µ**

**é¢„æœŸå­—æ®µ**:
```javascript
statistics: {
    consecutiveCount: Number,  // è¿å·ä¸ªæ•°
    repeatCount: Number,       // é‡å·ä¸ªæ•°ï¼ˆç›¸å¯¹ä¸Šä¸€æœŸï¼‰
    // å¯èƒ½è¿˜æœ‰å…¶ä»–ç»Ÿè®¡å­—æ®µ
}
```

---

### âœ… æ­¥éª¤4: ç”Ÿæˆçƒ­æ¸©å†·æ¯”ä¼˜åŒ–è¡¨
**å‡½æ•°**: `generateUnifiedHotWarmColdOptimizedTable()` (line å…·ä½“ä½ç½®æœªæŸ¥çœ‹)
**ç”Ÿæˆçš„æ•°æ®è¡¨**:
1. âœ… `hit_dlt_redcombinationshotwarmcoldoptimizeds` - **çƒ­æ¸©å†·æ¯”ä¼˜åŒ–è¡¨**

**æ•°æ®ç»“æ„**:
```javascript
{
    base_issue: Number,     // åŸºå‡†æœŸå·
    target_issue: Number,   // ç›®æ ‡æœŸå·
    combination_id: Number, // ç»„åˆID (1-324632)
    hot_warm_cold_ratio: String,  // å¦‚ "4:1:0"
    // å…¶ä»–å¯èƒ½å­—æ®µ...
}
```

**ç”¨é€”**:
- é¢„è®¡ç®—æ¯ä¸ªç»„åˆåœ¨ç‰¹å®šæœŸå·å¯¹çš„çƒ­æ¸©å†·æ¯”
- åŠ é€Ÿçƒ­æ¸©å†·æ­£é€‰ä»»åŠ¡çš„ç­›é€‰ï¼ˆé¿å…å®æ—¶è®¡ç®—ï¼‰
- **æ³¨æ„**: è¿™æ˜¯æ€§èƒ½ä¼˜åŒ–é¡¹ï¼Œä¸æ˜¯å¿…éœ€çš„ï¼ˆæœ‰ Fallback åŠ¨æ€è®¡ç®—ï¼‰

---

### âœ… æ­¥éª¤5: æ¸…ç†è¿‡æœŸç¼“å­˜
**å‡½æ•°**: `cleanupUnifiedExpiredCache()` (line å…·ä½“ä½ç½®æœªæŸ¥çœ‹)
**æ¸…ç†çš„æ•°æ®è¡¨**:
1. âœ… `hit_dlt_periodcombinationcaches` - **æœŸå·ç»„åˆç¼“å­˜è¡¨** (å¯èƒ½)
2. âœ… `hit_dlt_combinationcaches` - **ç»„åˆç¼“å­˜è¡¨** (å¯èƒ½)

**ç”¨é€”**: æ¸…ç†æ—§çš„é¢„è®¡ç®—ç¼“å­˜æ•°æ®

---

### âœ… æ­¥éª¤6: éªŒè¯æ•°æ®å®Œæ•´æ€§
**å‡½æ•°**: `verifyUnifiedData()` (line å…·ä½“ä½ç½®æœªæŸ¥çœ‹)

**éªŒè¯å†…å®¹** (æ¨æµ‹):
- æ£€æŸ¥é—æ¼å€¼è¡¨è®°å½•æ•°æ˜¯å¦åŒ¹é…
- æ£€æŸ¥ç»„åˆç‰¹å¾è¡¨è®°å½•æ•°æ˜¯å¦åŒ¹é…
- æ£€æŸ¥æ•°æ®å®Œæ•´æ€§

---

## â“ å¯èƒ½é—æ¼çš„æ•°æ®è¡¨

è®©æˆ‘æ£€æŸ¥æ•°æ®åº“ä¸­å­˜åœ¨ä½†å¯èƒ½æœªè¢«ç»Ÿä¸€æ›´æ–°åŒ…å«çš„è¡¨ï¼š

### 1. â“ `hit_dlt_redcombinations` (çº¢çƒç»„åˆè¡¨)
- **è®°å½•æ•°**: 324,632 (C(35,5))
- **ç”¨é€”**: é¢„ç”Ÿæˆçš„æ‰€æœ‰å¯èƒ½çº¢çƒç»„åˆ
- **æ˜¯å¦éœ€è¦æ›´æ–°**: âŒ ä¸éœ€è¦ï¼ˆè¿™æ˜¯å›ºå®šçš„ç»„åˆè¡¨ï¼Œé™¤éæ¸¸æˆè§„åˆ™æ”¹å˜ï¼‰

### 2. â“ `hit_dlt_bluecombinations` / `HIT_DLT_BlueCombinations` (è“çƒç»„åˆè¡¨)
- **è®°å½•æ•°**: 66 (C(12,2)) / 1
- **ç”¨é€”**: é¢„ç”Ÿæˆçš„æ‰€æœ‰å¯èƒ½è“çƒç»„åˆ
- **æ˜¯å¦éœ€è¦æ›´æ–°**: âŒ ä¸éœ€è¦ï¼ˆå›ºå®šç»„åˆè¡¨ï¼‰

### 3. â“ `hit_dlt_hwcpositivepredictiontasks` (çƒ­æ¸©å†·æ­£é€‰ä»»åŠ¡è¡¨)
- **è®°å½•æ•°**: 9
- **ç”¨é€”**: å­˜å‚¨ç”¨æˆ·åˆ›å»ºçš„çƒ­æ¸©å†·æ­£é€‰ä»»åŠ¡
- **æ˜¯å¦éœ€è¦æ›´æ–°**: âŒ ä¸éœ€è¦ï¼ˆç”¨æˆ·æ•°æ®ï¼Œä¸æ˜¯åŸºç¡€æ•°æ®ï¼‰

### 4. â“ `hit_dlt_hwcpositivepredictiontaskresults` (çƒ­æ¸©å†·æ­£é€‰ä»»åŠ¡ç»“æœè¡¨)
- **è®°å½•æ•°**: 339
- **ç”¨é€”**: å­˜å‚¨ä»»åŠ¡æ‰§è¡Œç»“æœ
- **æ˜¯å¦éœ€è¦æ›´æ–°**: âŒ ä¸éœ€è¦ï¼ˆä»»åŠ¡ç»“æœæ•°æ®ï¼‰

### 5. â“ `hit_dlt_exclusiondetails` (æ’é™¤è¯¦æƒ…è¡¨)
- **è®°å½•æ•°**: 9,835
- **ç”¨é€”**: å­˜å‚¨é¢„æµ‹ä»»åŠ¡çš„æ’é™¤è¯¦æƒ…
- **æ˜¯å¦éœ€è¦æ›´æ–°**: âŒ ä¸éœ€è¦ï¼ˆä»»åŠ¡ç›¸å…³æ•°æ®ï¼‰

### 6. â“ `hit_dlt_predictiontaskresults` (é¢„æµ‹ä»»åŠ¡ç»“æœè¡¨)
- **è®°å½•æ•°**: 2,789
- **ç”¨é€”**: å­˜å‚¨æ™®é€šé¢„æµ‹ä»»åŠ¡ç»“æœ
- **æ˜¯å¦éœ€è¦æ›´æ–°**: âŒ ä¸éœ€è¦ï¼ˆä»»åŠ¡ç»“æœæ•°æ®ï¼‰

---

## æ€»ç»“

### âœ… å½“å‰"ç»Ÿä¸€æ›´æ–°æ‰€æœ‰æ•°æ®"åŠŸèƒ½å·²ç»åŒ…å«çš„æ ¸å¿ƒæ•°æ®è¡¨ï¼š

1. âœ… **çº¢çƒé—æ¼å€¼è¡¨** - `hit_dlt_basictrendchart_redballmissing_histories`
2. âœ… **è“çƒé—æ¼å€¼è¡¨** - `hit_dlt_basictrendchart_blueballmissing_histories`
3. âœ… **ç»„åˆç‰¹å¾è¡¨** - `hit_dlt_combofeatures`
4. âœ… **Statisticså­—æ®µ** - `hit_dlts.statistics`
5. âœ… **çƒ­æ¸©å†·æ¯”ä¼˜åŒ–è¡¨** - `hit_dlt_redcombinationshotwarmcoldoptimizeds`
6. âœ… **ç¼“å­˜æ¸…ç†** - æ¸…ç†è¿‡æœŸç¼“å­˜æ•°æ®

### ğŸ“Š æ•°æ®ä¾èµ–å…³ç³»å›¾

```
hit_dlts (2792æœŸåŸå§‹æ•°æ®)
    â†“
æ­¥éª¤1: ç”Ÿæˆé—æ¼å€¼è¡¨
    â†’ hit_dlt_basictrendchart_redballmissing_histories (2792æœŸ)
    â†’ hit_dlt_basictrendchart_blueballmissing_histories (2792æœŸ)
    â†“
æ­¥éª¤2: ç”Ÿæˆç»„åˆç‰¹å¾è¡¨
    â†’ hit_dlt_combofeatures (2792æœŸ)
    â†“
æ­¥éª¤3: ç”Ÿæˆstatisticså­—æ®µ
    â†’ hit_dlts.statistics (2792æœŸ)
    â†“
æ­¥éª¤4: ç”Ÿæˆçƒ­æ¸©å†·æ¯”ä¼˜åŒ–è¡¨
    â†’ hit_dlt_redcombinationshotwarmcoldoptimizeds (NæœŸ Ã— 324,632ç»„åˆ)
    â†“
æ­¥éª¤5: æ¸…ç†è¿‡æœŸç¼“å­˜
    â†“
æ­¥éª¤6: éªŒè¯æ•°æ®å®Œæ•´æ€§
```

### ğŸ¯ ç»“è®º

**"ç»Ÿä¸€æ›´æ–°æ‰€æœ‰æ•°æ®" åŠŸèƒ½å·²ç»éå¸¸å®Œå–„ï¼**

âœ… **æ‰€æœ‰å¿…éœ€çš„åŸºç¡€æ•°æ®è¡¨éƒ½å·²åŒ…å«åœ¨å†…**:
- é—æ¼å€¼è¡¨ï¼ˆçº¢çƒ+è“çƒï¼‰âœ…
- ç»„åˆç‰¹å¾è¡¨ âœ…
- ç»Ÿè®¡å­—æ®µ âœ…
- çƒ­æ¸©å†·æ¯”ä¼˜åŒ–è¡¨ âœ…

âŒ **ä¸éœ€è¦æ·»åŠ çš„è¡¨**:
- å›ºå®šç»„åˆè¡¨ï¼ˆçº¢çƒ/è“çƒç»„åˆï¼‰- é™¤éè§„åˆ™æ”¹å˜
- ä»»åŠ¡å’Œç»“æœè¡¨ - å±äºç”¨æˆ·æ•°æ®ï¼Œä¸æ˜¯åŸºç¡€æ•°æ®

### âš ï¸ å”¯ä¸€çš„é—®é¢˜æ˜¯ï¼š

**ä¿®å¤ DLT Model ä¹‹å‰**ï¼Œæ­¥éª¤1è¯»å–åˆ°0æ¡æ•°æ®ï¼Œå¯¼è‡´ç”Ÿæˆç©ºçš„é—æ¼å€¼è¡¨ã€‚

**ä¿®å¤ DLT Model ä¹‹å**ï¼Œæ­¥éª¤1ä¼šè¯»å–2792æœŸæ•°æ®ï¼Œç”Ÿæˆå®Œæ•´çš„é—æ¼å€¼è¡¨ã€‚

---

## å»ºè®®

### ç°åœ¨å¯ä»¥å®‰å…¨æ‰§è¡Œçš„æ“ä½œï¼š

1. âœ… æ‰“å¼€ç®¡ç†åå°
2. âœ… ç‚¹å‡»"ç»Ÿä¸€æ›´æ–°æ‰€æœ‰æ•°æ®"
3. âœ… ç­‰å¾…æ‰€æœ‰6ä¸ªæ­¥éª¤å®Œæˆï¼ˆé¢„è®¡2-5åˆ†é’Ÿï¼‰
4. âœ… éªŒè¯é—æ¼æ•°æ®æ˜¯å¦ç”Ÿæˆï¼š`node check-missing-data.js`
5. âœ… é‡æ–°åˆ›å»ºçƒ­æ¸©å†·æ­£é€‰æ‰¹é‡é¢„æµ‹ä»»åŠ¡
6. âœ… éªŒè¯æ˜¯å¦è¿”å›é0ç»„åˆ

### ä¸éœ€è¦ä¿®æ”¹çš„éƒ¨åˆ†ï¼š

âŒ æ— éœ€æ·»åŠ é¢å¤–çš„æ•°æ®ç”Ÿæˆæ­¥éª¤
âŒ æ— éœ€ä¿®æ”¹ç»Ÿä¸€æ›´æ–°åŠŸèƒ½çš„é€»è¾‘
âŒ æ‰€æœ‰å¿…éœ€çš„æ•°æ®è¡¨éƒ½å·²ç»åœ¨ç»Ÿä¸€æ›´æ–°ä¸­äº†

---

**æœ€ç»ˆç­”æ¡ˆ**: "ç»Ÿä¸€æ›´æ–°æ‰€æœ‰æ•°æ®"åŠŸèƒ½å·²ç»åŒ…å«äº†æ‰€æœ‰å¿…éœ€çš„é—æ¼æ•°æ®ç”Ÿæˆæ­¥éª¤ï¼Œæ²¡æœ‰é—æ¼ï¼å”¯ä¸€çš„é—®é¢˜å·²ç»ä¿®å¤ï¼ˆDLT Model æŒ‡å‘é”™è¯¯é›†åˆï¼‰ï¼Œç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚
