# çƒ­æ¸©å†·æ­£é€‰æ‰¹é‡é¢„æµ‹ - è¿å·æ’é™¤åŠŸèƒ½å®æ–½æ–¹æ¡ˆ

**æ–¹æ¡ˆç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-10-31
**çŠ¶æ€**: ğŸ”µ å¾…ç¡®è®¤

---

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [è¿å·æ¦‚å¿µè¯¦è§£](#è¿å·æ¦‚å¿µè¯¦è§£)
3. [ç°æœ‰å®ç°å‚è€ƒ](#ç°æœ‰å®ç°å‚è€ƒ)
4. [è¯¦ç»†å®æ–½æ–¹æ¡ˆ](#è¯¦ç»†å®æ–½æ–¹æ¡ˆ)
5. [æ•°æ®ç»“æ„è®¾è®¡](#æ•°æ®ç»“æ„è®¾è®¡)
6. [ç®—æ³•å®ç°](#ç®—æ³•å®ç°)
7. [UIè®¾è®¡](#uiè®¾è®¡)
8. [æµ‹è¯•æ–¹æ¡ˆ](#æµ‹è¯•æ–¹æ¡ˆ)
9. [é£é™©è¯„ä¼°](#é£é™©è¯„ä¼°)

---

## ğŸ“– åŠŸèƒ½æ¦‚è¿°

### éœ€æ±‚èƒŒæ™¯

åœ¨çƒ­æ¸©å†·æ­£é€‰æ‰¹é‡é¢„æµ‹ä¸­ï¼Œå½“å‰å·²ç»å®ç°äº†6æ­¥æ­£é€‰å’Œ5æ­¥æ’é™¤ï¼ˆå†å²å’Œå€¼ã€å†å²è·¨åº¦ã€å†å²çƒ­æ¸©å†·æ¯”ã€å†å²åŒºé—´æ¯”ã€ç›¸å…‹å¯¹ã€åŒç°æ¯”ï¼‰ï¼Œä½†ç¼ºå°‘å¯¹**è¿å·ç‰¹å¾**çš„æ’é™¤åŠŸèƒ½ã€‚

è¿å·ç‰¹å¾æ˜¯å½©ç¥¨åˆ†æä¸­çš„é‡è¦ç»´åº¦ï¼Œéœ€è¦æ–°å¢ä»¥ä¸‹ä¸¤ç§æ’é™¤æ–¹å¼ï¼š

1. **è¿å·ç»„æ•°æ’é™¤**: æ’é™¤æŒ‡å®šè¿å·ç»„æ•°çš„ç»„åˆ
2. **é•¿è¿å·é•¿åº¦æ’é™¤**: æ’é™¤æŒ‡å®šæœ€é•¿è¿å·é•¿åº¦çš„ç»„åˆ

---

## ğŸ”¢ è¿å·æ¦‚å¿µè¯¦è§£

### 1. è¿å·ç»„æ•° (Consecutive Groups)

**å®šä¹‰**: ç»„åˆä¸­**è¿ç»­å·ç å½¢æˆçš„ç»„æ•°**

**è®¡ç®—è§„åˆ™**:
- è¿ç»­å·ç : ç›¸å·®ä¸º1çš„å·ç åºåˆ— (å¦‚ 3-4-5)
- æ¯ä¸ªè¿ç»­åºåˆ—ç®—1ç»„
- å•ç‹¬çš„å·ç ä¸ç®—è¿å·

**ç¤ºä¾‹**:

| ç»„åˆ | è¿å·åˆ†æ | è¿å·ç»„æ•° | è¯´æ˜ |
|-----|---------|---------|------|
| [01, 05, 12, 23, 31] | æ— è¿å· | 0 | æ‰€æœ‰å·ç éƒ½ä¸è¿ç»­ |
| [03, 04, 12, 23, 31] | 1ç»„: [03-04] | 1 | æœ‰1ä¸ª2è¿å· |
| [03, 04, 05, 23, 31] | 1ç»„: [03-04-05] | 1 | æœ‰1ä¸ª3è¿å· |
| [03, 04, 12, 13, 31] | 2ç»„: [03-04], [12-13] | 2 | æœ‰2ä¸ª2è¿å· |
| [03, 04, 05, 13, 14] | 2ç»„: [03-04-05], [13-14] | 2 | 1ä¸ª3è¿å· + 1ä¸ª2è¿å· |
| [03, 04, 12, 13, 14] | 2ç»„: [03-04], [12-13-14] | 2 | 1ä¸ª2è¿å· + 1ä¸ª3è¿å· |
| [01, 02, 03, 04, 05] | 1ç»„: [01-02-03-04-05] | 1 | å…¨éƒ¨5è¿å· |
| [03, 04, 08, 09, 13, 14] | 3ç»„: [03-04], [08-09], [13-14] | 3 | æœ‰3ä¸ª2è¿å· |

**ç®—æ³•ä¼ªä»£ç **:
```javascript
function calculateConsecutiveGroups(balls) {
  const sorted = balls.sort((a, b) => a - b);
  let groups = 0;
  let inGroup = false;

  for (let i = 0; i < sorted.length - 1; i++) {
    if (sorted[i + 1] - sorted[i] === 1) {
      // å‘ç°è¿ç»­å·ç 
      if (!inGroup) {
        groups++;  // æ–°çš„è¿å·ç»„
        inGroup = true;
      }
    } else {
      // è¿å·ä¸­æ–­
      inGroup = false;
    }
  }

  return groups;
}
```

---

### 2. é•¿è¿å·é•¿åº¦ (Max Consecutive Length)

**å®šä¹‰**: ç»„åˆä¸­**æœ€é•¿è¿ç»­å·ç åºåˆ—çš„é•¿åº¦**

**è®¡ç®—è§„åˆ™**:
- æ‰¾å‡ºæ‰€æœ‰è¿ç»­å·ç åºåˆ—
- è¿”å›æœ€é•¿åºåˆ—çš„é•¿åº¦
- å¦‚æœæ²¡æœ‰è¿å·ï¼Œé•¿åº¦ä¸º0

**ç¤ºä¾‹**:

| ç»„åˆ | è¿å·åˆ†æ | æœ€é•¿è¿å·é•¿åº¦ | è¯´æ˜ |
|-----|---------|-------------|------|
| [01, 05, 12, 23, 31] | æ— è¿å· | 0 | æ²¡æœ‰è¿ç»­å·ç  |
| [03, 04, 12, 23, 31] | [03-04] | 2 | æœ€é•¿2è¿å· |
| [03, 04, 05, 23, 31] | [03-04-05] | 3 | æœ€é•¿3è¿å· |
| [03, 04, 12, 13, 31] | [03-04], [12-13] | 2 | ä¸¤ä¸ª2è¿å·ï¼Œæœ€é•¿2 |
| [03, 04, 05, 13, 14] | [03-04-05], [13-14] | 3 | 3è¿å· + 2è¿å·ï¼Œæœ€é•¿3 |
| [03, 04, 12, 13, 14] | [03-04], [12-13-14] | 3 | 2è¿å· + 3è¿å·ï¼Œæœ€é•¿3 |
| [01, 02, 03, 04, 05] | [01-02-03-04-05] | 5 | å…¨éƒ¨5è¿å· |
| [03, 04, 08, 09, 10, 15] | [03-04], [08-09-10] | 3 | 2è¿å· + 3è¿å·ï¼Œæœ€é•¿3 |

**ç®—æ³•ä¼ªä»£ç **:
```javascript
function calculateMaxConsecutiveLength(balls) {
  const sorted = balls.sort((a, b) => a - b);
  let maxLength = 0;
  let currentLength = 1;

  for (let i = 0; i < sorted.length - 1; i++) {
    if (sorted[i + 1] - sorted[i] === 1) {
      // å‘ç°è¿ç»­å·ç 
      currentLength++;
      maxLength = Math.max(maxLength, currentLength);
    } else {
      // è¿å·ä¸­æ–­
      currentLength = 1;
    }
  }

  return maxLength;
}
```

---

### 3. ä¸¤è€…çš„åŒºåˆ«

| ç‰¹å¾ | è¿å·ç»„æ•° | é•¿è¿å·é•¿åº¦ |
|-----|---------|-----------|
| **å…³æ³¨ç‚¹** | è¿å·**å‡ºç°æ¬¡æ•°** | è¿å·**æœ€é•¿é•¿åº¦** |
| **æ•°å€¼èŒƒå›´** | 0-4 (å¤§ä¹é€5ä¸ªçº¢çƒæœ€å¤š4ç»„) | 0-5 (å¤§ä¹é€5ä¸ªçº¢çƒæœ€é•¿5è¿å·) |
| **ç”¨é€”** | æ§åˆ¶è¿å·çš„**åˆ†æ•£ç¨‹åº¦** | æ§åˆ¶è¿å·çš„**é›†ä¸­ç¨‹åº¦** |
| **ç¤ºä¾‹** | [03-04, 12-13]: 2ç»„ | [03-04-05]: é•¿åº¦3 |

**ç»„åˆå…³ç³»**:
```
ç»„åˆ [03, 04, 05, 13, 14]
  â””â”€ è¿å·ç»„æ•°: 2ç»„
       â”œâ”€ ç»„1: [03-04-05] (é•¿åº¦3)
       â””â”€ ç»„2: [13-14] (é•¿åº¦2)
  â””â”€ æœ€é•¿è¿å·é•¿åº¦: 3
```

---

## ğŸ“š ç°æœ‰å®ç°å‚è€ƒ

### 1. æ•°æ®åº“å·²æœ‰å­—æ®µ

åœ¨ `DLTRedCombinations` è¡¨ä¸­ï¼Œè¿å·å­—æ®µå·²é¢„ç•™ï¼š

```javascript
// src/server/server.js:376-377
consecutive_groups: { type: Number, default: 0, min: 0, max: 4 },
max_consecutive_length: { type: Number, default: 0, min: 0, max: 5 }
```

**ç´¢å¼•**:
```javascript
// src/server/server.js:392-393
dltRedCombinationsSchema.index({ consecutive_groups: 1 });
dltRedCombinationsSchema.index({ max_consecutive_length: 1 });
```

---

### 2. ç»„åˆæ‰¹é‡é¢„æµ‹çš„å®ç°

#### 2.1 Schemaå®šä¹‰

```javascript
// src/server/server.js:742-743
exclude_conditions: {
    consecutiveGroups: { type: [Number] },      // è¿å·ç»„æ•°æ’é™¤
    maxConsecutiveLength: { type: [Number] }    // æœ€é•¿è¿å·é•¿åº¦æ’é™¤
}
```

#### 2.2 å‰ç«¯UI (index.html:2002-2027)

```html
<!-- è¿å·ç»„æ•°æ’é™¤ -->
<div class="filter-row">
    <div class="filter-checkbox">
        <label>
            <input type="checkbox" id="batch-exclude-consecutive-groups">
            <span>ğŸ”¢ è¿å·ç»„æ•°æ’é™¤</span>
        </label>
    </div>
    <div class="filter-config">
        <div class="consecutive-selection">
            <label><input type="checkbox" value="0" class="batch-consecutive-groups-cb" disabled> æ— è¿å·</label>
            <label><input type="checkbox" value="1" class="batch-consecutive-groups-cb" disabled> 1è¿å·</label>
            <label><input type="checkbox" value="2" class="batch-consecutive-groups-cb" disabled> 2è¿å·</label>
            <label><input type="checkbox" value="3" class="batch-consecutive-groups-cb" disabled> 3è¿å·</label>
            <label><input type="checkbox" value="4" class="batch-consecutive-groups-cb" disabled> 4è¿å·</label>
        </div>
        <small class="help-text">å‹¾é€‰ä¸»å¤é€‰æ¡†åï¼Œé€‰æ‹©è¦æ’é™¤çš„è¿å·ç»„æ•°</small>
    </div>
</div>

<!-- é•¿è¿å·é•¿åº¦æ’é™¤ -->
<div class="filter-row">
    <div class="filter-checkbox">
        <label>
            <input type="checkbox" id="batch-exclude-max-consecutive">
            <span>ğŸ“ é•¿è¿å·é•¿åº¦æ’é™¤</span>
        </label>
    </div>
    <div class="filter-config">
        <div class="consecutive-selection">
            <label><input type="checkbox" value="0" class="batch-max-consecutive-cb" disabled> æ— è¿å·</label>
            <label><input type="checkbox" value="2" class="batch-max-consecutive-cb" disabled> é•¿2è¿å·</label>
            <label><input type="checkbox" value="3" class="batch-max-consecutive-cb" disabled> é•¿3è¿å·</label>
            <label><input type="checkbox" value="4" class="batch-max-consecutive-cb" disabled> é•¿4è¿å·</label>
            <label><input type="checkbox" value="5" class="batch-max-consecutive-cb" disabled> é•¿5è¿å·</label>
        </div>
        <small class="help-text">å‹¾é€‰ä¸»å¤é€‰æ¡†åï¼Œé€‰æ‹©è¦æ’é™¤çš„æœ€é•¿è¿å·é•¿åº¦</small>
    </div>
</div>
```

#### 2.3 å‰ç«¯é€»è¾‘ (dlt-module.js:11017-11049)

```javascript
// è¿å·ç»„æ•°æ’é™¤
const consecutiveGroupsEnabled = document.getElementById('batch-exclude-consecutive-groups')?.checked || false;
if (consecutiveGroupsEnabled) {
    const selectedGroups = [];
    const groupCheckboxes = document.querySelectorAll('.batch-consecutive-groups-cb:checked');
    groupCheckboxes.forEach(cb => selectedGroups.push(parseInt(cb.value)));
    if (selectedGroups.length > 0) {
        conditions.consecutiveGroups = selectedGroups;
        console.log('ğŸ”¢ è¿å·ç»„æ•°æ’é™¤æ¡ä»¶å·²æ”¶é›†:', conditions.consecutiveGroups);
    }
}

// é•¿è¿å·ç»„æ’é™¤
const maxConsecutiveEnabled = document.getElementById('batch-exclude-max-consecutive')?.checked || false;
if (maxConsecutiveEnabled) {
    const selectedLengths = [];
    const lengthCheckboxes = document.querySelectorAll('.batch-max-consecutive-cb:checked');
    lengthCheckboxes.forEach(cb => selectedLengths.push(parseInt(cb.value)));
    if (selectedLengths.length > 0) {
        conditions.maxConsecutiveLength = selectedLengths;
        console.log('ğŸ“ é•¿è¿å·ç»„æ’é™¤æ¡ä»¶å·²æ”¶é›†:', conditions.maxConsecutiveLength);
    }
}
```

#### 2.4 å‰ç«¯æ˜¾ç¤º (dlt-module.js:14832-14857)

```javascript
// è¿å·ç»„æ•°æ’é™¤æ˜¾ç¤º
if (conditions.consecutiveGroups && conditions.consecutiveGroups.length > 0) {
    const consecutiveGroupsHtml = `<div>âœ… æ’é™¤è¿å·ç»„æ•°: ${conditions.consecutiveGroups.join(', ')}ç»„</div>`;
    group1Html += consecutiveGroupsHtml;
}

// é•¿è¿å·é•¿åº¦æ’é™¤æ˜¾ç¤º
if (conditions.maxConsecutiveLength && conditions.maxConsecutiveLength.length > 0) {
    const lengths = conditions.maxConsecutiveLength.sort((a, b) => a - b);
    const displayText = lengths.map(len => {
        if (len === 0) return 'æ— è¿å·';
        return `é•¿${len}è¿å·`;
    }).join('ã€');
    const maxConsecutiveLengthHtml = `<div>âœ… æ’é™¤é•¿è¿å·: ${displayText}</div>`;
    group1Html += maxConsecutiveLengthHtml;
}
```

#### 2.5 è”åŠ¨äº¤äº’ (index.html:4203-4217)

```javascript
// è¿å·ç»„æ•°æ’é™¤è”åŠ¨
const batchConsecutiveGroupsCheckbox = document.getElementById('batch-exclude-consecutive-groups');
const batchConsecutiveGroupsCheckboxes = document.querySelectorAll('.batch-consecutive-groups-cb');

batchConsecutiveGroupsCheckbox?.addEventListener('change', function() {
    const enabled = this.checked;
    batchConsecutiveGroupsCheckboxes.forEach(cb => cb.disabled = !enabled);
});

// é•¿è¿å·ç»„æ’é™¤è”åŠ¨
const batchMaxConsecutiveCheckbox = document.getElementById('batch-exclude-max-consecutive');
const batchMaxConsecutiveCheckboxes = document.querySelectorAll('.batch-max-consecutive-cb');

batchMaxConsecutiveCheckbox?.addEventListener('change', function() {
    const enabled = this.checked;
    batchMaxConsecutiveCheckboxes.forEach(cb => cb.disabled = !enabled);
});
```

---

## ğŸ“ è¯¦ç»†å®æ–½æ–¹æ¡ˆ

### æ–¹æ¡ˆæ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           çƒ­æ¸©å†·æ­£é€‰æ‰¹é‡é¢„æµ‹ - è¿å·æ’é™¤åŠŸèƒ½              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                   â”‚
   [å‰ç«¯å®æ–½]                          [åç«¯å®æ–½]
        â”‚                                   â”‚
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚         â”‚                         â”‚         â”‚
  UIè®¾è®¡   é€»è¾‘å¼€å‘                  Schemaæ‰©å±•  ç®—æ³•å®ç°
   â”‚         â”‚                         â”‚         â”‚
   â”œâ”€ HTML   â”œâ”€ æ•°æ®æ”¶é›†                â”œâ”€ Task   â”œâ”€ è¿å·è®¡ç®—
   â”œâ”€ CSS    â”œâ”€ è”åŠ¨äº¤äº’                â”œâ”€ Result â”œâ”€ è¿‡æ»¤é€»è¾‘
   â””â”€ JS     â””â”€ æ˜¾ç¤ºæ¸²æŸ“                â””â”€ API    â””â”€ æ’é™¤ç»Ÿè®¡
```

---

### å®æ–½æ­¥éª¤

#### é˜¶æ®µ1: æ•°æ®åº“Schemaæ‰©å±• (30åˆ†é’Ÿ)

#### é˜¶æ®µ2: åç«¯APIå¼€å‘ (1å°æ—¶)

#### é˜¶æ®µ3: å‰ç«¯UIå¼€å‘ (1å°æ—¶)

#### é˜¶æ®µ4: å‰ç«¯é€»è¾‘å¼€å‘ (1å°æ—¶)

#### é˜¶æ®µ5: æµ‹è¯•éªŒè¯ (1å°æ—¶)

**æ€»ä¼°æ—¶**: 4.5å°æ—¶

---

## ğŸ—„ï¸ æ•°æ®ç»“æ„è®¾è®¡

### 1. Task Schema æ‰©å±•

**æ–‡ä»¶**: `src/server/server.js` (çº¦ç¬¬1014-1103è¡Œ)

**å½“å‰Schema**:
```javascript
const hwcPositivePredictionTaskSchema = new mongoose.Schema({
    // ... å…¶ä»–å­—æ®µ
    exclusion_conditions: {
        sum: {
            historical: {
                enabled: { type: Boolean, default: false },
                period: { type: Number }
            }
        },
        span: { /* ç±»ä¼¼ç»“æ„ */ },
        hwc: { /* ç±»ä¼¼ç»“æ„ */ },
        zone: { /* ç±»ä¼¼ç»“æ„ */ },
        conflictPairs: { /* ... */ },
        coOccurrence: { /* ... */ }
    }
});
```

**éœ€è¦æ·»åŠ **:
```javascript
exclusion_conditions: {
    // ... ç°æœ‰å­—æ®µ

    // ========== æ–°å¢ï¼šè¿å·æ’é™¤æ¡ä»¶ ==========
    consecutiveGroups: {
        enabled: { type: Boolean, default: false },
        groups: [{ type: Number, min: 0, max: 4 }]  // è¦æ’é™¤çš„è¿å·ç»„æ•°åˆ—è¡¨
    },

    maxConsecutiveLength: {
        enabled: { type: Boolean, default: false },
        lengths: [{ type: Number, min: 0, max: 5 }]  // è¦æ’é™¤çš„æœ€é•¿è¿å·é•¿åº¦åˆ—è¡¨
    }
}
```

---

### 2. Result Schema æ‰©å±•

**æ–‡ä»¶**: `src/server/server.js` (çº¦ç¬¬1187-1197è¡Œ)

**å½“å‰Schema**:
```javascript
exclusion_summary: {
    positive_selection_count: { type: Number },
    sum_exclude_count: { type: Number },
    span_exclude_count: { type: Number },
    hwc_exclude_count: { type: Number },
    zone_exclude_count: { type: Number },
    conflict_exclude_count: { type: Number },
    cooccurrence_exclude_count: { type: Number },
    final_count: { type: Number }
}
```

**éœ€è¦æ·»åŠ **:
```javascript
exclusion_summary: {
    // ... ç°æœ‰å­—æ®µ

    // ========== æ–°å¢ï¼šè¿å·æ’é™¤ç»Ÿè®¡ ==========
    consecutive_groups_exclude_count: { type: Number, default: 0 },
    max_consecutive_length_exclude_count: { type: Number, default: 0 }
}
```

---

### 3. æ•°æ®ç¤ºä¾‹

**ä»»åŠ¡é…ç½®ç¤ºä¾‹**:
```json
{
  "task_id": "hwc_pos_1730380000000_abc123",
  "task_name": "çƒ­æ¸©å†·æ­£é€‰_è¿å·æ’é™¤æµ‹è¯•",
  "exclusion_conditions": {
    "consecutiveGroups": {
      "enabled": true,
      "groups": [0, 3, 4]
    },
    "maxConsecutiveLength": {
      "enabled": true,
      "lengths": [4, 5]
    }
  }
}
```

**æœŸå·ç»“æœç¤ºä¾‹**:
```json
{
  "task_id": "hwc_pos_1730380000000_abc123",
  "period": 25121,
  "exclusion_summary": {
    "positive_selection_count": 25000,
    "sum_exclude_count": 1200,
    "span_exclude_count": 800,
    "hwc_exclude_count": 600,
    "zone_exclude_count": 500,
    "conflict_exclude_count": 2400,
    "cooccurrence_exclude_count": 1000,
    "consecutive_groups_exclude_count": 3500,
    "max_consecutive_length_exclude_count": 1200,
    "final_count": 14800
  }
}
```

---

## âš™ï¸ ç®—æ³•å®ç°

### 1. è¿å·ç‰¹å¾è®¡ç®—å‡½æ•°

**ä½ç½®**: `src/server/server.js` (åœ¨ `analyzeConsecutive` å‡½æ•°é™„è¿‘ï¼Œçº¦ç¬¬320-353è¡Œ)

**å½“å‰å®ç°**:
```javascript
function analyzeConsecutive(redBalls) {
    const sorted = [...redBalls].sort((a, b) => a - b);
    let groups = 0;
    let maxLength = 0;
    let currentLength = 1;
    let inGroup = false;

    for (let i = 0; i < sorted.length - 1; i++) {
        if (sorted[i + 1] - sorted[i] === 1) {
            if (!inGroup) {
                groups++;
                inGroup = true;
                currentLength = 2;
            } else {
                currentLength++;
            }
            maxLength = Math.max(maxLength, currentLength);
        } else {
            inGroup = false;
            currentLength = 1;
        }
    }

    return {
        consecutiveGroups: groups,
        maxConsecutiveLength: maxLength
    };
}
```

**éªŒè¯**: è¯¥å‡½æ•°å·²å­˜åœ¨ï¼Œå¯ç›´æ¥ä½¿ç”¨ã€‚

---

### 2. è¿å·æ’é™¤è¿‡æ»¤ç®—æ³•

**ä½ç½®**: `src/server/server.js` (åœ¨ `processHwcPositiveTask` å‡½æ•°ä¸­ï¼Œçº¦ç¬¬14048è¡Œ)

**å½“å‰ä»£ç **:
```javascript
// TODO: å®ç°5ä¸ªæ’é™¤æ¡ä»¶çš„å®Œæ•´é€»è¾‘
```

**éœ€è¦æ·»åŠ ** (åœ¨æ’é™¤æ¡ä»¶å¤„ç†éƒ¨åˆ†):

```javascript
/**
 * 7. è¿å·ç»„æ•°æ’é™¤
 */
if (exclusion_conditions.consecutiveGroups && exclusion_conditions.consecutiveGroups.enabled) {
    const beforeConsecutiveGroups = comboIds.length;
    const excludeGroups = exclusion_conditions.consecutiveGroups.groups || [];

    if (excludeGroups.length > 0) {
        log(`ğŸ”¢ [HWC-POS] å¼€å§‹è¿å·ç»„æ•°æ’é™¤: æ’é™¤ ${excludeGroups.join(', ')} ç»„`);

        // æŸ¥è¯¢å€™é€‰ç»„åˆæ•°æ®
        const combinations = await DLTRedCombination.find({
            combination_id: { $in: comboIds }
        }).lean();

        // è¿‡æ»¤: æ’é™¤æŒ‡å®šè¿å·ç»„æ•°çš„ç»„åˆ
        const filteredCombinations = combinations.filter(combo => {
            // åŠ¨æ€è®¡ç®—è¿å·ç‰¹å¾ (å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰é¢„å­˜)
            let consecutiveGroups;
            if (combo.consecutive_groups !== undefined) {
                consecutiveGroups = combo.consecutive_groups;
            } else {
                const analysis = analyzeConsecutive(combo.balls);
                consecutiveGroups = analysis.consecutiveGroups;
            }

            // ä¿ç•™: è¿å·ç»„æ•°ä¸åœ¨æ’é™¤åˆ—è¡¨ä¸­
            return !excludeGroups.includes(consecutiveGroups);
        });

        // æ›´æ–°ç»„åˆIDåˆ—è¡¨
        comboIds = filteredCombinations.map(c => c.combination_id);

        const excludedCount = beforeConsecutiveGroups - comboIds.length;
        log(`ğŸ”¢ [HWC-POS] è¿å·ç»„æ•°æ’é™¤å®Œæˆ: ä¿ç•™ ${comboIds.length}, æ’é™¤ ${excludedCount}`);

        // è®°å½•æ’é™¤ç»Ÿè®¡
        exclusion_summary.consecutive_groups_exclude_count = excludedCount;
    }
}

/**
 * 8. æœ€é•¿è¿å·é•¿åº¦æ’é™¤
 */
if (exclusion_conditions.maxConsecutiveLength && exclusion_conditions.maxConsecutiveLength.enabled) {
    const beforeMaxConsecutive = comboIds.length;
    const excludeLengths = exclusion_conditions.maxConsecutiveLength.lengths || [];

    if (excludeLengths.length > 0) {
        log(`ğŸ“ [HWC-POS] å¼€å§‹é•¿è¿å·é•¿åº¦æ’é™¤: æ’é™¤ ${excludeLengths.join(', ')}`);

        // æŸ¥è¯¢å€™é€‰ç»„åˆæ•°æ®
        const combinations = await DLTRedCombination.find({
            combination_id: { $in: comboIds }
        }).lean();

        // è¿‡æ»¤: æ’é™¤æŒ‡å®šæœ€é•¿è¿å·é•¿åº¦çš„ç»„åˆ
        const filteredCombinations = combinations.filter(combo => {
            // åŠ¨æ€è®¡ç®—è¿å·ç‰¹å¾ (å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰é¢„å­˜)
            let maxConsecutiveLength;
            if (combo.max_consecutive_length !== undefined) {
                maxConsecutiveLength = combo.max_consecutive_length;
            } else {
                const analysis = analyzeConsecutive(combo.balls);
                maxConsecutiveLength = analysis.maxConsecutiveLength;
            }

            // ä¿ç•™: æœ€é•¿è¿å·é•¿åº¦ä¸åœ¨æ’é™¤åˆ—è¡¨ä¸­
            return !excludeLengths.includes(maxConsecutiveLength);
        });

        // æ›´æ–°ç»„åˆIDåˆ—è¡¨
        comboIds = filteredCombinations.map(c => c.combination_id);

        const excludedCount = beforeMaxConsecutive - comboIds.length;
        log(`ğŸ“ [HWC-POS] é•¿è¿å·é•¿åº¦æ’é™¤å®Œæˆ: ä¿ç•™ ${comboIds.length}, æ’é™¤ ${excludedCount}`);

        // è®°å½•æ’é™¤ç»Ÿè®¡
        exclusion_summary.max_consecutive_length_exclude_count = excludedCount;
    }
}
```

---

### 3. æ’é™¤é¡ºåº

è¿å·æ’é™¤åº”è¯¥æ”¾åœ¨**æ’é™¤æ¡ä»¶çš„ç¬¬7æ­¥å’Œç¬¬8æ­¥**ï¼Œå› ä¸ºï¼š

1. **å‰6æ­¥**: å†å²å’Œå€¼ã€å†å²è·¨åº¦ã€å†å²çƒ­æ¸©å†·æ¯”ã€å†å²åŒºé—´æ¯”ã€ç›¸å…‹å¯¹ã€åŒç°æ¯”
2. **ç¬¬7æ­¥**: è¿å·ç»„æ•°æ’é™¤ (æ–°å¢)
3. **ç¬¬8æ­¥**: æœ€é•¿è¿å·é•¿åº¦æ’é™¤ (æ–°å¢)

**åŸå› **:
- è¿å·ç‰¹å¾æ˜¯**ç»„åˆå›ºæœ‰å±æ€§**ï¼Œä¸ä¾èµ–å†å²æ•°æ®
- å¯ä»¥åœ¨æ—©æœŸæ’é™¤é˜¶æ®µåº”ç”¨ï¼Œæé«˜æ•ˆç‡
- ä¸å…¶ä»–æ’é™¤æ¡ä»¶ç›¸äº’ç‹¬ç«‹ï¼Œé¡ºåºå¯è°ƒæ•´

---

## ğŸ¨ UIè®¾è®¡

### 1. HTMLç»“æ„

**æ–‡ä»¶**: `src/renderer/index.html`

**æ’å…¥ä½ç½®**: åœ¨"5æ­¥æ’é™¤æ¡ä»¶"åŒºåŸŸ (çº¦ç¬¬2800-3000è¡Œ)

**HTMLä»£ç **:
```html
<!-- ========== è¿å·æ’é™¤æ¡ä»¶ ========== -->
<div class="hwc-pos-exclude-section">
    <h4>ğŸ”¢ è¿å·æ’é™¤æ¡ä»¶</h4>

    <!-- è¿å·ç»„æ•°æ’é™¤ -->
    <div class="hwc-pos-exclude-item">
        <div class="exclude-header">
            <label>
                <input type="checkbox" id="hwc-pos-consecutive-groups-enabled" class="hwc-pos-exclude-checkbox">
                <span class="exclude-label">ğŸ”¢ è¿å·ç»„æ•°æ’é™¤</span>
            </label>
            <small class="help-text">æ’é™¤æŒ‡å®šè¿å·ç»„æ•°çš„ç»„åˆ</small>
        </div>
        <div class="exclude-body" id="hwc-pos-consecutive-groups-body" style="display: none;">
            <div class="consecutive-selection">
                <label>
                    <input type="checkbox" value="0" class="hwc-pos-consecutive-groups-cb" disabled>
                    <span>æ— è¿å· (0ç»„)</span>
                </label>
                <label>
                    <input type="checkbox" value="1" class="hwc-pos-consecutive-groups-cb" disabled>
                    <span>1ç»„è¿å·</span>
                </label>
                <label>
                    <input type="checkbox" value="2" class="hwc-pos-consecutive-groups-cb" disabled>
                    <span>2ç»„è¿å·</span>
                </label>
                <label>
                    <input type="checkbox" value="3" class="hwc-pos-consecutive-groups-cb" disabled>
                    <span>3ç»„è¿å·</span>
                </label>
                <label>
                    <input type="checkbox" value="4" class="hwc-pos-consecutive-groups-cb" disabled>
                    <span>4ç»„è¿å·</span>
                </label>
            </div>
            <div class="exclude-note">
                <strong>ğŸ’¡ è¯´æ˜ï¼š</strong>
                <ul>
                    <li><strong>æ— è¿å· (0ç»„)</strong>: å¦‚ [01, 05, 12, 23, 31] - æ‰€æœ‰å·ç éƒ½ä¸è¿ç»­</li>
                    <li><strong>1ç»„è¿å·</strong>: å¦‚ [03, 04, 05, 12, 23] - æœ‰1ä¸ª3è¿å· [03-04-05]</li>
                    <li><strong>2ç»„è¿å·</strong>: å¦‚ [03, 04, 12, 13, 31] - æœ‰2ä¸ª2è¿å· [03-04], [12-13]</li>
                    <li><strong>3ç»„è¿å·</strong>: å¦‚ [03, 04, 08, 09, 13, 14] - æœ‰3ä¸ª2è¿å·</li>
                    <li><strong>4ç»„è¿å·</strong>: å¦‚ [01, 02, 05, 06, 10, 11, 15, 16] - æœ‰4ä¸ª2è¿å·</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- æœ€é•¿è¿å·é•¿åº¦æ’é™¤ -->
    <div class="hwc-pos-exclude-item">
        <div class="exclude-header">
            <label>
                <input type="checkbox" id="hwc-pos-max-consecutive-enabled" class="hwc-pos-exclude-checkbox">
                <span class="exclude-label">ğŸ“ æœ€é•¿è¿å·é•¿åº¦æ’é™¤</span>
            </label>
            <small class="help-text">æ’é™¤æŒ‡å®šæœ€é•¿è¿å·é•¿åº¦çš„ç»„åˆ</small>
        </div>
        <div class="exclude-body" id="hwc-pos-max-consecutive-body" style="display: none;">
            <div class="consecutive-selection">
                <label>
                    <input type="checkbox" value="0" class="hwc-pos-max-consecutive-cb" disabled>
                    <span>æ— è¿å· (é•¿åº¦0)</span>
                </label>
                <label>
                    <input type="checkbox" value="2" class="hwc-pos-max-consecutive-cb" disabled>
                    <span>é•¿2è¿å·</span>
                </label>
                <label>
                    <input type="checkbox" value="3" class="hwc-pos-max-consecutive-cb" disabled>
                    <span>é•¿3è¿å·</span>
                </label>
                <label>
                    <input type="checkbox" value="4" class="hwc-pos-max-consecutive-cb" disabled>
                    <span>é•¿4è¿å·</span>
                </label>
                <label>
                    <input type="checkbox" value="5" class="hwc-pos-max-consecutive-cb" disabled>
                    <span>é•¿5è¿å·</span>
                </label>
            </div>
            <div class="exclude-note">
                <strong>ğŸ’¡ è¯´æ˜ï¼š</strong>
                <ul>
                    <li><strong>æ— è¿å· (0)</strong>: å¦‚ [01, 05, 12, 23, 31] - æ²¡æœ‰è¿ç»­å·ç </li>
                    <li><strong>é•¿2è¿å·</strong>: å¦‚ [03, 04, 12, 23, 31] - æœ€é•¿è¿ç»­2ä¸ª [03-04]</li>
                    <li><strong>é•¿3è¿å·</strong>: å¦‚ [03, 04, 05, 12, 23] - æœ€é•¿è¿ç»­3ä¸ª [03-04-05]</li>
                    <li><strong>é•¿4è¿å·</strong>: å¦‚ [01, 02, 03, 04, 12] - æœ€é•¿è¿ç»­4ä¸ª [01-02-03-04]</li>
                    <li><strong>é•¿5è¿å·</strong>: å¦‚ [01, 02, 03, 04, 05] - å…¨éƒ¨5ä¸ªè¿ç»­</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
.consecutive-selection {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 10px 0;
}

.consecutive-selection label {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    background: #f5f5f5;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
}

.consecutive-selection label:hover {
    background: #e8f4f8;
    border-color: #4CAF50;
}

.consecutive-selection input[type="checkbox"] {
    margin-right: 6px;
}

.consecutive-selection input[type="checkbox"]:disabled {
    cursor: not-allowed;
}

.consecutive-selection label:has(input:disabled) {
    opacity: 0.5;
    cursor: not-allowed;
}

.consecutive-selection label:has(input:checked) {
    background: #4CAF50;
    color: white;
    border-color: #4CAF50;
}

.exclude-note {
    margin-top: 10px;
    padding: 10px;
    background: #f0f8ff;
    border-left: 4px solid #2196F3;
    border-radius: 4px;
    font-size: 13px;
}

.exclude-note ul {
    margin: 8px 0 0 0;
    padding-left: 20px;
}

.exclude-note li {
    margin: 5px 0;
    line-height: 1.5;
}
</style>
```

---

### 2. JavaScripté€»è¾‘

**æ–‡ä»¶**: `src/renderer/dlt-module.js`

**ä½ç½®1**: äº‹ä»¶ç›‘å¬å™¨åˆå§‹åŒ– (åœ¨ `initHwcEventListeners` å‡½æ•°ä¸­)

```javascript
// è¿å·ç»„æ•°æ’é™¤è”åŠ¨
const consecutiveGroupsCheckbox = document.getElementById('hwc-pos-consecutive-groups-enabled');
const consecutiveGroupsBody = document.getElementById('hwc-pos-consecutive-groups-body');
const consecutiveGroupsCheckboxes = document.querySelectorAll('.hwc-pos-consecutive-groups-cb');

if (consecutiveGroupsCheckbox) {
    consecutiveGroupsCheckbox.addEventListener('change', function() {
        const enabled = this.checked;
        consecutiveGroupsBody.style.display = enabled ? 'block' : 'none';
        consecutiveGroupsCheckboxes.forEach(cb => cb.disabled = !enabled);
    });
}

// æœ€é•¿è¿å·é•¿åº¦æ’é™¤è”åŠ¨
const maxConsecutiveCheckbox = document.getElementById('hwc-pos-max-consecutive-enabled');
const maxConsecutiveBody = document.getElementById('hwc-pos-max-consecutive-body');
const maxConsecutiveCheckboxes = document.querySelectorAll('.hwc-pos-max-consecutive-cb');

if (maxConsecutiveCheckbox) {
    maxConsecutiveCheckbox.addEventListener('change', function() {
        const enabled = this.checked;
        maxConsecutiveBody.style.display = enabled ? 'block' : 'none';
        maxConsecutiveCheckboxes.forEach(cb => cb.disabled = !enabled);
    });
}
```

**ä½ç½®2**: æ•°æ®æ”¶é›† (åœ¨ `createHwcPositiveTask` å‡½æ•°ä¸­)

```javascript
// æ”¶é›†æ’é™¤æ¡ä»¶
const exclusionConditions = {};

// ... å…¶ä»–æ’é™¤æ¡ä»¶ ...

// è¿å·ç»„æ•°æ’é™¤
const consecutiveGroupsEnabled = document.getElementById('hwc-pos-consecutive-groups-enabled')?.checked || false;
if (consecutiveGroupsEnabled) {
    const selectedGroups = [];
    const groupCheckboxes = document.querySelectorAll('.hwc-pos-consecutive-groups-cb:checked');
    groupCheckboxes.forEach(cb => selectedGroups.push(parseInt(cb.value)));

    if (selectedGroups.length > 0) {
        exclusionConditions.consecutiveGroups = {
            enabled: true,
            groups: selectedGroups
        };
        console.log('ğŸ”¢ è¿å·ç»„æ•°æ’é™¤æ¡ä»¶å·²æ”¶é›†:', exclusionConditions.consecutiveGroups);
    }
}

// æœ€é•¿è¿å·é•¿åº¦æ’é™¤
const maxConsecutiveEnabled = document.getElementById('hwc-pos-max-consecutive-enabled')?.checked || false;
if (maxConsecutiveEnabled) {
    const selectedLengths = [];
    const lengthCheckboxes = document.querySelectorAll('.hwc-pos-max-consecutive-cb:checked');
    lengthCheckboxes.forEach(cb => selectedLengths.push(parseInt(cb.value)));

    if (selectedLengths.length > 0) {
        exclusionConditions.maxConsecutiveLength = {
            enabled: true,
            lengths: selectedLengths
        };
        console.log('ğŸ“ æœ€é•¿è¿å·é•¿åº¦æ’é™¤æ¡ä»¶å·²æ”¶é›†:', exclusionConditions.maxConsecutiveLength);
    }
}
```

**ä½ç½®3**: ä»»åŠ¡è¯¦æƒ…æ˜¾ç¤º (åœ¨ `viewHwcPosTaskDetail` å‡½æ•°ä¸­)

```javascript
// è¿å·ç»„æ•°æ’é™¤
if (task.exclusion_conditions.consecutiveGroups && task.exclusion_conditions.consecutiveGroups.enabled) {
    const groups = task.exclusion_conditions.consecutiveGroups.groups || [];
    if (groups.length > 0) {
        exclusionHtml += `
            <div class="condition-item">
                <strong>ğŸ”¢ è¿å·ç»„æ•°æ’é™¤:</strong>
                <span>${groups.join(', ')}ç»„</span>
            </div>
        `;
    }
}

// æœ€é•¿è¿å·é•¿åº¦æ’é™¤
if (task.exclusion_conditions.maxConsecutiveLength && task.exclusion_conditions.maxConsecutiveLength.enabled) {
    const lengths = task.exclusion_conditions.maxConsecutiveLength.lengths || [];
    if (lengths.length > 0) {
        const displayText = lengths.map(len => {
            if (len === 0) return 'æ— è¿å·';
            return `é•¿${len}è¿å·`;
        }).join('ã€');
        exclusionHtml += `
            <div class="condition-item">
                <strong>ğŸ“ æœ€é•¿è¿å·æ’é™¤:</strong>
                <span>${displayText}</span>
            </div>
        `;
    }
}
```

**ä½ç½®4**: æ’é™¤æ˜ç»†æ˜¾ç¤º (åœ¨ `showPeriodExclusionDetails` å‡½æ•°ä¸­)

```javascript
// æ·»åŠ è¿å·æ’é™¤ç»Ÿè®¡
const exclusions = [
    { label: 'å†å²å’Œå€¼æ’é™¤', count: summary.sum_exclude_count, color: '#ff9800' },
    { label: 'å†å²è·¨åº¦æ’é™¤', count: summary.span_exclude_count, color: '#ff5722' },
    { label: 'å†å²çƒ­æ¸©å†·æ¯”æ’é™¤', count: summary.hwc_exclude_count, color: '#f44336' },
    { label: 'å†å²åŒºé—´æ¯”æ’é™¤', count: summary.zone_exclude_count, color: '#e91e63' },
    { label: 'ç›¸å…‹å¯¹æ’é™¤', count: summary.conflict_exclude_count, color: '#9c27b0' },
    { label: 'åŒç°æ¯”æ’é™¤', count: summary.cooccurrence_exclude_count, color: '#673ab7' },
    { label: 'è¿å·ç»„æ•°æ’é™¤', count: summary.consecutive_groups_exclude_count, color: '#3f51b5' },  // æ–°å¢
    { label: 'æœ€é•¿è¿å·æ’é™¤', count: summary.max_consecutive_length_exclude_count, color: '#2196f3' }  // æ–°å¢
];
```

---

## ğŸ§ª æµ‹è¯•æ–¹æ¡ˆ

### 1. å•å…ƒæµ‹è¯•

#### æµ‹è¯•1: è¿å·ç‰¹å¾è®¡ç®—

```javascript
// æµ‹è¯•æ–‡ä»¶: test-consecutive-analysis.js

const assert = require('assert');

function analyzeConsecutive(redBalls) {
    // ... å®ç°ä»£ç  ...
}

// æµ‹è¯•ç”¨ä¾‹
const testCases = [
    { input: [1, 5, 12, 23, 31], expected: { consecutiveGroups: 0, maxConsecutiveLength: 0 } },
    { input: [3, 4, 12, 23, 31], expected: { consecutiveGroups: 1, maxConsecutiveLength: 2 } },
    { input: [3, 4, 5, 23, 31], expected: { consecutiveGroups: 1, maxConsecutiveLength: 3 } },
    { input: [3, 4, 12, 13, 31], expected: { consecutiveGroups: 2, maxConsecutiveLength: 2 } },
    { input: [3, 4, 5, 13, 14], expected: { consecutiveGroups: 2, maxConsecutiveLength: 3 } },
    { input: [1, 2, 3, 4, 5], expected: { consecutiveGroups: 1, maxConsecutiveLength: 5 } }
];

testCases.forEach((test, index) => {
    const result = analyzeConsecutive(test.input);
    assert.deepEqual(result, test.expected, `Test ${index + 1} failed`);
    console.log(`âœ… Test ${index + 1} passed: ${JSON.stringify(test.input)} â†’ ${JSON.stringify(result)}`);
});

console.log('âœ… All tests passed!');
```

---

### 2. é›†æˆæµ‹è¯•

#### æµ‹è¯•2: ä»»åŠ¡åˆ›å»ºå’Œæ’é™¤

**æ­¥éª¤**:
1. åˆ›å»ºçƒ­æ¸©å†·æ­£é€‰ä»»åŠ¡
2. å‹¾é€‰"è¿å·ç»„æ•°æ’é™¤": æ’é™¤0ç»„å’Œ4ç»„
3. å‹¾é€‰"æœ€é•¿è¿å·é•¿åº¦æ’é™¤": æ’é™¤é•¿5è¿å·
4. åˆ›å»ºä»»åŠ¡
5. éªŒè¯ä»»åŠ¡ä¿å­˜çš„æ’é™¤æ¡ä»¶
6. éªŒè¯ä»»åŠ¡æ‰§è¡Œåçš„æ’é™¤ç»Ÿè®¡

**é¢„æœŸç»“æœ**:
```json
{
  "exclusion_conditions": {
    "consecutiveGroups": {
      "enabled": true,
      "groups": [0, 4]
    },
    "maxConsecutiveLength": {
      "enabled": true,
      "lengths": [5]
    }
  }
}
```

---

### 3. UIäº¤äº’æµ‹è¯•

#### æµ‹è¯•3: è”åŠ¨äº¤äº’

**æ­¥éª¤**:
1. æ‰“å¼€"çƒ­æ¸©å†·æ­£é€‰æ‰¹é‡é¢„æµ‹"é¡µé¢
2. æ»šåŠ¨åˆ°"è¿å·æ’é™¤æ¡ä»¶"åŒºåŸŸ
3. ç‚¹å‡»"è¿å·ç»„æ•°æ’é™¤"ä¸»å¤é€‰æ¡†
4. éªŒè¯å­å¤é€‰æ¡†ä»ç¦ç”¨å˜ä¸ºå¯ç”¨
5. å‹¾é€‰å‡ ä¸ªå­å¤é€‰æ¡†
6. å–æ¶ˆä¸»å¤é€‰æ¡†
7. éªŒè¯å­å¤é€‰æ¡†æ¢å¤ç¦ç”¨ï¼Œä¸”é…ç½®åŒºåŸŸéšè—

**é¢„æœŸ**:
- âœ… ä¸»å¤é€‰æ¡†æ§åˆ¶é…ç½®åŒºåŸŸæ˜¾ç¤º/éšè—
- âœ… ä¸»å¤é€‰æ¡†æ§åˆ¶å­å¤é€‰æ¡†å¯ç”¨/ç¦ç”¨
- âœ… äº¤äº’æµç•…ï¼Œæ— å»¶è¿Ÿ

---

### 4. æ’é™¤æ•ˆæœæµ‹è¯•

#### æµ‹è¯•4: æ’é™¤æ•ˆæœéªŒè¯

**æ­¥éª¤**:
1. åˆ›å»ºä»»åŠ¡ï¼Œæ’é™¤"2ç»„è¿å·"
2. ä»»åŠ¡å®Œæˆåï¼Œå¯¼å‡ºExcel
3. éšæœºæŠ½å–10ä¸ªä¿ç•™çš„ç»„åˆ
4. æ‰‹åŠ¨è®¡ç®—æ¯ä¸ªç»„åˆçš„è¿å·ç»„æ•°
5. éªŒè¯æ²¡æœ‰2ç»„è¿å·çš„ç»„åˆ

**å·¥å…·è„šæœ¬**:
```javascript
// verify-consecutive-exclusion.js

const combinations = [
    [3, 4, 12, 13, 31],  // 2ç»„è¿å· â†’ åº”è¯¥è¢«æ’é™¤
    [3, 4, 5, 23, 31],   // 1ç»„è¿å· â†’ åº”è¯¥ä¿ç•™
    [1, 5, 12, 23, 31]   // 0ç»„è¿å· â†’ åº”è¯¥ä¿ç•™
];

combinations.forEach((combo, index) => {
    const analysis = analyzeConsecutive(combo);
    console.log(`ç»„åˆ ${index + 1}: ${combo} â†’ è¿å·ç»„æ•°: ${analysis.consecutiveGroups}`);
});
```

---

## âš ï¸ é£é™©è¯„ä¼°

### 1. é«˜é£é™©é¡¹

#### é£é™©1: æ•°æ®åº“å­—æ®µç¼ºå¤±

**æè¿°**: `DLTRedCombinations` è¡¨ä¸­çš„ `consecutive_groups` å’Œ `max_consecutive_length` å­—æ®µå¯èƒ½æœªé¢„å…ˆè®¡ç®—

**å½±å“**: å¯¼è‡´æŸ¥è¯¢æ•ˆç‡ä½ä¸‹ï¼Œéœ€è¦å®æ—¶è®¡ç®—

**ç¼“è§£æªæ–½**:
- âœ… åœ¨ç®—æ³•ä¸­æ·»åŠ åŠ¨æ€è®¡ç®—é€»è¾‘ (å¦‚æœå­—æ®µä¸å­˜åœ¨)
- âœ… æä¾›æ•°æ®è¿ç§»è„šæœ¬ï¼Œæ‰¹é‡è®¡ç®—å¹¶å¡«å……è¿™ä¸¤ä¸ªå­—æ®µ
- âœ… ä¸ºè¿™ä¸¤ä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½

**è¿ç§»è„šæœ¬**:
```javascript
// migrate-consecutive-fields.js

const mongoose = require('mongoose');
const DLTRedCombination = require('./path/to/model');

async function migrateConsecutiveFields() {
    const combinations = await DLTRedCombination.find({
        $or: [
            { consecutive_groups: { $exists: false } },
            { max_consecutive_length: { $exists: false } }
        ]
    });

    console.log(`éœ€è¦è¿ç§»çš„ç»„åˆæ•°: ${combinations.length}`);

    for (const combo of combinations) {
        const analysis = analyzeConsecutive(combo.balls);
        await DLTRedCombination.updateOne(
            { combination_id: combo.combination_id },
            {
                $set: {
                    consecutive_groups: analysis.consecutiveGroups,
                    max_consecutive_length: analysis.maxConsecutiveLength
                }
            }
        );
    }

    console.log('âœ… è¿ç§»å®Œæˆ');
}

migrateConsecutiveFields();
```

---

### 2. ä¸­é£é™©é¡¹

#### é£é™©2: UIå¤æ‚åº¦å¢åŠ 

**æè¿°**: æ–°å¢ä¸¤ä¸ªæ’é™¤æ¡ä»¶ï¼ŒUIå¯èƒ½å˜å¾—æ‹¥æŒ¤

**å½±å“**: ç”¨æˆ·ä½“éªŒä¸‹é™ï¼Œé…ç½®éš¾åº¦å¢åŠ 

**ç¼“è§£æªæ–½**:
- âœ… ä½¿ç”¨æŠ˜å é¢æ¿ï¼Œé»˜è®¤æŠ˜å è¿å·æ’é™¤åŒºåŸŸ
- âœ… æä¾›æ¸…æ™°çš„è¯´æ˜å’Œç¤ºä¾‹
- âœ… ä½¿ç”¨è§†è§‰å±‚æ¬¡ï¼Œçªå‡ºé‡è¦é…ç½®

---

#### é£é™©3: æ€§èƒ½å½±å“

**æè¿°**: å¢åŠ ä¸¤ä¸ªæ’é™¤æ¡ä»¶ï¼Œå¯èƒ½å¢åŠ å¤„ç†æ—¶é—´

**å½±å“**: ä»»åŠ¡å®Œæˆæ—¶é—´å»¶é•¿

**ç¼“è§£æªæ–½**:
- âœ… åˆ©ç”¨æ•°æ®åº“ç´¢å¼•åŠ é€ŸæŸ¥è¯¢
- âœ… ä¼˜å…ˆä½¿ç”¨é¢„è®¡ç®—å­—æ®µï¼Œé¿å…å®æ—¶è®¡ç®—
- âœ… åœ¨æ’é™¤é¡ºåºä¸­ä¼˜å…ˆæ‰§è¡Œæ•ˆç‡é«˜çš„æ¡ä»¶

---

### 3. ä½é£é™©é¡¹

#### é£é™©4: ç”¨æˆ·ç†è§£å›°éš¾

**æè¿°**: ç”¨æˆ·å¯èƒ½ä¸ç†è§£"è¿å·ç»„æ•°"å’Œ"æœ€é•¿è¿å·é•¿åº¦"çš„åŒºåˆ«

**å½±å“**: é…ç½®é”™è¯¯ï¼Œé¢„æµ‹ç»“æœä¸ç¬¦åˆé¢„æœŸ

**ç¼“è§£æªæ–½**:
- âœ… æä¾›è¯¦ç»†çš„è¯´æ˜å’Œç¤ºä¾‹
- âœ… åœ¨UIä¸­ä½¿ç”¨ç›´è§‚çš„å¯è§†åŒ–
- âœ… åœ¨æ–‡æ¡£ä¸­è¡¥å……æ•™ç¨‹å’ŒFAQ

---

## ğŸ“Š å®æ–½ä¼˜å…ˆçº§

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | ä¼°æ—¶ | ä¾èµ– |
|-----|-------|------|------|
| 1. Schemaæ‰©å±• | P0 (æœ€é«˜) | 30åˆ†é’Ÿ | æ—  |
| 2. åç«¯ç®—æ³•å®ç° | P0 (æœ€é«˜) | 1å°æ—¶ | 1 |
| 3. å‰ç«¯UIå¼€å‘ | P1 (é«˜) | 1å°æ—¶ | 1 |
| 4. å‰ç«¯é€»è¾‘å¼€å‘ | P1 (é«˜) | 1å°æ—¶ | 2, 3 |
| 5. æ•°æ®è¿ç§»è„šæœ¬ | P2 (ä¸­) | 30åˆ†é’Ÿ | 1 |
| 6. å•å…ƒæµ‹è¯• | P2 (ä¸­) | 1å°æ—¶ | 2 |
| 7. é›†æˆæµ‹è¯• | P3 (ä½) | 1å°æ—¶ | 4 |

**æ€»ä¼°æ—¶**: 6å°æ—¶

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

- [ ] Schemaæ‰©å±•å®Œæˆï¼Œåº”ç”¨å¯æ­£å¸¸å¯åŠ¨
- [ ] åˆ›å»ºä»»åŠ¡æ—¶å¯å‹¾é€‰è¿å·æ’é™¤æ¡ä»¶
- [ ] è¿å·æ’é™¤æ¡ä»¶æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“
- [ ] ä»»åŠ¡æ‰§è¡Œæ—¶è¿å·æ’é™¤é€»è¾‘ç”Ÿæ•ˆ
- [ ] æ’é™¤ç»Ÿè®¡æ­£ç¡®è®°å½•æ’é™¤æ•°é‡
- [ ] ä»»åŠ¡è¯¦æƒ…æ­£ç¡®æ˜¾ç¤ºè¿å·æ’é™¤é…ç½®
- [ ] æ’é™¤æ˜ç»†æ­£ç¡®æ˜¾ç¤ºè¿å·æ’é™¤ç»Ÿè®¡

### æ€§èƒ½éªŒæ”¶

- [ ] å•æœŸå¤„ç†æ—¶é—´å¢åŠ  < 10%
- [ ] æ•°æ®åº“æŸ¥è¯¢å“åº”æ—¶é—´ < 100ms
- [ ] UIäº¤äº’å“åº”æ—¶é—´ < 200ms

### ç”¨æˆ·ä½“éªŒéªŒæ”¶

- [ ] UIå¸ƒå±€åˆç†ï¼Œä¸æ‹¥æŒ¤
- [ ] è¯´æ˜æ¸…æ™°ï¼Œæ˜“äºç†è§£
- [ ] äº¤äº’æµç•…ï¼Œæ— å¡é¡¿
- [ ] é”™è¯¯æç¤ºå‹å¥½

---

## ğŸ“š å‚è€ƒèµ„æ–™

- `src/server/server.js:320-353` - `analyzeConsecutive` å‡½æ•°
- `src/server/server.js:376-377` - è¿å·å­—æ®µå®šä¹‰
- `src/server/server.js:742-743` - ç»„åˆæ‰¹é‡é¢„æµ‹Schema
- `src/renderer/index.html:2002-2027` - ç»„åˆæ‰¹é‡é¢„æµ‹UI
- `src/renderer/dlt-module.js:11017-11049` - ç»„åˆæ‰¹é‡é¢„æµ‹é€»è¾‘
- `å¤§ä¹é€çƒ­æ¸©å†·æ­£é€‰æ‰¹é‡é¢„æµ‹-å®Œæ•´æµç¨‹æ–‡æ¡£.md` - ç³»ç»Ÿæ¶æ„è¯´æ˜

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**è¯·ç¡®è®¤ä»¥ä¸‹é—®é¢˜**:

1. âœ… æ˜¯å¦åŒæ„æœ¬æ–¹æ¡ˆçš„è®¾è®¡æ€è·¯ï¼Ÿ
2. âœ… æ˜¯å¦éœ€è¦è°ƒæ•´UIå¸ƒå±€æˆ–è¯´æ˜æ–‡æ¡ˆï¼Ÿ
3. âœ… æ˜¯å¦éœ€è¦é¢å¤–çš„æ’é™¤é€»è¾‘æˆ–ç»Ÿè®¡ä¿¡æ¯ï¼Ÿ
4. âœ… æ˜¯å¦éœ€è¦æ•°æ®è¿ç§»è„šæœ¬æ¥å¡«å……å†å²æ•°æ®ï¼Ÿ
5. âœ… æ˜¯å¦æœ‰å…¶ä»–ç‰¹æ®Šéœ€æ±‚æˆ–é™åˆ¶ï¼Ÿ

**ç¡®è®¤åæˆ‘å°†å¼€å§‹å®æ–½ï¼**

---

**æ–‡æ¡£ç»“æŸ**
