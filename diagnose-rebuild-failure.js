const mongoose = require('mongoose');

console.log('ğŸ” è¯Šæ–­å…¨é‡é‡å»ºå¤±è´¥åŸå› ...\n');

mongoose.connect('mongodb://127.0.0.1:27017/lottery').then(async () => {
  const db = mongoose.connection.db;

  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ“Š æ£€æŸ¥1: çƒ­æ¸©å†·ä¼˜åŒ–è¡¨çŠ¶æ€');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

  const hwcCollection = 'hit_dlt_redcombinationshotwarmcoldoptimizeds';
  const hwcCount = await db.collection(hwcCollection).countDocuments();
  const hwcLatest = await db.collection(hwcCollection)
    .find({})
    .sort({ target_issue: -1 })
    .limit(1)
    .toArray();

  console.log(`çƒ­æ¸©å†·ä¼˜åŒ–è¡¨: ${hwcCount} æ¡è®°å½•`);
  console.log(`æœ€æ–°æœŸå·å¯¹: ${hwcLatest[0]?.base_issue}â†’${hwcLatest[0]?.target_issue}`);
  console.log(`âŒ é—®é¢˜: æ•°æ®ä»ç„¶åœç•™åœ¨æ—§æ•°æ®ï¼ˆ9152â†’9153ï¼‰\n`);

  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ“Š æ£€æŸ¥2: é—æ¼å€¼è¡¨çŠ¶æ€');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

  const missingCollection = 'hit_dlt_basictrendchart_redballmissing_histories';
  const missingCount = await db.collection(missingCollection).countDocuments();
  const missingLatest = await db.collection(missingCollection)
    .find({})
    .sort({ Issue: -1 })
    .limit(1)
    .toArray();

  console.log(`é—æ¼å€¼è¡¨: ${missingCount} æ¡è®°å½•`);
  console.log(`æœ€æ–°æœŸå·: ${missingLatest[0]?.Issue}\n`);

  if (missingLatest[0]?.Issue < 25124) {
    console.log(`âŒ æ ¹æœ¬åŸå› : é—æ¼å€¼è¡¨æ•°æ®ä¹Ÿæ˜¯æ—§çš„ï¼ˆæœ€æ–°=${missingLatest[0]?.Issue}ï¼‰`);
    console.log(`   å…¨é‡é‡å»ºæ­¥éª¤1ï¼ˆç”Ÿæˆé—æ¼å€¼è¡¨ï¼‰å¯èƒ½å¤±è´¥äº†ï¼\n`);
  }

  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ“Š æ£€æŸ¥3: ä¸»æ•°æ®è¡¨çŠ¶æ€');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

  const mainCollection = 'hit_dlts';
  const mainCount = await db.collection(mainCollection).countDocuments();
  const mainLatest = await db.collection(mainCollection)
    .find({})
    .sort({ Issue: -1 })
    .limit(1)
    .toArray();

  console.log(`ä¸»æ•°æ®è¡¨: ${mainCount} æ¡è®°å½•`);
  console.log(`æœ€æ–°æœŸå·: ${mainLatest[0]?.Issue}`);

  if (mainLatest[0]?.Issue === 25124) {
    console.log(`âœ… ä¸»æ•°æ®è¡¨æ­£å¸¸ï¼ˆæœ‰æœ€æ–°æ•°æ®25124ï¼‰\n`);
  }

  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ” æ£€æŸ¥4: æœç´¢æœåŠ¡å™¨æ—¥å¿—å…³é”®è¯');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

  console.log('è¯·åœ¨æœåŠ¡å™¨æ§åˆ¶å°ï¼ˆnpm startçª—å£ï¼‰æœç´¢ä»¥ä¸‹å…³é”®è¯ï¼š\n');
  console.log('1. "æ­¥éª¤1/6: ç”Ÿæˆé—æ¼å€¼è¡¨" - æ£€æŸ¥æ˜¯å¦æˆåŠŸ');
  console.log('2. "å·²åˆ é™¤" - æ£€æŸ¥åˆ é™¤äº†å¤šå°‘æ¡æ—§è®°å½•');
  console.log('3. "è·³è¿‡" æˆ– "skipped" - æ£€æŸ¥æ˜¯å¦æœ‰æœŸå·è¢«è·³è¿‡');
  console.log('4. "âŒ" æˆ– "é”™è¯¯" - æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯');
  console.log('5. "ğŸ‰ ç»Ÿä¸€æ›´æ–°å®Œæˆ" - æ£€æŸ¥æ˜¯å¦çœŸçš„å®Œæˆ\n');

  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ’¡ å¯èƒ½çš„åŸå› ');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

  console.log('åŸå› 1: å…¨é‡é‡å»ºæ¨¡å¼æ²¡æœ‰ç”Ÿæ•ˆï¼ˆåç«¯ä»ç”¨å¢é‡æ¨¡å¼ï¼‰');
  console.log('åŸå› 2: æ­¥éª¤1ï¼ˆç”Ÿæˆé—æ¼å€¼è¡¨ï¼‰å¤±è´¥ï¼Œå¯¼è‡´åç»­æ­¥éª¤æ— æ³•è¿›è¡Œ');
  console.log('åŸå› 3: æ•°æ®åº“å†™å…¥æƒé™é—®é¢˜');
  console.log('åŸå› 4: æœåŠ¡å™¨è¿›ç¨‹å´©æºƒæˆ–ä¸­æ–­\n');

  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ› ï¸  å»ºè®®çš„è¯Šæ–­æ­¥éª¤');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

  console.log('æ­¥éª¤1: æ£€æŸ¥æœåŠ¡å™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯è¾“å‡º');
  console.log('æ­¥éª¤2: ç¡®è®¤æœåŠ¡å™¨è¿›ç¨‹æ˜¯å¦ä»åœ¨è¿è¡Œ');
  console.log('æ­¥éª¤3: æ£€æŸ¥MongoDBæ˜¯å¦æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´');
  console.log('æ­¥éª¤4: å†æ¬¡è¿è¡Œå…¨é‡é‡å»ºï¼Œå¹¶ä»”ç»†è§‚å¯Ÿæ—¥å¿—\n');

  await mongoose.connection.close();
}).catch(err => {
  console.error('âŒ æ•°æ®åº“è¿æ¥å¤±è´¥:', err.message);
  process.exit(1);
});
