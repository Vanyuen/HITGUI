# 热温冷正选批量预测 UI 优化解决方案

## 一、问题分析

### 当前现状
热温冷正选批量预测面板（`index.html:2704-3999`）总计约 **1300+ 行HTML**，主要分布：

| 区块 | 行数估算 | 配置项数量 |
|------|----------|------------|
| 正选条件配置 (6步) | ~520行 | 21+21+3+3+6+7 = 61个选项 |
| 排除条件配置 (8个) | ~400行 | 8个主条件 + 多个子选项 |
| 输出配置 | ~100行 | 10+个选项 |

### 用户痛点
1. 页面过长，需要频繁滚动
2. 配置项过多，不便于管理
3. 无法保存/复用常用配置组合

---

## 二、解决方案设计

### 2.1 UI重构：弹窗二级面板

**改造思路**：将正选条件和排除条件从内联展示改为「摘要卡片 + 弹窗详细配置」模式。

#### 改造前（当前）
```
┌─────────────────────────────────────────────────┐
│ 期号范围配置                                      │
├─────────────────────────────────────────────────┤
│ ✨ 正选条件配置 (6步逐步筛选)                     │
│   ├─ 步骤1: 热温冷比 (大量复选框...)              │
│   ├─ 步骤2: 区间比 (大量复选框...)                │
│   ├─ 步骤3: 和值范围                              │
│   ├─ 步骤4: 跨度范围                              │
│   ├─ 步骤5: 奇偶比                                │
│   └─ 步骤6: AC值                                  │
│                        ↓ 需要滚动很长距离          │
├─────────────────────────────────────────────────┤
│ 🔧 排除条件配置 (8个条件)                         │
│   ├─ 条件1-8 (每个条件还有子选项...)              │
│                        ↓ 继续滚动                  │
├─────────────────────────────────────────────────┤
│ ⚙️ 输出配置                                       │
│ 🚀 创建任务按钮                                   │
└─────────────────────────────────────────────────┘
```

#### 改造后（新方案）
```
┌─────────────────────────────────────────────────┐
│ 📅 期号范围配置 (保持不变，约3行)                  │
├─────────────────────────────────────────────────┤
│ ✨ 正选条件配置                                   │
│  ┌────────────────────────────────────────────┐ │
│  │ 📋 当前配置摘要:                            │ │
│  │  • 热温冷比: 8种 (3:2:0, 3:1:1...)          │ │
│  │  • 区间比: 6种                              │ │
│  │  • 和值: 60-120                             │ │
│  │  • 跨度: 18-32                              │ │
│  │  • 奇偶比: 2种 (2:3, 3:2)                   │ │
│  │  • AC值: 3种 (4,5,6)                        │ │
│  │  预计筛选: 324,632 → ~20,000 组合            │ │
│  │                                              │ │
│  │  [⚙️ 配置正选条件] [💾 保存配置▼] [📂 加载配置▼] │
│  └────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────┤
│ 🔧 排除条件配置                                   │
│  ┌────────────────────────────────────────────┐ │
│  │ 📋 当前配置摘要:                            │ │
│  │  • 已启用: 3个条件                          │ │
│  │  • 历史和值排除: 最近10期                    │ │
│  │  • 相克对排除: 全局Top18                     │ │
│  │  • 同现比排除: 阈值10%, 30期                 │ │
│  │                                              │ │
│  │  [⚙️ 配置排除条件] [💾 保存配置▼] [📂 加载配置▼] │
│  └────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────┤
│ ⚙️ 输出配置 (保持不变或也可折叠)                   │
│ 🚀 创建热温冷正选批量预测任务                      │
└─────────────────────────────────────────────────┘
```

### 2.2 弹窗设计

#### 正选条件配置弹窗
```
┌────────────────────────────────────────────────────────────────┐
│ ✨ 正选条件配置                                           [×]  │
├────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐│
│ │ 配置管理: [💾 保存当前配置] [选择配置: [配置1 ▼]]            ││
│ │           已保存: 配置1, 配置2, 配置3...                     ││
│ └─────────────────────────────────────────────────────────────┘│
├────────────────────────────────────────────────────────────────┤
│ [Tab] 步骤1 | 步骤2 | 步骤3 | 步骤4 | 步骤5 | 步骤6            │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│   🌡️ 正选步骤 1/6: 热温冷比                                   │
│                                                                │
│   快捷选择: [常见8种] [热号主导] [平衡比例] [全选] [清空]       │
│                                                                │
│   ┌─ 极端比例 (3种) ─────────────────────────────────────────┐ │
│   │ □ 5:0:0    □ 0:5:0    □ 0:0:5                            │ │
│   └──────────────────────────────────────────────────────────┘ │
│   ┌─ 高倾向比例 (6种) ───────────────────────────────────────┐ │
│   │ □ 4:1:0    □ 4:0:1    □ 1:4:0    □ 0:4:1    □ 1:0:4...   │ │
│   └──────────────────────────────────────────────────────────┘ │
│   ┌─ 平衡比例 (12种) ⭐推荐 ─────────────────────────────────┐ │
│   │ ☑ 3:2:0    ☑ 3:1:1    □ 3:0:2    ☑ 2:3:0 ...            │ │
│   └──────────────────────────────────────────────────────────┘ │
│                                                                │
│   ✅ 已选择 8 种热温冷比 | 预计筛选约 220,000 个组合           │
│                                                                │
├────────────────────────────────────────────────────────────────┤
│               [◀ 上一步]    [下一步 ▶]    [✅ 完成配置]        │
└────────────────────────────────────────────────────────────────┘
```

#### 排除条件配置弹窗
```
┌────────────────────────────────────────────────────────────────┐
│ 🔧 排除条件配置                                           [×]  │
├────────────────────────────────────────────────────────────────┤
│ 配置管理: [💾 保存当前配置] [选择配置: [排除配置1 ▼]]          │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│ ┌─ 条件1: 历史和值排除 ──────────────────────────── [开关] ─┐ │
│ │  排除最近 [10] 期内的和值                                  │ │
│ └────────────────────────────────────────────────────────────┘ │
│                                                                │
│ ┌─ 条件2: 历史跨度排除 ──────────────────────────── [开关] ─┐ │
│ │  排除最近 [10] 期内的跨度                                  │ │
│ └────────────────────────────────────────────────────────────┘ │
│                                                                │
│ ┌─ 条件3: 历史热温冷比排除 ─────────────────────── [开关] ─┐  │
│ │  排除最近 [10] 期内的热温冷比                              │ │
│ └────────────────────────────────────────────────────────────┘ │
│                                                                │
│ ┌─ 条件4: 相克对排除 ─────────────────────────────── [开关] ─┐│
│ │  ▼ 展开详细配置                                            ││
│ │    ☑ 全局Top排除: 分析2700期, Top18对                      ││
│ │       ☑ 热号保护: 前3名                                    ││
│ │    □ 每号Top排除                                           ││
│ │    □ 阈值排除                                              ││
│ └────────────────────────────────────────────────────────────┘ │
│                                                                │
│ ┌─ 条件5: 同现比排除 ─────────────────────────────── [开关] ─┐│
│ │  ▼ 展开详细配置                                            ││
│ └────────────────────────────────────────────────────────────┘ │
│                                                                │
│ ... (条件6-8 类似)                                             │
│                                                                │
│ 已启用 3 个排除条件 | 预计进一步筛选 5-15%                     │
│                                                                │
├────────────────────────────────────────────────────────────────┤
│                              [✅ 完成配置]                      │
└────────────────────────────────────────────────────────────────┘
```

---

## 三、配置保存/加载功能设计

### 3.1 数据结构

```javascript
// 正选条件配置对象
const PositiveSelectionConfig = {
    name: "配置名称",           // 用户自定义名称
    createdAt: "2025-12-03",   // 创建时间
    hwcRatios: ["3:2:0", "3:1:1", "2:3:0", ...],  // 热温冷比
    zoneRatios: ["3:2:0", "3:1:1", "2:2:1", ...], // 区间比
    sumRanges: [
        { enabled: true, min: 60, max: 90 },
        { enabled: true, min: 91, max: 120 },
        { enabled: false, min: null, max: null }
    ],
    spanRanges: [
        { enabled: true, min: 18, max: 25 },
        { enabled: true, min: 26, max: 32 },
        { enabled: false, min: null, max: null }
    ],
    oddEvenRatios: ["2:3", "3:2"],
    acValues: [4, 5, 6]
};

// 排除条件配置对象
const ExclusionConfig = {
    name: "排除配置名称",
    createdAt: "2025-12-03",
    sumExclusion: { enabled: false, period: 10 },
    spanExclusion: { enabled: false, period: 10 },
    hwcExclusion: { enabled: false, period: 10 },
    conflictExclusion: {
        enabled: true,
        globalTop: { enabled: true, period: 2700, top: 18, hotProtect: { enabled: true, top: 3 } },
        perBallTop: { enabled: false, period: 2700, top: 1, hotProtect: { enabled: false, top: 3 } },
        threshold: { enabled: false, value: 1 }
    },
    cooccurExclusion: {
        enabled: true,
        threshold: { enabled: true, type: "combo_2", value: 10, period: 30 },
        historical: { enabled: false, period: 10, combo2: true, combo3: false, combo4: false },
        perBall: { enabled: false, periods: 1, combo2: false, combo3: false, combo4: false }
    },
    zoneExclusion: { enabled: false, period: 10 },
    consecutiveGroups: { enabled: false, values: [] },
    maxConsecutive: { enabled: false, values: [] }
};
```

### 3.2 存储方案

使用 **localStorage** 存储配置（最多6个/类）：

```javascript
// 存储键名
const STORAGE_KEYS = {
    POSITIVE_CONFIGS: 'hwc_positive_selection_configs',  // 正选配置列表
    EXCLUSION_CONFIGS: 'hwc_exclusion_configs'           // 排除配置列表
};

// 存储结构示例
localStorage['hwc_positive_selection_configs'] = JSON.stringify([
    { id: 1, name: "常用配置1", config: {...}, createdAt: "2025-12-03" },
    { id: 2, name: "高命中配置", config: {...}, createdAt: "2025-12-02" },
    // ... 最多6个
]);
```

### 3.3 配置管理UI

#### 保存配置下拉菜单
```
┌──────────────────────────────┐
│ 💾 保存配置 ▼                │
├──────────────────────────────┤
│ [输入配置名称: __________ ]  │
│ [💾 保存为新配置]            │
├──────────────────────────────┤
│ 覆盖已有配置:                │
│  • 配置1 (2025-12-01)        │
│  • 配置2 (2025-12-02)        │
│  • 常用配置 (2025-12-03)     │
└──────────────────────────────┘
```

#### 加载配置下拉菜单
```
┌──────────────────────────────┐
│ 📂 加载配置 ▼                │
├──────────────────────────────┤
│ ○ 配置1 (2025-12-01)    [🗑] │
│ ○ 配置2 (2025-12-02)    [🗑] │
│ ● 常用配置 (2025-12-03) [🗑] │
│ ○ 高命中率 (2025-12-03) [🗑] │
├──────────────────────────────┤
│ [📂 加载选中配置]            │
└──────────────────────────────┘
```

---

## 四、实施计划

### 阶段1: HTML结构重构
1. 将正选条件配置区域改为摘要卡片
2. 将排除条件配置区域改为摘要卡片
3. 创建两个弹窗模板（正选/排除）
4. 保持期号范围配置和输出配置的原有位置

### 阶段2: JavaScript功能开发
1. 弹窗打开/关闭逻辑
2. Tab切换逻辑（正选条件6步切换）
3. 配置摘要实时更新逻辑
4. 配置保存/加载功能
5. 配置验证逻辑

### 阶段3: 样式优化
1. 弹窗样式（居中、动画、遮罩）
2. 摘要卡片样式
3. Tab切换动画
4. 响应式适配

### 阶段4: 测试与调整
1. 功能测试（配置保存/加载）
2. 边界情况测试（6个配置上限）
3. 与后端API对接验证
4. 性能测试

---

## 五、文件改动范围

| 文件 | 改动类型 | 预估行数 |
|------|----------|----------|
| `src/renderer/index.html` | 重构 | 修改约800行，新增约200行 |
| `src/renderer/dlt-module.js` | 新增功能 | 新增约500行 |
| `src/renderer/styles.css` (或内联) | 新增样式 | 新增约200行 |

---

## 六、预期效果

### 改造前
- 页面高度: ~2500px（需滚动4-5屏）
- 配置不可复用

### 改造后
- 页面高度: ~800px（1屏内完成）
- 支持6个正选配置 + 6个排除配置保存/加载
- 弹窗内分Tab/折叠，逻辑清晰

---

## 七、确认事项

请确认以下事项：

1. **弹窗交互方式**：
   - [ ] 点击「配置正选/排除条件」按钮打开弹窗
   - [ ] 弹窗外点击遮罩层关闭弹窗
   - [ ] ESC键关闭弹窗

2. **配置保存数量**：
   - [ ] 正选配置: 最多6个
   - [ ] 排除配置: 最多6个
   - [ ] 超过数量时提示用户删除旧配置

3. **正选条件弹窗内部导航**：
   - [ ] 方案A: Tab切换（顶部6个Tab按钮）
   - [ ] 方案B: 步骤导航（上一步/下一步）
   - [ ] 方案C: 全部展示在一个滚动区域内

4. **排除条件弹窗内部布局**：
   - [ ] 方案A: 全部条件平铺展示（内部滚动）
   - [ ] 方案B: 手风琴折叠展示（点击展开单个条件）

5. **输出配置处理**：
   - [ ] 方案A: 保持原样（不做弹窗改造）
   - [ ] 方案B: 也改为摘要+弹窗模式

---

**请确认以上方案，我将根据您的选择开始实施。**
