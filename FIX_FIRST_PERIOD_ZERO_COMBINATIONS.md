# ç¬¬ä¸€ä¸ªç›®æ ‡æœŸå·æ— æ•°æ®é—®é¢˜ä¿®å¤æ–¹æ¡ˆ

## é—®é¢˜æè¿°

**ç°è±¡**ï¼š
- ç”¨æˆ·é€‰æ‹©æœŸå·èŒƒå›´ï¼š25120-25125ï¼ˆéƒ½æ˜¯ç›®æ ‡æœŸå·ï¼‰
- ç¬¬ä¸€ä¸ªæœŸå·25120æ˜¾ç¤º0ä¸ªç»„åˆï¼Œè¢«è·³è¿‡
- åŸå› ï¼š25120éœ€è¦baseæœŸ25119ï¼Œä½†25119ä¸åœ¨ç”¨æˆ·é€‰æ‹©èŒƒå›´å†…

**å½“å‰é€»è¾‘**ï¼š
```javascript
// æŸ¥è¯¢ç¬¬ä¸€ä¸ªæœŸå·çš„ä¸Šä¸€æœŸï¼ˆID-1ï¼‰
const firstIssueNum = issueNumbers[0];  // 25120
const firstIssueRecord = await hit_dlts.findOne({ Issue: firstIssueNum });

// æŸ¥è¯¢æ‰€æœ‰æœŸå·ï¼ˆåŒ…æ‹¬ç¬¬ä¸€ä¸ªæœŸå·çš„ä¸Šä¸€æœŸï¼‰
const allIssueNums = [firstIssueRecord.ID - 1, ...issueNumbers];  // [2787, 2788, 2789, ...]

// ä½†æ˜¯æŸ¥è¯¢æ¡ä»¶å¯¼è‡´ID=2787çš„è®°å½•å¯èƒ½æŸ¥ä¸åˆ°
const allRecords = await hit_dlts.find({
    $or: [
        { ID: { $in: allIssueNums } },  // åŒ…å«2787
        { Issue: { $in: issueNumbers } }  // 25120-25125
    ]
});

// æœŸå·å¯¹ç”Ÿæˆ
for (const record of issueRecords) {  // issueRecordsåªåŒ…å«25120-25125
    const baseRecord = idToRecordMap.get(targetID - 1);
    if (baseRecord) {  // 25120çš„baseæœŸ25119(ID=2787)
        issuePairs.push({ base_issue, target_issue });
    } else {
        log(`âš ï¸ æœŸå·${targetIssue}çš„ä¸Šä¸€æœŸä¸å­˜åœ¨ï¼Œè·³è¿‡è¯¥æœŸ`);  // â† è¿™é‡Œå¯¼è‡´è·³è¿‡
    }
}
```

**é—®é¢˜**ï¼š`allRecords` çš„æŸ¥è¯¢é€»è¾‘å¯èƒ½æ²¡æœ‰æ­£ç¡®è·å–åˆ°ç¬¬ä¸€ä¸ªæœŸå·çš„baseæœŸã€‚

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šä¼˜åŒ–baseæœŸæŸ¥è¯¢é€»è¾‘ï¼ˆæ¨èï¼‰

**ä¿®æ”¹ä½ç½®**ï¼š`src/server/server.js:16341-16351`

**æ ¸å¿ƒæ”¹è¿›**ï¼š
1. æ˜ç¡®æŸ¥è¯¢ç¬¬ä¸€ä¸ªç›®æ ‡æœŸå·çš„baseæœŸï¼ˆID-1ï¼‰
2. ç¡®ä¿baseæœŸä¸€å®šè¢«æŸ¥è¯¢åˆ°
3. å°†baseæœŸåŠ å…¥åˆ°æœŸå·å¯¹ç”Ÿæˆé€»è¾‘ä¸­

**ä¿®æ”¹ä»£ç **ï¼š
```javascript
// æŸ¥è¯¢æ‰€æœ‰æœŸå·ï¼ˆåŒ…æ‹¬ç¬¬ä¸€ä¸ªæœŸå·çš„ä¸Šä¸€æœŸï¼‰
const allIssueNums = [firstIssueRecord.ID - 1, ...issueNumbers];

// ğŸ”§ ä¿®å¤ï¼šåˆ†ä¸¤æ­¥æŸ¥è¯¢ï¼Œç¡®ä¿baseæœŸä¸€å®šèƒ½æŸ¥åˆ°
// ç¬¬1æ­¥ï¼šæŸ¥è¯¢ç¬¬ä¸€ä¸ªæœŸå·çš„baseæœŸï¼ˆID-1ï¼‰
const baseIssueRecord = await hit_dlts.findOne({ ID: firstIssueRecord.ID - 1 })
    .select('Issue ID')
    .lean();

// ç¬¬2æ­¥ï¼šæŸ¥è¯¢æ‰€æœ‰ç›®æ ‡æœŸå·
const targetRecords = await hit_dlts.find({
    Issue: { $in: issueNumbers }
})
    .select('Issue ID')
    .sort({ ID: 1 })
    .lean();

// åˆå¹¶æ‰€æœ‰è®°å½•
const allRecords = baseIssueRecord
    ? [baseIssueRecord, ...targetRecords]  // åŒ…å«baseæœŸ
    : targetRecords;  // å¦‚æœbaseæœŸä¸å­˜åœ¨ï¼ˆæç«¯æƒ…å†µï¼‰

log(`  ğŸ“Š æŸ¥è¯¢åˆ°${allRecords.length}æ¡è®°å½• (åŒ…å«${baseIssueRecord ? '1ä¸ªbaseæœŸ + ' : ''}${targetRecords.length}ä¸ªç›®æ ‡æœŸå·)`);
```

### æ–¹æ¡ˆBï¼šæ”¾å®½æœŸå·å¯¹ç”Ÿæˆæ¡ä»¶ï¼ˆå¤‡é€‰ï¼‰

**ä¿®æ”¹ä½ç½®**ï¼š`src/server/server.js:16362-16379`

**æ ¸å¿ƒæ”¹è¿›**ï¼š
1. å½“baseæœŸä¸å­˜åœ¨æ—¶ï¼Œä½¿ç”¨fallbackç­–ç•¥
2. ä»æ•°æ®åº“å®æ—¶æŸ¥è¯¢baseæœŸï¼Œè€Œä¸ä¾èµ–é¢„åŠ è½½çš„æ•°æ®

**ä¿®æ”¹ä»£ç **ï¼š
```javascript
for (const record of issueRecords) {
    const targetID = record.ID;
    const targetIssue = record.Issue.toString();

    // æŸ¥è¯¢ID-1å¯¹åº”çš„åŸºå‡†æœŸè®°å½•
    let baseRecord = idToRecordMap.get(targetID - 1);

    // ğŸ”§ ä¿®å¤ï¼šå¦‚æœbaseæœŸä¸åœ¨æ˜ å°„ä¸­ï¼Œå°è¯•ä»æ•°æ®åº“æŸ¥è¯¢
    if (!baseRecord) {
        log(`  âš ï¸ baseæœŸ(ID=${targetID - 1})ä¸åœ¨ç¼“å­˜ä¸­ï¼Œå°è¯•ä»æ•°æ®åº“æŸ¥è¯¢...`);
        baseRecord = await hit_dlts.findOne({ ID: targetID - 1 })
            .select('Issue ID')
            .lean();

        if (baseRecord) {
            // åŠ å…¥åˆ°æ˜ å°„ä¸­ï¼Œä¾›åç»­ä½¿ç”¨
            idToRecordMap.set(baseRecord.ID, baseRecord);
            log(`  âœ… ä»æ•°æ®åº“æŸ¥è¯¢åˆ°baseæœŸ: ${baseRecord.Issue}(ID=${baseRecord.ID})`);
        }
    }

    if (baseRecord) {
        issuePairs.push({
            base_issue: baseRecord.Issue.toString(),
            target_issue: targetIssue
        });

        log(`  âœ… æœŸå·å¯¹: ${baseRecord.Issue}â†’${targetIssue} (ID ${baseRecord.ID}â†’${targetID})`);
    } else {
        log(`  âŒ æœŸå·${targetIssue}(ID=${targetID})çš„ä¸Šä¸€æœŸ(ID=${targetID - 1})ä¸å­˜åœ¨ï¼Œè·³è¿‡è¯¥æœŸ`);
    }
}
```

### æ–¹æ¡ˆCï¼šç»„åˆæ–¹æ¡ˆA+Bï¼ˆæœ€ç¨³å¥ï¼‰

ç»“åˆä¸¤ä¸ªæ–¹æ¡ˆçš„ä¼˜ç‚¹ï¼š
1. å…ˆä¼˜åŒ–æŸ¥è¯¢é€»è¾‘ï¼ˆæ–¹æ¡ˆAï¼‰
2. å†åŠ fallbackä¿æŠ¤ï¼ˆæ–¹æ¡ˆBï¼‰

## æ¨èå®æ–½

**æ¨èä½¿ç”¨ï¼šæ–¹æ¡ˆAï¼ˆä¼˜åŒ–æŸ¥è¯¢é€»è¾‘ï¼‰**

**åŸå› **ï¼š
1. âœ… ç®€å•ç›´æ¥ï¼Œä»æ ¹æºè§£å†³é—®é¢˜
2. âœ… æ€§èƒ½æ›´å¥½ï¼ˆä¸€æ¬¡æ€§æŸ¥è¯¢æ‰€æœ‰éœ€è¦çš„æ•°æ®ï¼‰
3. âœ… ä¸å½±å“ç°æœ‰é€»è¾‘
4. âœ… ä»£ç æ›´æ¸…æ™°æ˜“æ‡‚

**å®æ–½æ­¥éª¤**ï¼š
1. å¤‡ä»½ `server.js`
2. ä¿®æ”¹ `preloadData` æ–¹æ³•çš„æŸ¥è¯¢é€»è¾‘ï¼ˆç¬¬16341-16351è¡Œï¼‰
3. å¢åŠ æ—¥å¿—ï¼Œç¡®è®¤baseæœŸè¢«æ­£ç¡®æŸ¥è¯¢
4. é‡å¯æœåŠ¡å™¨æµ‹è¯•

## æµ‹è¯•éªŒè¯

**æµ‹è¯•ç”¨ä¾‹**ï¼š
- æœŸå·èŒƒå›´ï¼š25120-25125
- é¢„æœŸç»“æœï¼š
  - 25120ï¼šæœ‰ç»„åˆæ•°ï¼ˆä¸å†æ˜¯0ï¼‰
  - 25121-25124ï¼šæœ‰ç»„åˆæ•°
  - 25125ï¼šæœ‰ç»„åˆæ•°ï¼ˆæ¨ç®—æœŸï¼‰

**éªŒè¯ç‚¹**ï¼š
1. æ—¥å¿—æ˜¾ç¤ºï¼šæŸ¥è¯¢åˆ°7æ¡è®°å½•ï¼ˆ1ä¸ªbaseæœŸ + 6ä¸ªç›®æ ‡æœŸå·ï¼‰
2. æ—¥å¿—æ˜¾ç¤ºï¼šç”Ÿæˆ6ä¸ªæœŸå·å¯¹ï¼ˆåŒ…æ‹¬25119â†’25120ï¼‰
3. ä»»åŠ¡ç»“æœï¼š25120æœ‰æ­£å¸¸çš„ç»„åˆæ•°

## é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼š
```
æœŸå·    ç»„åˆæ•°    æ˜¯å¦æ¨ç®—
25120   4,XXX    å†å²        âœ… ä¸å†æ˜¯0
25121   4,391    å†å²        âœ…
25122   4,253    å†å²        âœ…
25123   2,955    å†å²        âœ…
25124   3,118    å†å²        âœ…
25125   2,880    æ¨ç®—        âœ…
```

## é£é™©è¯„ä¼°

- **é£é™©ç­‰çº§**ï¼šä½
- **å½±å“èŒƒå›´**ï¼šä»…å½±å“æœŸå·å¯¹ç”Ÿæˆé€»è¾‘
- **å›æ»šéš¾åº¦**ï¼šå®¹æ˜“ï¼ˆæœ‰å¤‡ä»½ï¼‰
- **æµ‹è¯•éš¾åº¦**ï¼šå®¹æ˜“ï¼ˆç›´æ¥åˆ›å»ºä»»åŠ¡æµ‹è¯•ï¼‰

---

**å»ºè®®**ï¼šä½¿ç”¨æ–¹æ¡ˆAï¼Œä¿®æ”¹æŸ¥è¯¢é€»è¾‘ç¡®ä¿baseæœŸè¢«æ­£ç¡®è·å–
